<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    




    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.b989f0fdae3971a3effd81d6d0b27b3cb1023ff0b601ff43e2118b0d9d82ddb9.js"></script>





  
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-5PNPM4HWQ0"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-5PNPM4HWQ0');
        }
      </script>

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Tech Blog - From Routing Models to MIP: Solving Capacitated Vehicle Routing Problem</title>
<meta property="og:title" content=Tech&#32;Blog&#32;-&#32;From&#32;Routing&#32;Models&#32;to&#32;MIP:&#32;Solving&#32;Capacitated&#32;Vehicle&#32;Routing&#32;Problem />
<meta name="twitter:title" content=Tech&#32;Blog&#32;-&#32;From&#32;Routing&#32;Models&#32;to&#32;MIP:&#32;Solving&#32;Capacitated&#32;Vehicle&#32;Routing&#32;Problem />
<meta itemprop="name" content=Tech&#32;Blog&#32;-&#32;From&#32;Routing&#32;Models&#32;to&#32;MIP:&#32;Solving&#32;Capacitated&#32;Vehicle&#32;Routing&#32;Problem />
<meta name="application-name" content=Tech&#32;Blog&#32;-&#32;From&#32;Routing&#32;Models&#32;to&#32;MIP:&#32;Solving&#32;Capacitated&#32;Vehicle&#32;Routing&#32;Problem />
<meta property="og:site_name" content="See Hiong&#39;s Blog" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://seehiong.github.io/2024/from-routing-models-to-mip-solving-capacitated-vehicle-routing-problem/" />
<link rel="canonical" href="https://seehiong.github.io/2024/from-routing-models-to-mip-solving-capacitated-vehicle-routing-problem/" itemprop="url" />
<meta name="url" content="https://seehiong.github.io/2024/from-routing-models-to-mip-solving-capacitated-vehicle-routing-problem/" />
<meta name="twitter:url" content="https://seehiong.github.io/2024/from-routing-models-to-mip-solving-capacitated-vehicle-routing-problem/" />
<meta property="og:url" content="https://seehiong.github.io/2024/from-routing-models-to-mip-solving-capacitated-vehicle-routing-problem/" />


<meta property="og:updated_time" content="2024-06-01T20:00:00&#43;08:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://seehiong.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="See Hiong&#39;s Blog" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.134.1">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.95cc0677a25232434df79a1cf0ee059633a97da88b4235a87f2a69bea2c1e24d.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5a5a5a;
        --link-color: #268bd2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #eee;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9d9d9d;
        --link-color: #268bd2;
        --date-color: #9a9a9a;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #fff;
        --code-background-color: #515151;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://seehiong.github.io/">
                <h1>Tech Blog</h1>
            </a>
        
    </h1>
    <p class="lead">
    Chronicling my personal expedition of technology exploration and experimentation, facilitated by a home-based self-configured laboratory
    </p>
</div>

        <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<style>
    :root {
        --pagefind-ui-primary: #eeeeee;
        --pagefind-ui-text: #eeeeee;
        --pagefind-ui-background: #152028;
        --pagefind-ui-border: #152028;
        --pagefind-ui-tag: #152028;
    }
</style>
<script src="/pagefind/pagefind-ui.js"></script>
<div style="max-width: 100%; margin: clamp(2px, 1vw, 10px) auto;">
    <div id="search"></div>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
        });
    </script>
</div>
        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/2024/">2024</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2024/raspberry-pi/">Exploring AI with Raspberry Pi 5</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2024/gpt-2-training-guide/">GPT-2 Training Guide</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2024/gpt-2-setup-and-pretraining-guide/">GPT-2 Setup and Pretraining Guide</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2024/integrating-mlflow-and-kubeflow-on-talos/">Integrating MLflow and Kubeflow on Talos</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2024/deploy-microservices-with-talos-locally/">Deploy Microservices with Talos Locally</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2024/controlling-roarm-m2-s-with-ros2/">Controlling RoArm-M2-S with ROS2</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/archives/">Archives</a>
                    </li>
                    
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/seehiong">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>

















    <a target="_blank" class="social" title="RSS Feed" href="/2024/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>





        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 See Hiong&#39;s Blog. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post" data-pagefind-body>
  <div class="info">
  <h1 class="post-title">
    <a href="https://seehiong.github.io/2024/from-routing-models-to-mip-solving-capacitated-vehicle-routing-problem/">From Routing Models to MIP: Solving Capacitated Vehicle Routing Problem</a>
  </h1>

  <div class="headline" data-pagefind-ignore>
    <div>
      
      
      <time datetime=" 2024-06-01T20:00:00&#43;0800" class="post-date">
        June 1, 2024
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>13 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-Routing Model">
        <a href="https://seehiong.github.io/tags/routing-model">Routing Model</a>
      </li>
      
      <li class="tag-MIP">
        <a href="https://seehiong.github.io/tags/mip">MIP</a>
      </li>
      
      <li class="tag-Micronaut">
        <a href="https://seehiong.github.io/tags/micronaut">Micronaut</a>
      </li>
      
      <li class="tag-VRP">
        <a href="https://seehiong.github.io/tags/vrp">VRP</a>
      </li>
      
      <li class="tag-CVRP">
        <a href="https://seehiong.github.io/tags/cvrp">CVRP</a>
      </li>
      
      <li class="tag-Backend">
        <a href="https://seehiong.github.io/tags/backend">Backend</a>
      </li>
      
      <li class="tag-Java">
        <a href="https://seehiong.github.io/tags/java">Java</a>
      </li>
      
    </ul>
    
  </div>

  
  
  <p class="seriesname">
    Series: <a href="https://seehiong.github.io/series/combinatorial-optimization-problems">Combinatorial Optimization Problems</a>
  </p>
  

  
</div>

  <h2 id="problem-statement">Problem Statement</h2>
<p>In this post, I will follow the <a href="https://developers.google.com/optimization/routing/vrp" target="_blank">Vehicle Routing Problem</a> (VRP) with a focus on the capacitated vehicle routing problem (CVRP) and utilizing an alternative Mixed Integer Programming (MIP) approach.</p>
<hr>
<h2 id="routing-model">Routing Model</h2>
<p>The main section of the program creates the index manager and the routing model.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Create Routing Index Manager</span>
</span></span><span style="display:flex;"><span>RoutingIndexManager manager <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RoutingIndexManager(data.<span style="color:#a6e22e">distanceMatrix</span>.<span style="color:#a6e22e">length</span>, data.<span style="color:#a6e22e">vehicleNumber</span>, data.<span style="color:#a6e22e">depot</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Create Routing Model</span>
</span></span><span style="display:flex;"><span>RoutingModel routing <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RoutingModel(manager);
</span></span></code></pre></div><h3 id="distance-callback">Distance Callback</h3>
<p>The code snippet initializes the transit callback to compute distances between nodes and sets up the arc costs for all vehicles in the VRP model to ensure that the solver considers the correct distances when optimizing the routes:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Create and register a transit callback</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> transitCallbackIndex <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    routing.<span style="color:#a6e22e">registerTransitCallback</span>((<span style="color:#66d9ef">long</span> fromIndex, <span style="color:#66d9ef">long</span> toIndex) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Convert from routing variable Index to user NodeIndex.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> fromNode <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(fromIndex);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> toNode <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(toIndex);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">long</span>) data.<span style="color:#a6e22e">distanceMatrix</span><span style="color:#f92672">[</span>fromNode<span style="color:#f92672">][</span>toNode<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Define cost of each arc.</span>
</span></span><span style="display:flex;"><span>routing.<span style="color:#a6e22e">setArcCostEvaluatorOfAllVehicles</span>(transitCallbackIndex);
</span></span></code></pre></div><h3 id="demand-callback-and-capacity-constraints">Demand Callback and Capacity Constraints</h3>
<p>The solver requires a demand callback, which returns the demand at each location, and a dimension for the vehicle capacity constraints:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Add Capacity constraint.</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> demandCallbackIndex <span style="color:#f92672">=</span> routing.<span style="color:#a6e22e">registerUnaryTransitCallback</span>((<span style="color:#66d9ef">long</span> fromIndex) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Convert from routing variable Index to user NodeIndex.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> fromNode <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(fromIndex);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> data.<span style="color:#a6e22e">demands</span><span style="color:#f92672">[</span>fromNode<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>routing.<span style="color:#a6e22e">addDimensionWithVehicleCapacity</span>(demandCallbackIndex, 0, <span style="color:#75715e">// null capacity slack</span>
</span></span><span style="display:flex;"><span>    data.<span style="color:#a6e22e">vehicleCapacities</span>, <span style="color:#75715e">// vehicle maximum capacities</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">true</span>, <span style="color:#75715e">// start cumul to zero</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;Capacity&#34;</span>);
</span></span></code></pre></div><h3 id="changing-the-search-strategy">Changing the search strategy</h3>
<p>Since the routing solver does not always return the optimal solution, we can use a more advanced search strategy called guided local search, which enables escaping a local minimum. We can further tune our use case with other <a href="https://developers.google.com/optimization/routing/routing_options" target="_blank">Routing Options</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Setting first solution heuristic.</span>
</span></span><span style="display:flex;"><span>RoutingSearchParameters searchParameters <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    main.<span style="color:#a6e22e">defaultRoutingSearchParameters</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">toBuilder</span>()
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setFirstSolutionStrategy</span>(FirstSolutionStrategy.<span style="color:#a6e22e">Value</span>.<span style="color:#a6e22e">PATH_CHEAPEST_ARC</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setLocalSearchMetaheuristic</span>(LocalSearchMetaheuristic.<span style="color:#a6e22e">Value</span>.<span style="color:#a6e22e">GUIDED_LOCAL_SEARCH</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">setTimeLimit</span>(Duration.<span style="color:#a6e22e">newBuilder</span>().<span style="color:#a6e22e">setSeconds</span>(60).<span style="color:#a6e22e">build</span>())
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">build</span>();
</span></span></code></pre></div><h3 id="data-model">Data Model</h3>
<p>This is the data model:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Builder</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Serdeable.Serializable</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Serdeable.Deserializable</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataModel</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span><span style="color:#f92672">[][]</span> distanceMatrix;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">long</span><span style="color:#f92672">[]</span> demands;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">long</span><span style="color:#f92672">[]</span> vehicleCapacities;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> vehicleNumber;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> depot;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-cvrp-service">The CVRP Service</h3>
<p>This is the Micronaut service for CVRP, with the printSolution method adapted from OR-Tools:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Singleton</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CVRPService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> {
</span></span><span style="display:flex;"><span>        Loader.<span style="color:#a6e22e">loadNativeLibraries</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    CVRPSolution <span style="color:#a6e22e">solve</span>(DataModel data) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create Routing Index Manager</span>
</span></span><span style="display:flex;"><span>        RoutingIndexManager manager <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RoutingIndexManager(data.<span style="color:#a6e22e">distanceMatrix</span>.<span style="color:#a6e22e">length</span>, data.<span style="color:#a6e22e">vehicleNumber</span>, data.<span style="color:#a6e22e">depot</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create Routing Model</span>
</span></span><span style="display:flex;"><span>        RoutingModel routing <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RoutingModel(manager);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Create and register a transit callback</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> transitCallbackIndex <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                routing.<span style="color:#a6e22e">registerTransitCallback</span>((<span style="color:#66d9ef">long</span> fromIndex, <span style="color:#66d9ef">long</span> toIndex) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e">// Convert from routing variable Index to user NodeIndex.</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">int</span> fromNode <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(fromIndex);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">int</span> toNode <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(toIndex);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">long</span>) data.<span style="color:#a6e22e">distanceMatrix</span><span style="color:#f92672">[</span>fromNode<span style="color:#f92672">][</span>toNode<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Define cost of each arc.</span>
</span></span><span style="display:flex;"><span>        routing.<span style="color:#a6e22e">setArcCostEvaluatorOfAllVehicles</span>(transitCallbackIndex);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add Capacity constraint.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> demandCallbackIndex <span style="color:#f92672">=</span> routing.<span style="color:#a6e22e">registerUnaryTransitCallback</span>((<span style="color:#66d9ef">long</span> fromIndex) <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Convert from routing variable Index to user NodeIndex.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> fromNode <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(fromIndex);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> data.<span style="color:#a6e22e">demands</span><span style="color:#f92672">[</span>fromNode<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        routing.<span style="color:#a6e22e">addDimensionWithVehicleCapacity</span>(demandCallbackIndex, 0, <span style="color:#75715e">// null capacity slack</span>
</span></span><span style="display:flex;"><span>                data.<span style="color:#a6e22e">vehicleCapacities</span>, <span style="color:#75715e">// vehicle maximum capacities</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">true</span>, <span style="color:#75715e">// start cumul to zero</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Capacity&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Setting first solution heuristic.</span>
</span></span><span style="display:flex;"><span>        RoutingSearchParameters searchParameters <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>                main.<span style="color:#a6e22e">defaultRoutingSearchParameters</span>()
</span></span><span style="display:flex;"><span>                        .<span style="color:#a6e22e">toBuilder</span>()
</span></span><span style="display:flex;"><span>                        .<span style="color:#a6e22e">setFirstSolutionStrategy</span>(FirstSolutionStrategy.<span style="color:#a6e22e">Value</span>.<span style="color:#a6e22e">PATH_CHEAPEST_ARC</span>)
</span></span><span style="display:flex;"><span>                        .<span style="color:#a6e22e">setLocalSearchMetaheuristic</span>(LocalSearchMetaheuristic.<span style="color:#a6e22e">Value</span>.<span style="color:#a6e22e">GUIDED_LOCAL_SEARCH</span>)
</span></span><span style="display:flex;"><span>                        .<span style="color:#a6e22e">setTimeLimit</span>(Duration.<span style="color:#a6e22e">newBuilder</span>().<span style="color:#a6e22e">setSeconds</span>(60).<span style="color:#a6e22e">build</span>())
</span></span><span style="display:flex;"><span>                        .<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Solve the problem.</span>
</span></span><span style="display:flex;"><span>        Assignment solution <span style="color:#f92672">=</span> routing.<span style="color:#a6e22e">solveWithParameters</span>(searchParameters);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#f92672">&lt;</span>Integer, String<span style="color:#f92672">&gt;</span> vehicleMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> data.<span style="color:#a6e22e">vehicleNumber</span>; <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> index <span style="color:#f92672">=</span> routing.<span style="color:#a6e22e">start</span>(i);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">long</span> routeLoad <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>            String route <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#f92672">!</span>routing.<span style="color:#a6e22e">isEnd</span>(index)) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">long</span> nodeIndex <span style="color:#f92672">=</span> manager.<span style="color:#a6e22e">indexToNode</span>(index);
</span></span><span style="display:flex;"><span>                routeLoad <span style="color:#f92672">+=</span> data.<span style="color:#a6e22e">demands</span><span style="color:#f92672">[</span>(<span style="color:#66d9ef">int</span>) nodeIndex<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>                route <span style="color:#f92672">+=</span> nodeIndex <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Load(&#34;</span> <span style="color:#f92672">+</span> routeLoad <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;) -&gt; &#34;</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">long</span> previousIndex <span style="color:#f92672">=</span> index;
</span></span><span style="display:flex;"><span>                index <span style="color:#f92672">=</span> solution.<span style="color:#a6e22e">value</span>(routing.<span style="color:#a6e22e">nextVar</span>(index));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            route <span style="color:#f92672">+=</span> manager.<span style="color:#a6e22e">indexToNode</span>(routing.<span style="color:#a6e22e">end</span>(i));
</span></span><span style="display:flex;"><span>            vehicleMap.<span style="color:#a6e22e">put</span>(i, route);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> CVRPSolution.<span style="color:#a6e22e">builder</span>().<span style="color:#a6e22e">objectiveValue</span>(solution.<span style="color:#a6e22e">objectiveValue</span>()).<span style="color:#a6e22e">variableValue</span>(vehicleMap).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-cvrp-controller">The CVRP Controller</h3>
<p>Here is the Micronaut controller for the CVRP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Controller</span>(<span style="color:#e6db74">&#34;/cvrp&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CVRPController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> CVRPService cvrpService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">CVRPController</span>(CVRPService cvrpService) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cvrpService</span> <span style="color:#f92672">=</span> cvrpService;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Post</span>(<span style="color:#e6db74">&#34;/solve&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Produces</span>(MediaType.<span style="color:#a6e22e">APPLICATION_JSON</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Consumes</span>(MediaType.<span style="color:#a6e22e">APPLICATION_JSON</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> CVRPSolution <span style="color:#a6e22e">solve</span>(<span style="color:#a6e22e">@Body</span> DataModel dataModel) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> cvrpService.<span style="color:#a6e22e">solve</span>(dataModel);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-input">The Input</h3>
<p>This is the sample input from the OR-Tools:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;distanceMatrix&#34;</span>: [
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">548</span>, <span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">696</span>, <span style="color:#ae81ff">582</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">662</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">548</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">684</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">696</span>, <span style="color:#ae81ff">742</span>, <span style="color:#ae81ff">1084</span>, <span style="color:#ae81ff">594</span>, <span style="color:#ae81ff">480</span>, <span style="color:#ae81ff">674</span>, <span style="color:#ae81ff">1016</span>, <span style="color:#ae81ff">868</span>, <span style="color:#ae81ff">1210</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">684</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">992</span>, <span style="color:#ae81ff">878</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">810</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">742</span>, <span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">1278</span>, <span style="color:#ae81ff">1164</span>, <span style="color:#ae81ff">1130</span>, <span style="color:#ae81ff">788</span>, <span style="color:#ae81ff">1552</span>, <span style="color:#ae81ff">754</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">696</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">992</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">650</span>, <span style="color:#ae81ff">878</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">844</span>, <span style="color:#ae81ff">890</span>, <span style="color:#ae81ff">1232</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">628</span>, <span style="color:#ae81ff">822</span>, <span style="color:#ae81ff">1164</span>, <span style="color:#ae81ff">560</span>, <span style="color:#ae81ff">1358</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">582</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">878</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">764</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">1118</span>, <span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">708</span>, <span style="color:#ae81ff">1050</span>, <span style="color:#ae81ff">674</span>, <span style="color:#ae81ff">1244</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">650</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">582</span>, <span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">628</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">1050</span>, <span style="color:#ae81ff">708</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">878</span>, <span style="color:#ae81ff">764</span>, <span style="color:#ae81ff">228</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">1004</span>, <span style="color:#ae81ff">890</span>, <span style="color:#ae81ff">856</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">1278</span>, <span style="color:#ae81ff">480</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">810</span>, <span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">342</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">320</span>, <span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">742</span>, <span style="color:#ae81ff">856</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">696</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">844</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">342</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">810</span>, <span style="color:#ae81ff">696</span>, <span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">320</span>, <span style="color:#ae81ff">1084</span>, <span style="color:#ae81ff">514</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">742</span>, <span style="color:#ae81ff">742</span>, <span style="color:#ae81ff">890</span>, <span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">342</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">422</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">810</span>, <span style="color:#ae81ff">468</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">1084</span>, <span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">1232</span>, <span style="color:#ae81ff">1118</span>, <span style="color:#ae81ff">582</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">342</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">878</span>, <span style="color:#ae81ff">764</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">1152</span>, <span style="color:#ae81ff">354</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">502</span>, <span style="color:#ae81ff">594</span>, <span style="color:#ae81ff">1278</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">400</span>, <span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">1004</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">810</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">878</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">650</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">844</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">480</span>, <span style="color:#ae81ff">1164</span>, <span style="color:#ae81ff">628</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">890</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">696</span>, <span style="color:#ae81ff">422</span>, <span style="color:#ae81ff">764</span>, <span style="color:#ae81ff">114</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">730</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">674</span>, <span style="color:#ae81ff">1130</span>, <span style="color:#ae81ff">822</span>, <span style="color:#ae81ff">708</span>, <span style="color:#ae81ff">628</span>, <span style="color:#ae81ff">856</span>, <span style="color:#ae81ff">320</span>, <span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">308</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">342</span>, <span style="color:#ae81ff">422</span>, <span style="color:#ae81ff">536</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">1016</span>, <span style="color:#ae81ff">788</span>, <span style="color:#ae81ff">1164</span>, <span style="color:#ae81ff">1050</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">320</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">650</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">342</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">764</span>, <span style="color:#ae81ff">194</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">776</span>, <span style="color:#ae81ff">868</span>, <span style="color:#ae81ff">1552</span>, <span style="color:#ae81ff">560</span>, <span style="color:#ae81ff">674</span>, <span style="color:#ae81ff">1050</span>, <span style="color:#ae81ff">1278</span>, <span style="color:#ae81ff">742</span>, <span style="color:#ae81ff">1084</span>, <span style="color:#ae81ff">810</span>, <span style="color:#ae81ff">1152</span>, <span style="color:#ae81ff">274</span>, <span style="color:#ae81ff">388</span>, <span style="color:#ae81ff">422</span>, <span style="color:#ae81ff">764</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">798</span>],
</span></span><span style="display:flex;"><span>        [<span style="color:#ae81ff">662</span>, <span style="color:#ae81ff">1210</span>, <span style="color:#ae81ff">754</span>, <span style="color:#ae81ff">1358</span>, <span style="color:#ae81ff">1244</span>, <span style="color:#ae81ff">708</span>, <span style="color:#ae81ff">480</span>, <span style="color:#ae81ff">856</span>, <span style="color:#ae81ff">514</span>, <span style="color:#ae81ff">468</span>, <span style="color:#ae81ff">354</span>, <span style="color:#ae81ff">844</span>, <span style="color:#ae81ff">730</span>, <span style="color:#ae81ff">536</span>, <span style="color:#ae81ff">194</span>, <span style="color:#ae81ff">798</span>, <span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;demands&#34;</span>:[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vehicleCapacities&#34;</span>:[<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">15</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;vehicleNumber&#34;</span>:<span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;depot&#34;</span> :<span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-cvrpsolution">The CVRPSolution</h3>
<p>This is the CVRPSolution:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Builder</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Serdeable.Serializable</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CVRPSolution</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">double</span> objectiveValue;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>Integer, String<span style="color:#f92672">&gt;</span> variableValue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="solver-in-action">Solver in Action</h3>
<p><img src="/images/cvrp/cvrp-micronaut-postman-result.png" alt="cvrp-micronaut-postman-result"></p>
<hr>
<h2 id="optional-solving-using-mip-approach">Optional: Solving using MIP Approach</h2>
<p>Let&rsquo;s create a <em>solveMIP</em> method in <strong>CVRPService.java</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Create the MIP solver</span>
</span></span><span style="display:flex;"><span>MPSolver solver <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPSolver(<span style="color:#e6db74">&#34;CVRP&#34;</span>, MPSolver.<span style="color:#a6e22e">OptimizationProblemType</span>.<span style="color:#a6e22e">CBC_MIXED_INTEGER_PROGRAMMING</span>);
</span></span></code></pre></div><h3 id="variables">Variables</h3>
<p>Let \( t \) be the decision variable for denoting that vehicle \( k \) will travel from node \( i \) to node \( j \). Let \( s \) be the decision variable for denoting that node \( i \) is fulfilled by vehicle \( k \).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Variables: t[i][j][k] is 1 if vehicle k travels from node i to node j</span>
</span></span><span style="display:flex;"><span>MPVariable<span style="color:#f92672">[][][]</span> t <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPVariable<span style="color:#f92672">[</span>numNodes<span style="color:#f92672">][</span>numNodes<span style="color:#f92672">][</span>numVehicles<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeIntVar</span>(0, 1, <span style="color:#e6db74">&#34;travel_&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Variables: s[i][k] is 1 if node i is fulfilled by k</span>
</span></span><span style="display:flex;"><span>MPVariable<span style="color:#f92672">[][]</span> s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPVariable<span style="color:#f92672">[</span>numNodes<span style="color:#f92672">][</span>numVehicles<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        s<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeIntVar</span>(0, 1, <span style="color:#e6db74">&#34;serve_&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="objectives">Objectives</h3>
<p>Minimize the total distance travelled by all vehicles:</p>
$$ \sum_{k \in K} \sum_{i \in I} \sum_{j \in J} t_{i,j,k} \cdot \text{{distance matrix}}_{i,j} $$<p>This is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Objective: Minimize the total distance traveled</span>
</span></span><span style="display:flex;"><span>MPObjective objective <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">objective</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                objective.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>,  data.<span style="color:#a6e22e">distanceMatrix</span><span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>objective.<span style="color:#a6e22e">setMinimization</span>();
</span></span></code></pre></div><h3 id="constraints">Constraints</h3>
<ol>
<li>Each vehicle starts at the depot:</li>
</ol>
$$ \sum_{j} t_{0,j,k} = 1 \quad \forall k $$<ol start="2">
<li>Each vehicle ends at the depot:</li>
</ol>
$$ \sum_{i} t_{i,0,k} = 1 \quad \forall k $$<p>This is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 1. Each vehicle starts at the depot</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(1, 1, <span style="color:#e6db74">&#34;depot_start_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>depot<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 2. Each vehicle ends at the depot</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(1, 1, <span style="color:#e6db74">&#34;deport_end_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>depot<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="3">
<li>Each Node Is Visited Exactly Once by Exactly One Vehicle (Excluding Depot):</li>
</ol>
$$ \sum_{i \neq j} x_{i,j,k} = 1 \quad \forall j $$<p>This is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 3. Each node is visited exactly once by exactly one vehicle (excluding depot)</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(1, 1, <span style="color:#e6db74">&#34;visit_node_&#34;</span> <span style="color:#f92672">+</span> j);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="4">
<li><strong>Flow Conservation</strong>: If a vehicle arrives at a node, it must leave:</li>
</ol>
$$ \sum_{\substack{i \neq n}} t_{i,n,k} - \sum_{\substack{j \neq n}} t_{n,j,k} = 0, \quad \forall n, k $$<p>This is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 4. Flow conservation: if a vehicle arrives at a node, it must leave</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> 0; n <span style="color:#f92672">&lt;</span> numNodes; n<span style="color:#f92672">++</span>) {  <span style="color:#75715e">// Include depot to enforce return</span>
</span></span><span style="display:flex;"><span>        MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(0, 0, <span style="color:#e6db74">&#34;flow_conservation_&#34;</span> <span style="color:#f92672">+</span> n <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> n) {
</span></span><span style="display:flex;"><span>                constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>n<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>n<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, <span style="color:#f92672">-</span>1);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="5">
<li><strong>Capacity constraints</strong>: For each vehicle $k $, ensure that the total demand on its route does not exceed its capacity:</li>
</ol>
$$ \sum_{i \neq j} t_{i,j,k} \cdot \text{{demand}}_i \leq \text{{vehicle capacity}}_k \quad \forall k $$<p>This is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// 5. Capacity constraints</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(0, data.<span style="color:#a6e22e">vehicleCapacities</span><span style="color:#f92672">[</span>k<span style="color:#f92672">]</span>, <span style="color:#e6db74">&#34;capacity_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, data.<span style="color:#a6e22e">demands</span><span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ol start="6">
<li><strong>Subtour elimination constraints</strong>: To ensure that there are no subtours (sub-routes) in the solution, we introduce auxiliary variables
\( 𝑢 \) for each customer node \( i \). These variables help enforce the sequence in which nodes are visited, preventing isolated cycles that do not include the depot. Ths subtour elimination constraint is given by:</li>
</ol>
$$ u_i - u_j + M \cdot t_{i,j,k} \leq M - 1, \quad \forall i \neq j, \forall k $$<p>This is implemented as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Create auxiliary variables for subtour elimination</span>
</span></span><span style="display:flex;"><span>MPVariable<span style="color:#f92672">[]</span> u <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPVariable<span style="color:#f92672">[</span>numNodes<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    u<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeIntVar</span>(0, numNodes, <span style="color:#e6db74">&#34;u_&#34;</span> <span style="color:#f92672">+</span> i);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 6. Subtour elimination constraints</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                MPConstraint subtourConstraint  <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(<span style="color:#f92672">-</span>MPSolver.<span style="color:#a6e22e">infinity</span>(), numNodes <span style="color:#f92672">-</span> 1, <span style="color:#e6db74">&#34;subtour_elimination_&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>                subtourConstraint.<span style="color:#a6e22e">setCoefficient</span>(u<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>                subtourConstraint.<span style="color:#a6e22e">setCoefficient</span>(u<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span>, <span style="color:#f92672">-</span>1);
</span></span><span style="display:flex;"><span>                subtourConstraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, numNodes);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="putting-it-together">Putting it together</h3>
<p>This is the sovleMIP method in <em>CVRPService.java</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>CVRPSolution <span style="color:#a6e22e">solveMIP</span>(DataModel data) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> numNodes <span style="color:#f92672">=</span> data.<span style="color:#a6e22e">distanceMatrix</span>.<span style="color:#a6e22e">length</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> numVehicles <span style="color:#f92672">=</span> data.<span style="color:#a6e22e">vehicleNumber</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> depot <span style="color:#f92672">=</span> data.<span style="color:#a6e22e">depot</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create the MIP solver</span>
</span></span><span style="display:flex;"><span>    MPSolver solver <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPSolver(<span style="color:#e6db74">&#34;CVRP&#34;</span>, MPSolver.<span style="color:#a6e22e">OptimizationProblemType</span>.<span style="color:#a6e22e">CBC_MIXED_INTEGER_PROGRAMMING</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Variables: t[i][j][k] is 1 if vehicle k travels from node i to node j</span>
</span></span><span style="display:flex;"><span>    MPVariable<span style="color:#f92672">[][][]</span> t <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPVariable<span style="color:#f92672">[</span>numNodes<span style="color:#f92672">][</span>numNodes<span style="color:#f92672">][</span>numVehicles<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                    t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeIntVar</span>(0, 1, <span style="color:#e6db74">&#34;travel_&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Variables: s[i][k] is 1 if node i is served by k</span>
</span></span><span style="display:flex;"><span>    MPVariable<span style="color:#f92672">[][]</span> s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPVariable<span style="color:#f92672">[</span>numNodes<span style="color:#f92672">][</span>numVehicles<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            s<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeIntVar</span>(0, 1, <span style="color:#e6db74">&#34;serve_&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Objective: Minimize the total distance traveled</span>
</span></span><span style="display:flex;"><span>    MPObjective objective <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">objective</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                    objective.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>,  data.<span style="color:#a6e22e">distanceMatrix</span><span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    objective.<span style="color:#a6e22e">setMinimization</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Constraints:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 1. Each vehicle starts at the depot</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(1, 1, <span style="color:#e6db74">&#34;depot_start_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>depot<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 2. Each vehicle ends at the depot</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(1, 1, <span style="color:#e6db74">&#34;deport_end_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>depot<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 3. Each node is visited exactly once by exactly one vehicle (excluding depot)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(1, 1, <span style="color:#e6db74">&#34;visit_node_&#34;</span> <span style="color:#f92672">+</span> j);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                    constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 4. Flow conservation: if a vehicle arrives at a node, it must leave</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> 0; n <span style="color:#f92672">&lt;</span> numNodes; n<span style="color:#f92672">++</span>) {  <span style="color:#75715e">// Include depot to enforce return</span>
</span></span><span style="display:flex;"><span>            MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(0, 0, <span style="color:#e6db74">&#34;flow_conservation_&#34;</span> <span style="color:#f92672">+</span> n <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> n) {
</span></span><span style="display:flex;"><span>                    constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>n<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (n <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                    constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>n<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, <span style="color:#f92672">-</span>1);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 5. Capacity constraints</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        MPConstraint constraint <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(0, data.<span style="color:#a6e22e">vehicleCapacities</span><span style="color:#f92672">[</span>k<span style="color:#f92672">]</span>, <span style="color:#e6db74">&#34;capacity_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                    constraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, data.<span style="color:#a6e22e">demands</span><span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Create auxiliary variables for subtour elimination</span>
</span></span><span style="display:flex;"><span>    MPVariable<span style="color:#f92672">[]</span> u <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MPVariable<span style="color:#f92672">[</span>numNodes<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        u<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeIntVar</span>(0, numNodes, <span style="color:#e6db74">&#34;u_&#34;</span> <span style="color:#f92672">+</span> i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 6. Subtour elimination constraints</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 1; i <span style="color:#f92672">&lt;</span> numNodes; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 1; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">!=</span> j) {
</span></span><span style="display:flex;"><span>                    MPConstraint subtourConstraint  <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">makeConstraint</span>(<span style="color:#f92672">-</span>MPSolver.<span style="color:#a6e22e">infinity</span>(), numNodes <span style="color:#f92672">-</span> 1, <span style="color:#e6db74">&#34;subtour_elimination_&#34;</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> j <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> k);
</span></span><span style="display:flex;"><span>                    subtourConstraint.<span style="color:#a6e22e">setCoefficient</span>(u<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span>, 1);
</span></span><span style="display:flex;"><span>                    subtourConstraint.<span style="color:#a6e22e">setCoefficient</span>(u<span style="color:#f92672">[</span>j<span style="color:#f92672">]</span>, <span style="color:#f92672">-</span>1);
</span></span><span style="display:flex;"><span>                    subtourConstraint.<span style="color:#a6e22e">setCoefficient</span>(t<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>, numNodes);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Solve</span>
</span></span><span style="display:flex;"><span>    solver.<span style="color:#a6e22e">setTimeLimit</span>(10000);
</span></span><span style="display:flex;"><span>    MPSolver.<span style="color:#a6e22e">ResultStatus</span> resultStatus <span style="color:#f92672">=</span> solver.<span style="color:#a6e22e">solve</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Check the result</span>
</span></span><span style="display:flex;"><span>    Map<span style="color:#f92672">&lt;</span>Integer, String<span style="color:#f92672">&gt;</span> vehicleMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (resultStatus <span style="color:#f92672">==</span> MPSolver.<span style="color:#a6e22e">ResultStatus</span>.<span style="color:#a6e22e">OPTIMAL</span> <span style="color:#f92672">||</span> resultStatus <span style="color:#f92672">==</span> MPSolver.<span style="color:#a6e22e">ResultStatus</span>.<span style="color:#a6e22e">FEASIBLE</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> 0; k <span style="color:#f92672">&lt;</span> numVehicles; k<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> currentNode <span style="color:#f92672">=</span> depot;
</span></span><span style="display:flex;"><span>            String route <span style="color:#f92672">=</span> String.<span style="color:#a6e22e">valueOf</span>(depot);  <span style="color:#75715e">// Start from the depot</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">boolean</span> routeContinues <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> 0; j <span style="color:#f92672">&lt;</span> numNodes; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (currentNode <span style="color:#f92672">!=</span> j <span style="color:#f92672">&amp;&amp;</span> t<span style="color:#f92672">[</span>currentNode<span style="color:#f92672">][</span>j<span style="color:#f92672">][</span>k<span style="color:#f92672">]</span>.<span style="color:#a6e22e">solutionValue</span>() <span style="color:#f92672">==</span> 1.<span style="color:#a6e22e">0</span>) {
</span></span><span style="display:flex;"><span>                        route <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34; -&gt; &#34;</span> <span style="color:#f92672">+</span> j;
</span></span><span style="display:flex;"><span>                        currentNode <span style="color:#f92672">=</span> j;
</span></span><span style="display:flex;"><span>                        routeContinues <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>routeContinues <span style="color:#f92672">||</span> currentNode <span style="color:#f92672">==</span> depot) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;  <span style="color:#75715e">// No further route found for this vehicle</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            vehicleMap.<span style="color:#a6e22e">put</span>(k, route);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> CVRPSolution.<span style="color:#a6e22e">builder</span>().<span style="color:#a6e22e">objectiveValue</span>(objective.<span style="color:#a6e22e">value</span>()).<span style="color:#a6e22e">variableValue</span>(vehicleMap).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="the-updated-controller">The updated controller</h3>
<p>This is the refactored CVRPController.java:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Post</span>(<span style="color:#e6db74">&#34;/solveMIP&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Produces</span>(MediaType.<span style="color:#a6e22e">APPLICATION_JSON</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Consumes</span>(MediaType.<span style="color:#a6e22e">APPLICATION_JSON</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> CVRPSolution <span style="color:#a6e22e">solveMIP</span>(<span style="color:#a6e22e">@Body</span> DataModel dataModel) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cvrpService.<span style="color:#a6e22e">solveMIP</span>(dataModel);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="mip-solver-in-action">MIP Solver in Action</h3>
<p>This is the result for the sample data:</p>
<p><img src="/images/cvrp/cvrp-mip-micronaut-postman-result.png" alt="cvrp-mip-micronaut-postman-result"></p>
<p>The MIP approach provides a precise method for solving the Capacitated Vehicle Routing Problem, offering optimal solutions but with higher computational demands. This makes it less suitable for very large instances or real-time applications compared to heuristic methods. While MIP handles complex constraints more flexibly, traditional routing models are faster and more scalable. Therefore, the choice between MIP and traditional methods depends on the problem&rsquo;s requirements, such as accuracy, size, and available computational resources. MIP remains a powerful tool for tackling challenging optimization problems in logistics and transportation.</p>

  
  <hr>
<div class="footer">
    
    
    
    <p>
    This is a post in the <b><a href="https://seehiong.github.io/series/combinatorial-optimization-problems">Combinatorial Optimization Problems</a></b> series.
        <br>Other posts in this series:
        <ul class="series">
            
            
            
            <li>
                June 1, 2024 -
                
                    From Routing Models to MIP: Solving Capacitated Vehicle Routing Problem
                
            </li>
            
            <li>
                May 27, 2024 -
                
                    <a href="/2024/solving-facility-location-problem-with-or-tools-and-micronaut/">Solving Facility Location Problem with OR-Tools and Micronaut</a>
                
            </li>
            
            <li>
                May 23, 2024 -
                
                    <a href="/2024/optimizing-tsp-with-genetic-algorithms-in-micronaut/">Optimizing TSP with Genetic Algorithms in Micronaut</a>
                
            </li>
            
            <li>
                April 27, 2024 -
                
                    <a href="/2024/efficient-tsp-solver-api-with-micronaut/">Efficient TSP Solver API with Micronaut</a>
                
            </li>
            
        </ul>
    </p>
    
</div>

  
  <br>
<div class="comments">
    <script>
        const getStoredTheme = () => {
            const themeFromLS = localStorage.getItem("theme");
            const themeFromHugo = document.body.classList.contains("dark-theme") ? "dark" : "light";
            const currentTheme = themeFromLS ? themeFromLS : themeFromHugo;
            return currentTheme;
        };

        const setGiscusTheme = (theme) => {
            const sendMessage = (message) => {
                const iframe = document.querySelector('iframe.giscus-frame');
                if (iframe) {
                    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                }
            };
            sendMessage({ setConfig: { theme } });
        };

        document.addEventListener("DOMContentLoaded", () => {
            setGiscusTheme(getStoredTheme());

            const giscusAttributes = {
                "src": "https://giscus.app/client.js",
                "data-repo": "seehiong/seehiong.github.io",
                "data-repo-id": "R_kgDOJg7Puw",
                "data-category": "General",
                "data-category-id": "DIC_kwDOJg7Pu84Cbyhc",
                "data-mapping": "url",
                "data-strict": "0",
                "data-reactions-enabled": "1",
                "data-emit-metadata": "0",
                "data-input-position": "top",
                "data-theme": getStoredTheme(),
                "data-lang": "en",
                "data-loading": "lazy",
                "crossorigin": "anonymous",
                "async": "",
            };

            
            const giscusScript = document.createElement("script");
            Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
            document.querySelector(".comments").appendChild(giscusScript);

            
            const themeSwitcher = document.querySelector(".btn-light-dark");
            if (themeSwitcher) {
                themeSwitcher.addEventListener("click", () => {
                    const currentTheme = getStoredTheme();
                    document.documentElement.classList.toggle("dark", currentTheme);
                    setGiscusTheme(currentTheme);
                });
            }
        });
    </script>
</div>
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#problem-statement">Problem Statement</a></li>
    <li><a href="#routing-model">Routing Model</a>
      <ul>
        <li><a href="#distance-callback">Distance Callback</a></li>
        <li><a href="#demand-callback-and-capacity-constraints">Demand Callback and Capacity Constraints</a></li>
        <li><a href="#changing-the-search-strategy">Changing the search strategy</a></li>
        <li><a href="#data-model">Data Model</a></li>
        <li><a href="#the-cvrp-service">The CVRP Service</a></li>
        <li><a href="#the-cvrp-controller">The CVRP Controller</a></li>
        <li><a href="#the-input">The Input</a></li>
        <li><a href="#the-cvrpsolution">The CVRPSolution</a></li>
        <li><a href="#solver-in-action">Solver in Action</a></li>
      </ul>
    </li>
    <li><a href="#optional-solving-using-mip-approach">Optional: Solving using MIP Approach</a>
      <ul>
        <li><a href="#variables">Variables</a></li>
        <li><a href="#objectives">Objectives</a></li>
        <li><a href="#constraints">Constraints</a></li>
        <li><a href="#putting-it-together">Putting it together</a></li>
        <li><a href="#the-updated-controller">The updated controller</a></li>
        <li><a href="#mip-solver-in-action">MIP Solver in Action</a></li>
      </ul>
    </li>
  </ul>
</nav>

      
        <hr>
        
              <div class="previous-post">
                <a href="https://seehiong.github.io/2024/solving-facility-location-problem-with-or-tools-and-micronaut/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Solving Facility Location Problem with OR-Tools...</a>
              </div>
              <br><br>
          
        
              <div class="next-post">
                  <a href="https://seehiong.github.io/2024/planning-gift-deliveries-with-qgis/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Planning Gift Deliveries With QGIS</a>
              </div>
          
      
    </div>
</div>
  

        </div>
    </body>
</html>


<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>
