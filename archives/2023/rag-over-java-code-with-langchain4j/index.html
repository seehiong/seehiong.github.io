<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    




    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.b989f0fdae3971a3effd81d6d0b27b3cb1023ff0b601ff43e2118b0d9d82ddb9.js"></script>





  
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-5PNPM4HWQ0"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-5PNPM4HWQ0');
        }
      </script>

    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Tech Blog - RAG over Java code with Langchain4j</title>
<meta property="og:title" content=Tech&#32;Blog&#32;-&#32;RAG&#32;over&#32;Java&#32;code&#32;with&#32;Langchain4j />
<meta name="twitter:title" content=Tech&#32;Blog&#32;-&#32;RAG&#32;over&#32;Java&#32;code&#32;with&#32;Langchain4j />
<meta itemprop="name" content=Tech&#32;Blog&#32;-&#32;RAG&#32;over&#32;Java&#32;code&#32;with&#32;Langchain4j />
<meta name="application-name" content=Tech&#32;Blog&#32;-&#32;RAG&#32;over&#32;Java&#32;code&#32;with&#32;Langchain4j />
<meta property="og:site_name" content="See Hiong&#39;s Blog" />


<meta name="description" content="In my latest post, I delve into seamlessly integrating Retrieval-Augmented Generation (RAG) with Java code using Langchain4j. Drawing inspiration from RAG over code, I explore Java Parser&#39;s potential for robust codebase analysis. The pivotal JavaParsingService and EmbeddingStoreService orchestrate this integration, enabling users to effortlessly load Java projects and glean profound insights. The enhanced controller boasts user-friendly endpoints, fostering dynamic interactions. Witness Retrieval-Augmented Generation breathe life into Java code, from codebase ingestion to insightful querying with models like gpt4all-j, WizardLM, and OpenAI. This narrative unveils the nuanced capabilities of RAG in querying Java codebases." />
<meta itemprop="description" content="In my latest post, I delve into seamlessly integrating Retrieval-Augmented Generation (RAG) with Java code using Langchain4j. Drawing inspiration from RAG over code, I explore Java Parser&#39;s potential for robust codebase analysis. The pivotal JavaParsingService and EmbeddingStoreService orchestrate this integration, enabling users to effortlessly load Java projects and glean profound insights. The enhanced controller boasts user-friendly endpoints, fostering dynamic interactions. Witness Retrieval-Augmented Generation breathe life into Java code, from codebase ingestion to insightful querying with models like gpt4all-j, WizardLM, and OpenAI. This narrative unveils the nuanced capabilities of RAG in querying Java codebases." />
<meta property="og:description" content="In my latest post, I delve into seamlessly integrating Retrieval-Augmented Generation (RAG) with Java code using Langchain4j. Drawing inspiration from RAG over code, I explore Java Parser&#39;s potential for robust codebase analysis. The pivotal JavaParsingService and EmbeddingStoreService orchestrate this integration, enabling users to effortlessly load Java projects and glean profound insights. The enhanced controller boasts user-friendly endpoints, fostering dynamic interactions. Witness Retrieval-Augmented Generation breathe life into Java code, from codebase ingestion to insightful querying with models like gpt4all-j, WizardLM, and OpenAI. This narrative unveils the nuanced capabilities of RAG in querying Java codebases." />
<meta name="twitter:description" content="In my latest post, I delve into seamlessly integrating Retrieval-Augmented Generation (RAG) with Java code using Langchain4j. Drawing inspiration from RAG over code, I explore Java Parser&#39;s potential for robust codebase analysis. The pivotal JavaParsingService and EmbeddingStoreService orchestrate this integration, enabling users to effortlessly load Java projects and glean profound insights. The enhanced controller boasts user-friendly endpoints, fostering dynamic interactions. Witness Retrieval-Augmented Generation breathe life into Java code, from codebase ingestion to insightful querying with models like gpt4all-j, WizardLM, and OpenAI. This narrative unveils the nuanced capabilities of RAG in querying Java codebases." />


<base href="https://seehiong.github.io/archives/2023/rag-over-java-code-with-langchain4j/" />
<link rel="canonical" href="https://seehiong.github.io/archives/2023/rag-over-java-code-with-langchain4j/" itemprop="url" />
<meta name="url" content="https://seehiong.github.io/archives/2023/rag-over-java-code-with-langchain4j/" />
<meta name="twitter:url" content="https://seehiong.github.io/archives/2023/rag-over-java-code-with-langchain4j/" />
<meta property="og:url" content="https://seehiong.github.io/archives/2023/rag-over-java-code-with-langchain4j/" />


<meta property="og:updated_time" content="2023-11-11T20:00:00&#43;08:00" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://seehiong.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="See Hiong&#39;s Blog" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.134.1">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.95cc0677a25232434df79a1cf0ee059633a97da88b4235a87f2a69bea2c1e24d.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5a5a5a;
        --link-color: #268bd2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #eee;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9d9d9d;
        --link-color: #268bd2;
        --date-color: #9a9a9a;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #fff;
        --code-background-color: #515151;
        --code-block-color: #fff;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="dark-theme">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
        
            <a href="https://seehiong.github.io/">
                <h1>Tech Blog</h1>
            </a>
        
    </h1>
    <p class="lead">
    Chronicling my personal expedition of technology exploration and experimentation, facilitated by a home-based self-configured laboratory
    </p>
</div>

        <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<style>
    :root {
        --pagefind-ui-primary: #eeeeee;
        --pagefind-ui-text: #eeeeee;
        --pagefind-ui-background: #152028;
        --pagefind-ui-border: #152028;
        --pagefind-ui-tag: #152028;
    }
</style>
<script src="/pagefind/pagefind-ui.js"></script>
<div style="max-width: 100%; margin: clamp(2px, 1vw, 10px) auto;">
    <div id="search"></div>
    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
        });
    </script>
</div>
        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/2025/">2025</a>
                    </li>
                    
                        <li class="sub-heading">
                            Recent
                        </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2025/chat-driven-insights-with-chartjs/">Chat-Driven Insights with Chart.js</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2025/jmc-java-performance-profiling-simplified/">JMC: Java Performance Profiling Simplified</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://seehiong.github.io/2025/building-a-vuejs-frontend-for-combinatorial-optimization-problem/">Building a Vue.js Frontend for Combinatorial Optimization Problems</a>
                            </li>
                        
                    
                
            
                
                
            
                
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
            
                
                
                    <li class="heading">
                        <a href="/archives/">Archives</a>
                    </li>
                    
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/about/">About</a>
                    </li>
                    
                
            
                
                
            
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/seehiong">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/seehiong">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>















    <a target="_blank" class="social" title="RSS Feed" href="/2025/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>





        <p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2025 See Hiong. All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <div class="post" data-pagefind-body>
  <div class="info">
  <h1 class="post-title">
    <a href="https://seehiong.github.io/archives/2023/rag-over-java-code-with-langchain4j/">RAG over Java code with Langchain4j</a>
  </h1>

  <div class="headline" data-pagefind-ignore>
    <div>
      
      
      <time datetime=" 2023-11-11T20:00:00&#43;0800" class="post-date">
        November 11, 2023
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>5 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-langchain4j">
        <a href="https://seehiong.github.io/tags/langchain4j">langchain4j</a>
      </li>
      
      <li class="tag-LocalAI">
        <a href="https://seehiong.github.io/tags/localai">LocalAI</a>
      </li>
      
      <li class="tag-Spring Boot">
        <a href="https://seehiong.github.io/tags/spring-boot">Spring Boot</a>
      </li>
      
      <li class="tag-Java">
        <a href="https://seehiong.github.io/tags/java">Java</a>
      </li>
      
      <li class="tag-Chroma">
        <a href="https://seehiong.github.io/tags/chroma">Chroma</a>
      </li>
      
      <li class="tag-GPT4All">
        <a href="https://seehiong.github.io/tags/gpt4all">GPT4All</a>
      </li>
      
      <li class="tag-OpenAI">
        <a href="https://seehiong.github.io/tags/openai">OpenAI</a>
      </li>
      
      <li class="tag-WizardLM">
        <a href="https://seehiong.github.io/tags/wizardlm">WizardLM</a>
      </li>
      
      <li class="tag-AI">
        <a href="https://seehiong.github.io/tags/ai">AI</a>
      </li>
      
      <li class="tag-Backend">
        <a href="https://seehiong.github.io/tags/backend">Backend</a>
      </li>
      
      <li class="tag-BE">
        <a href="https://seehiong.github.io/tags/be">BE</a>
      </li>
      
      <li class="tag-LLM">
        <a href="https://seehiong.github.io/tags/llm">LLM</a>
      </li>
      
      <li class="tag-RAG">
        <a href="https://seehiong.github.io/tags/rag">RAG</a>
      </li>
      
    </ul>
    
  </div>

  
  
  <p class="author">
    Author: <i>See Hiong</i>
  </p>
  

  

  
</div>

  <p>Expanding upon the concepts introduced in the <a href="https://seehiong.github.io/archives/2023/building-an-ai-application-with-langchain4j/" target="_blank">previous post</a> and drawing inspiration from <a href="https://python.langchain.com/docs/use_cases/question_answering/code_understanding" target="_blank">RAG over code</a>, this article dives into the integration of a Retrieval-Augmented Generation (RAG) service. The goal is to empower users to query their Java codebase effectively.</p>
<hr>
<h2 id="getting-started">Getting Started</h2>
<p>To embark on this journey, I&rsquo;ve opted for <a href="https://javaparser.org/" target="_blank">Java Parser</a> , a powerful tool for traversing Java source code. Let&rsquo;s begin by incorporating the latest version of Java Parser into our build.gradle file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>dependencies <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Ohter dependencies
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	implementation <span style="color:#e6db74">&#39;com.github.javaparser:javaparser-symbol-solver-core:3.25.6&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><hr>
<h2 id="creating-new-services">Creating new Services</h2>
<p>In this section, we created the essential services to enhance the capabilities of our AI application. We introduce two key services, each serving a distinct purpose in our system architecture.</p>
<h3 id="javaparsingservice">JavaParsingService</h3>
<p>The JavaParsingService is introduced to facilitate codebase analysis using the Java Parser library. This service lays the foundation for code traversal and integrates with Langchain4j components for embedding and retrieval. Below is the detailed service implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.seehiong.ai.service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import static</span> dev.langchain4j.data.document.Document.DOCUMENT_TYPE;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import static</span> dev.langchain4j.model.openai.OpenAiModelName.GPT_3_5_TURBO;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.nio.file.Paths;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.ArrayList;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Optional;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.ParseResult;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.ast.CompilationUnit;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.ast.PackageDeclaration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.ast.visitor.VoidVisitor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.ast.visitor.VoidVisitorAdapter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.github.javaparser.utils.SourceRoot;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.document.Document;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.document.DocumentSplitter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.document.Metadata;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.document.splitter.DocumentSplitters;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.embedding.Embedding;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.segment.TextSegment;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.memory.chat.MessageWindowChatMemory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.model.chat.ChatLanguageModel;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.model.embedding.EmbeddingModel;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.model.openai.OpenAiTokenizer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.retriever.EmbeddingStoreRetriever;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.retriever.Retriever;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.service.AiServices;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.service.SystemMessage;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.store.embedding.EmbeddingStore;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.store.embedding.EmbeddingStoreIngestor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JavaParsingService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> EmbeddingStoreService embeddingStoreSvc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">JavaCodeAgent</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">@SystemMessage</span>({
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;Imagine you are a highly experienced Java programmer tasked with explaining the structure and functionality of the provided Java code.&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#e6db74">&#34;Your goal is to conduct a thorough analysis of the codebase, highlighting key aspects such as design patterns, architectural choices, and coding practices.&#34;</span> })
</span></span><span style="display:flex;"><span>		String <span style="color:#a6e22e">query</span>(String userMessage);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClassNameCollector</span> <span style="color:#66d9ef">extends</span> VoidVisitorAdapter<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">visit</span>(ClassOrInterfaceDeclaration n, List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> collector) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">super</span>.<span style="color:#a6e22e">visit</span>(n, collector);
</span></span><span style="display:flex;"><span>			collector.<span style="color:#a6e22e">add</span>(n.<span style="color:#a6e22e">getNameAsString</span>());
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JavaDocumentLoader</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">public</span> Document <span style="color:#a6e22e">load</span>(String javaCode, Optional<span style="color:#f92672">&lt;</span>PackageDeclaration<span style="color:#f92672">&gt;</span> packageName) {
</span></span><span style="display:flex;"><span>			Document document <span style="color:#f92672">=</span> Document.<span style="color:#a6e22e">from</span>(javaCode, Metadata.<span style="color:#a6e22e">from</span>(DOCUMENT_TYPE, <span style="color:#e6db74">&#34;java&#34;</span>));
</span></span><span style="display:flex;"><span>			document.<span style="color:#a6e22e">metadata</span>().<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#34;package name&#34;</span>, packageName);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> document;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">load</span>(EmbeddingModel embeddingModel, String project) {
</span></span><span style="display:flex;"><span>		JavaDocumentLoader javaLoader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JavaDocumentLoader();
</span></span><span style="display:flex;"><span>		EmbeddingStore<span style="color:#f92672">&lt;</span>TextSegment<span style="color:#f92672">&gt;</span> embeddingStore <span style="color:#f92672">=</span> embeddingStoreSvc.<span style="color:#a6e22e">getEmbeddingStore</span>();
</span></span><span style="display:flex;"><span>		EmbeddingStoreIngestor embeddingStoreIngestor <span style="color:#f92672">=</span> embeddingStoreSvc.<span style="color:#a6e22e">getEmbeddingStoreIngestor</span>(embeddingModel);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Parse all source files</span>
</span></span><span style="display:flex;"><span>		SourceRoot sourceRoot <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SourceRoot(Paths.<span style="color:#a6e22e">get</span>(project));
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>ParseResult<span style="color:#f92672">&lt;</span>CompilationUnit<span style="color:#f92672">&gt;&gt;</span> parseResults;
</span></span><span style="display:flex;"><span>		List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> className <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>			parseResults <span style="color:#f92672">=</span> sourceRoot.<span style="color:#a6e22e">tryToParse</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> (ParseResult<span style="color:#f92672">&lt;</span>CompilationUnit<span style="color:#f92672">&gt;</span> parseResult : parseResults) {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">if</span> (parseResult.<span style="color:#a6e22e">getResult</span>().<span style="color:#a6e22e">isPresent</span>()) {
</span></span><span style="display:flex;"><span>					CompilationUnit unit <span style="color:#f92672">=</span> parseResult.<span style="color:#a6e22e">getResult</span>().<span style="color:#a6e22e">get</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					Document document <span style="color:#f92672">=</span> javaLoader.<span style="color:#a6e22e">load</span>(unit.<span style="color:#a6e22e">toString</span>(), unit.<span style="color:#a6e22e">getPackageDeclaration</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					DocumentSplitter splitter <span style="color:#f92672">=</span> DocumentSplitters.<span style="color:#a6e22e">recursive</span>(100, 0, <span style="color:#66d9ef">new</span> OpenAiTokenizer(GPT_3_5_TURBO));
</span></span><span style="display:flex;"><span>					List<span style="color:#f92672">&lt;</span>TextSegment<span style="color:#f92672">&gt;</span> segments <span style="color:#f92672">=</span> splitter.<span style="color:#a6e22e">split</span>(document);
</span></span><span style="display:flex;"><span>					List<span style="color:#f92672">&lt;</span>Embedding<span style="color:#f92672">&gt;</span> embeddings <span style="color:#f92672">=</span> embeddingModel.<span style="color:#a6e22e">embedAll</span>(segments).<span style="color:#a6e22e">content</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					embeddingStore.<span style="color:#a6e22e">addAll</span>(embeddings, segments);
</span></span><span style="display:flex;"><span>					embeddingStoreIngestor.<span style="color:#a6e22e">ingest</span>(document);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					VoidVisitor<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;&gt;</span> classNameVisitor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClassNameCollector();
</span></span><span style="display:flex;"><span>					classNameVisitor.<span style="color:#a6e22e">visit</span>(unit, className);
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder(<span style="color:#e6db74">&#34;Class name loaded:&#34;</span>);
</span></span><span style="display:flex;"><span>			className.<span style="color:#a6e22e">forEach</span>(classItem <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>				sb.<span style="color:#a6e22e">append</span>(System.<span style="color:#a6e22e">lineSeparator</span>());
</span></span><span style="display:flex;"><span>				sb.<span style="color:#a6e22e">append</span>(classItem);
</span></span><span style="display:flex;"><span>			});
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> sb.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>			e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Unable to load project: &#34;</span> <span style="color:#f92672">+</span> project;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">query</span>(ChatLanguageModel model, EmbeddingModel embeddingModel, String question) {
</span></span><span style="display:flex;"><span>		JavaCodeAgent agent <span style="color:#f92672">=</span> getJavaCodeAgent(model, getRetriever(embeddingModel));
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> agent.<span style="color:#a6e22e">query</span>(question);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Retriever<span style="color:#f92672">&lt;</span>TextSegment<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getRetriever</span>(EmbeddingModel embeddingModel) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> maxResultsRetrieved <span style="color:#f92672">=</span> 3;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">double</span> minScore <span style="color:#f92672">=</span> 0.<span style="color:#a6e22e">6</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> EmbeddingStoreRetriever.<span style="color:#a6e22e">from</span>(embeddingStoreSvc.<span style="color:#a6e22e">getEmbeddingStore</span>(), embeddingModel, maxResultsRetrieved,
</span></span><span style="display:flex;"><span>				minScore);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> JavaCodeAgent <span style="color:#a6e22e">getJavaCodeAgent</span>(ChatLanguageModel model, Retriever<span style="color:#f92672">&lt;</span>TextSegment<span style="color:#f92672">&gt;</span> retriever) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> AiServices.<span style="color:#a6e22e">builder</span>(JavaCodeAgent.<span style="color:#a6e22e">class</span>).<span style="color:#a6e22e">chatLanguageModel</span>(model)
</span></span><span style="display:flex;"><span>				.<span style="color:#a6e22e">chatMemory</span>(MessageWindowChatMemory.<span style="color:#a6e22e">withMaxMessages</span>(20)).<span style="color:#a6e22e">retriever</span>(retriever).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="embeddingstoreservice">EmbeddingStoreService</h3>
<p>To ensure reusability across multiple services, the EmbeddingStoreService has been refactored. This service handles the instantiation and management of the EmbeddingStore and EmbeddingStoreIngestor. Below is the refactored code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.seehiong.ai.service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import static</span> dev.langchain4j.internal.Utils.randomUUID;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.HashMap;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Map;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.document.splitter.DocumentSplitters;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.data.segment.TextSegment;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.model.embedding.EmbeddingModel;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.store.embedding.EmbeddingStore;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.store.embedding.EmbeddingStoreIngestor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> dev.langchain4j.store.embedding.chroma.ChromaEmbeddingStore;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EmbeddingStoreService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> EmbeddingStore<span style="color:#f92672">&lt;</span>TextSegment<span style="color:#f92672">&gt;</span> embeddingStore;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>Object, EmbeddingStoreIngestor<span style="color:#f92672">&gt;</span> embeddingStoreIngestorMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> EmbeddingStore<span style="color:#f92672">&lt;</span>TextSegment<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getEmbeddingStore</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (embeddingStore <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>			embeddingStore <span style="color:#f92672">=</span> ChromaEmbeddingStore.<span style="color:#a6e22e">builder</span>().<span style="color:#a6e22e">baseUrl</span>(<span style="color:#e6db74">&#34;http://127.0.0.1:8000&#34;</span>)
</span></span><span style="display:flex;"><span>					.<span style="color:#a6e22e">collectionName</span>(randomUUID()).<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> embeddingStore;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> EmbeddingStoreIngestor <span style="color:#a6e22e">getEmbeddingStoreIngestor</span>(EmbeddingModel embeddingModel) {
</span></span><span style="display:flex;"><span>		embeddingStoreIngestorMap.<span style="color:#a6e22e">computeIfAbsent</span>(embeddingModel,
</span></span><span style="display:flex;"><span>				key <span style="color:#f92672">-&gt;</span> EmbeddingStoreIngestor.<span style="color:#a6e22e">builder</span>().<span style="color:#a6e22e">documentSplitter</span>(DocumentSplitters.<span style="color:#a6e22e">recursive</span>(500, 0))
</span></span><span style="display:flex;"><span>						.<span style="color:#a6e22e">embeddingModel</span>(embeddingModel).<span style="color:#a6e22e">embeddingStore</span>(getEmbeddingStore()).<span style="color:#a6e22e">build</span>());
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> embeddingStoreIngestorMap.<span style="color:#a6e22e">get</span>(embeddingModel);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="enhancing-controller-functionality">Enhancing Controller Functionality</h2>
<p>In this section, we expand the capabilities of the controller by introducing two new endpoints tailored for interacting with the Java codebase.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AiController</span> {
</span></span><span style="display:flex;"><span>	...
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@Autowired</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">private</span> JavaParsingService javaParsingSvc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/load&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">@RequestParam</span>(<span style="color:#e6db74">&#34;project&#34;</span>) String project) {
</span></span><span style="display:flex;"><span>		String response <span style="color:#f92672">=</span> javaParsingSvc.<span style="color:#a6e22e">load</span>(modelSvc.<span style="color:#a6e22e">getEmbeddingModel</span>(), project);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(response, HttpStatus.<span style="color:#a6e22e">OK</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">@GetMapping</span>(<span style="color:#e6db74">&#34;/query&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">query</span>(<span style="color:#a6e22e">@RequestParam</span>(<span style="color:#e6db74">&#34;question&#34;</span>) String question) {
</span></span><span style="display:flex;"><span>		String response <span style="color:#f92672">=</span> javaParsingSvc.<span style="color:#a6e22e">query</span>(modelSvc.<span style="color:#a6e22e">getLocalModel</span>(), modelSvc.<span style="color:#a6e22e">getEmbeddingModel</span>(), question);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> ResponseEntity<span style="color:#f92672">&lt;&gt;</span>(response, HttpStatus.<span style="color:#a6e22e">OK</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With these enhancements, users can seamlessly load Java projects into the application and query them to gain valuable insights. The controller acts as a bridge, orchestrating interactions between the user and the underlying services, creating a more dynamic and user-friendly AI application.</p>
<hr>
<h2 id="witnessing-it-in-action">Witnessing it in Action</h2>
<p>Continuing the journey from the previous post, we&rsquo;ll now observe the Retrieval-Augmented Generation (RAG) application in action. Before proceeding, ensure that both the Chroma and LocalAI Docker images are up and running.</p>
<h3 id="codebase-ingestion">Codebase Ingestion</h3>
<p>Let&rsquo;s begin by ingesting the codebase for this RAG application. To achieve this, simply provide the folder path of the project root to the API.</p>
<p><img src="/images/rag/rag-load-java-codebase.png" alt="rag-load-java-codebase"></p>
<h3 id="querying-the-codebase-with-gpt4all-j">Querying the Codebase with gpt4all-j</h3>
<p>Now, let&rsquo;s proceed to query the ingested codebase using the gpt4all-j model.</p>
<p><img src="/images/rag/rag-query-java-codebase-gpt4all-j.png" alt="rag-query-java-codebase-gpt4all-j"></p>
<p><img src="/images/rag/rag-query-with-gpt4all-j.png" alt="rag-query-with-gpt4all-j"></p>
<h3 id="comparison-with-wizardlm">Comparison with WizardLM</h3>
<p>Let&rsquo;s compare the results with WizardLM:</p>
<p><img src="/images/rag/rag-query-java-codebase-wizardlm.png" alt="rag-query-java-codebase-wizardlm"></p>
<p><img src="/images/rag/rag-query-with-wizardlm.png" alt="rag-query-with-wizardlm"></p>
<h3 id="comparison-with-openai">Comparison with OpenAI</h3>
<p>Now, let&rsquo;s compare the results with OpenAI:</p>
<p><img src="/images/rag/rag-query-java-codebase-openai.png" alt="rag-query-java-codebase-openai"></p>
<hr>
<h2 id="summary">Summary</h2>
<p>In this section, we observed the RAG application in action, ingested the codebase, and compared the results with other language models such as WizardLM and OpenAI.</p>
<p>This post provides a comprehensive walkthrough of ingesting an entire codebase and setting up endpoints to query a Java codebase using Retrieval-Augmented Generation (RAG) with Langchain4j. The inclusion of comparisons with other language models enhances the understanding of the application&rsquo;s capabilities.</p>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://seehiong.github.io/archives/2023/building-an-ai-application-with-langchain4j/?ref=footer"><span style="font-weight:bold;"> Previous</span><br>Building an AI Application with Langchain4j</a>
        
	    
            <div class="next-post">
                <a href="https://seehiong.github.io/archives/2023/boosting-inference-speed-ssd-and-gpu-acceleration/?ref=footer"><span style="font-weight:bold;">Next </span><br>Boosting Inference Speed: SSD and GPU Acceleration</a>
            </div>
        
    
</div>

  
  <br>
<div class="comments">
    <script>
        const getStoredTheme = () => {
            const themeFromLS = localStorage.getItem("theme");
            const themeFromHugo = document.body.classList.contains("dark-theme") ? "dark" : "light";
            const currentTheme = themeFromLS ? themeFromLS : themeFromHugo;
            return currentTheme;
        };

        const setGiscusTheme = (theme) => {
            const sendMessage = (message) => {
                const iframe = document.querySelector('iframe.giscus-frame');
                if (iframe) {
                    iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
                }
            };
            sendMessage({ setConfig: { theme } });
        };

        document.addEventListener("DOMContentLoaded", () => {
            setGiscusTheme(getStoredTheme());

            const giscusAttributes = {
                "src": "https://giscus.app/client.js",
                "data-repo": "seehiong/seehiong.github.io",
                "data-repo-id": "R_kgDOJg7Puw",
                "data-category": "General",
                "data-category-id": "DIC_kwDOJg7Pu84Cbyhc",
                "data-mapping": "url",
                "data-strict": "0",
                "data-reactions-enabled": "1",
                "data-emit-metadata": "0",
                "data-input-position": "top",
                "data-theme": getStoredTheme(),
                "data-lang": "en",
                "data-loading": "lazy",
                "crossorigin": "anonymous",
                "async": "",
            };

            
            const giscusScript = document.createElement("script");
            Object.entries(giscusAttributes).forEach(
                ([key, value]) => giscusScript.setAttribute(key, value));
            document.querySelector(".comments").appendChild(giscusScript);

            
            const themeSwitcher = document.querySelector(".btn-light-dark");
            if (themeSwitcher) {
                themeSwitcher.addEventListener("click", () => {
                    const currentTheme = getStoredTheme();
                    document.documentElement.classList.toggle("dark", currentTheme);
                    setGiscusTheme(currentTheme);
                });
            }
        });
    </script>
</div>
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#getting-started">Getting Started</a></li>
    <li><a href="#creating-new-services">Creating new Services</a>
      <ul>
        <li><a href="#javaparsingservice">JavaParsingService</a></li>
        <li><a href="#embeddingstoreservice">EmbeddingStoreService</a></li>
      </ul>
    </li>
    <li><a href="#enhancing-controller-functionality">Enhancing Controller Functionality</a></li>
    <li><a href="#witnessing-it-in-action">Witnessing it in Action</a>
      <ul>
        <li><a href="#codebase-ingestion">Codebase Ingestion</a></li>
        <li><a href="#querying-the-codebase-with-gpt4all-j">Querying the Codebase with gpt4all-j</a></li>
        <li><a href="#comparison-with-wizardlm">Comparison with WizardLM</a></li>
        <li><a href="#comparison-with-openai">Comparison with OpenAI</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>

      
    </div>
</div>
  

        </div>
    </body>
</html>


<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>
