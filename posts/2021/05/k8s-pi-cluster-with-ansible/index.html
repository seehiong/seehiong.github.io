<!DOCTYPE html>
<html lang="en">
  <head><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="icon" href="/img/favicon.ico">
    

    <meta property="og:url" content="https://seehiong.github.io/posts/2021/05/k8s-pi-cluster-with-ansible/">
  <meta property="og:site_name" content="See Hiong&#39;s Blog">
  <meta property="og:title" content="K8s Pi Cluster with Ansible">
  <meta property="og:description" content="I documented my journey configuring a Kubernetes Cluster on a Raspberry Pi using Ansible, totaling 50 minutes. I deployed three Raspberry Pi 4 Model B 8GB as master nodes and one Raspberry Pi 3 Model B as a worker. After installing Ansible, Flash, and kubectl, I prepared the SD cards with customized cloud-config.yml files. Ansible inventory was configured accordingly. Additional SSH and system adjustments were made on each node. Customizations were applied, and the Kubernetes cluster setup was initiated using the Ansible playbook. Troubleshooting tips were provided for potential issues. Finally, the Kubernetes Pi Cluster with Ansible was ready for use.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-05-29T20:00:00+08:00">
    <meta property="article:modified_time" content="2021-05-29T20:00:00+08:00">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="K8s">
    <meta property="article:tag" content="Cluster">
    <meta property="article:tag" content="Ansible">
    <meta property="article:tag" content="Raspbernetes">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="K8s Pi Cluster with Ansible">
  <meta name="twitter:description" content="I documented my journey configuring a Kubernetes Cluster on a Raspberry Pi using Ansible, totaling 50 minutes. I deployed three Raspberry Pi 4 Model B 8GB as master nodes and one Raspberry Pi 3 Model B as a worker. After installing Ansible, Flash, and kubectl, I prepared the SD cards with customized cloud-config.yml files. Ansible inventory was configured accordingly. Additional SSH and system adjustments were made on each node. Customizations were applied, and the Kubernetes cluster setup was initiated using the Ansible playbook. Troubleshooting tips were provided for potential issues. Finally, the Kubernetes Pi Cluster with Ansible was ready for use.">

  <meta itemprop="name" content="K8s Pi Cluster with Ansible">
  <meta itemprop="description" content="I documented my journey configuring a Kubernetes Cluster on a Raspberry Pi using Ansible, totaling 50 minutes. I deployed three Raspberry Pi 4 Model B 8GB as master nodes and one Raspberry Pi 3 Model B as a worker. After installing Ansible, Flash, and kubectl, I prepared the SD cards with customized cloud-config.yml files. Ansible inventory was configured accordingly. Additional SSH and system adjustments were made on each node. Customizations were applied, and the Kubernetes cluster setup was initiated using the Ansible playbook. Troubleshooting tips were provided for potential issues. Finally, the Kubernetes Pi Cluster with Ansible was ready for use.">
  <meta itemprop="datePublished" content="2021-05-29T20:00:00+08:00">
  <meta itemprop="dateModified" content="2021-05-29T20:00:00+08:00">
  <meta itemprop="wordCount" content="652">
  <meta itemprop="keywords" content="Raspberry Pi,K8s,Cluster,Ansible,Raspbernetes"><title>K8s Pi Cluster with Ansible | See Hiong&#39;s Blog</title>

    <link rel="canonical" href="https://seehiong.github.io/posts/2021/05/k8s-pi-cluster-with-ansible/">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    
    <link rel="stylesheet" href="/css/variables.css">
    
    <link rel="stylesheet" href="/css/base.css">
    
    <link rel="stylesheet" href="/css/layout.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/cards.css">
    
    <link rel="stylesheet" href="/css/content_elements.css">
    
    <link rel="stylesheet" href="/css/codeblocks.css">
    
    <link rel="stylesheet" href="/css/page_specific.css">
    
    <link rel="stylesheet" href="/css/shortcodes.css">
    
    <link rel="stylesheet" href="/css/components.css">
    
    <link rel="stylesheet" href="/css/animations.css">
    
    <link rel="stylesheet" href="/css/media_queries.css">
    
    <link rel="stylesheet" href="/css/quantum-theme.css">
    

    
    <script>
      (function() {
        var theme = localStorage.getItem('theme');
        var H = document.documentElement;
        if (theme === 'dark-mode') {
          H.classList.add('dark-mode');
        } else if (theme === 'light-mode') {
          H.classList.remove('dark-mode');
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          H.classList.add('dark-mode');
        }
      })();
    </script>
</head></head>
  <body class="page-article"><nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/" class="nav-logo-link" title="See Hiong&#39;s Blog - Home">
          
          
          <img src="/images/blog_logo.png" alt="See Hiong&#39;s Blog Logo" class="nav-logo-image">
        </a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            
            
            <a href="/posts/" class="nav-item-content active">Archives</a>
            
          </div>
          
          
          <div class="nav-item-wrapper">
            <a href="/tags/" class="nav-item-content ">Tags</a>
          </div>
          <div class="nav-item-wrapper">
            <a href="/about/" class="nav-item-content ">About</a>
          </div>
          <div class="nav-item-wrapper nav-search-toggle-wrapper">
            <button id="nav-search-toggle" class="nav-item-button" aria-label="Toggle search" title="Search">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" class="nav-item-icon">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </button>
          </div>
          
          
          <button id="theme-toggle" class="nav-item-button" aria-label="Toggle theme"></button> 
        </div>
      </div>
    </div>
  </div>
</nav>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const themeToggle = document.getElementById('theme-toggle');
    const H = document.documentElement; 

    if (H.classList.contains('dark-mode')) {
      themeToggle.textContent = 'Light Mode';
    } else {
      themeToggle.textContent = 'Dark Mode';
    }

    themeToggle.addEventListener('click', function() {
      H.classList.toggle('dark-mode');
      if (H.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark-mode');
        themeToggle.textContent = 'Light Mode';
      } else {
        localStorage.setItem('theme', 'light-mode');
        themeToggle.textContent = 'Dark Mode';
      }
    });
  });
</script><div id="content-wrapper">
        <main class="container" id="main-content">
<div class="main-content-area">
  <article class="post-layout container">

    <header class="post-header">
      <h1 class="post-title">K8s Pi Cluster with Ansible</h1>

      <div class="post-meta">
        <span class="post-meta__date">
          <time datetime="2021-05-29T20:00:00&#43;08:00">May 29, 2021</time>
        </span>

        
          <span class="post-meta__author">Written by See Hiong</span>
        

        
          <span class="post-meta__tags">
            In:
            
              <a href="/tags/raspberry-pi">Raspberry Pi</a>
            
              , <a href="/tags/k8s">K8s</a>
            
              , <a href="/tags/cluster">Cluster</a>
            
              , <a href="/tags/ansible">Ansible</a>
            
              , <a href="/tags/raspbernetes">Raspbernetes</a>
            
          </span>
        

        
      </div>
    </header>

    
      
      
      <div class="post-cover-container post-cover--artistic-blur-wrapper">
        
          <div class="post-cover-blur-background" style="--bg-image: url('/images/ansible/highly-available-kubernetes-pi-cluster.png');"></div>
          <img src="/images/ansible/highly-available-kubernetes-pi-cluster.png" alt="K8s Pi Cluster with Ansible cover image" class="post-cover-image post-cover-image--artistic-blur">
        
      </div>
    

    <section class="post-content">
      <p>By provisioning a Kubernetes PI Cluster with Ansible, you can easily spin off a Raspberry PI cluster</p>
<h1 id="kubernetes-cluster-with-ansible">Kubernetes Cluster with Ansible</h1>
<p><em>(Total Setup Time: 50 mins)</em></p>
<p>In this guide, I will configure a Kubernetes Cluster using 






  <a href="https://www.ansible.com/" target="_blank" rel="noopener noreferrer" >Ansible</a>
. This guide follows closely to the 






  <a href="https://github.com/raspbernetes/k8s-cluster-installation" target="_blank" rel="noopener noreferrer" >Raspbernetes Cluster Installation</a>
. I will be using 3x Raspberry Pi 4 Model B 8GB as the master nodes and 1x Raspberry Pi 3 Model B as the only worker node.</p>
<p>You need to install 






  <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#installing-ansible-on-ubuntu" target="_blank" rel="noopener noreferrer" >ansible</a>
, 






  <a href="https://github.com/hypriot/flash" target="_blank" rel="noopener noreferrer" >flash</a>
 and 






  <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener noreferrer" >kubectl</a>
. I installed both Ansible and Flash onto my 






  <a href="https://elementary.io/" target="_blank" rel="noopener noreferrer" >elementary OS</a>
 host by:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a">#Installing Ansible</span>
</span></span><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install software-properties-common
</span></span><span style="display:flex;"><span>sudo add-apt-repository --yes --update ppa:ansible/ansible
</span></span><span style="display:flex;"><span>sudo apt install ansible
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#Installing Flash</span>
</span></span><span style="display:flex;"><span>curl -LO https://github.com/hypriot/flash/releases/download/2.7.0/flash
</span></span><span style="display:flex;"><span>cdmod +x flash
</span></span><span style="display:flex;"><span>sudo mv flash /usr/local/bin/flash
</span></span><span style="display:flex;"><span>sudo apt-get install -y pv curl python-pip unzip hdparm
</span></span><span style="display:flex;"><span>sudo pip install awscli</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h2 id="preparation">Preparation</h2>
<p><em>(20 mins)</em></p>
<p>Firstly, downloads the Ubuntu 20.04 image and unzips it:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -L <span style="color:#0a3069">&#34;http://cdimage.ubuntu.com/releases/20.04.2/release/ubuntu-20.04.2-preinstalled-server-arm64+raspi.img.xz&#34;</span> -o ~/Downloads/ubuntu-20.04.2-preinstalled-server-arm64+raspi.img.xz
</span></span><span style="display:flex;"><span>unxz -T <span style="color:#0550ae">0</span> ~/Downloads/ubuntu-20.04.2-preinstalled-server-arm64+raspi.img.xz</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Secondly, clones the 






  <a href="https://github.com/raspbernetes/k8s-cluster-installation" target="_blank" rel="noopener noreferrer" >Raspbernetes repository</a>
 and makes the necessary changes (hostname, users.name, ssh_authorized_keys, etho0.addresses and gateway4) to the cloud-init file. I have created 4x cloud-config.yml for each of the 64GB SD card:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/raspbernetes/k8s-cluster-installation.git
</span></span><span style="display:flex;"><span><span style="color:#6639ba">cd</span> k8s-cluster-installation
</span></span><span style="display:flex;"><span>vi setup/cloud-config.yml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#Create the 4x SD cards ubuntu image using Flash</span>
</span></span><span style="display:flex;"><span>sudo flash --userdata cloud-config.yml ~/Downloads/ubuntu-20.04.2-preinstalled-server-arm64+raspi.img</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Thirdly, ensures that Ansible inventory is changed according to hostname, username and IP addresses for each SD card.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vi ansible/inventory</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span>#<span style="color:#1f2328">My</span> <span style="color:#1f2328">setup</span> <span style="color:#1f2328">as</span> <span style="color:#1f2328">reference</span>
</span></span><span style="display:flex;"><span>[<span style="color:#1f2328">masters</span>]
</span></span><span style="display:flex;"><span><span style="color:#1f2328">master1</span> <span style="color:#1f2328">hostname</span><span style="color:#1f2328">=</span><span style="color:#1f2328">master1</span> <span style="color:#1f2328">ansible_host</span><span style="color:#1f2328">=</span><span style="color:#0550ae">192</span>.<span style="color:#0550ae">168</span>.<span style="color:#0550ae">100</span>.<span style="color:#0550ae">180</span> <span style="color:#1f2328">ansible_user</span><span style="color:#1f2328">=</span><span style="color:#1f2328">ubuntu</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">master2</span> <span style="color:#1f2328">hostname</span><span style="color:#1f2328">=</span><span style="color:#1f2328">master2</span> <span style="color:#1f2328">ansible_host</span><span style="color:#1f2328">=</span><span style="color:#0550ae">192</span>.<span style="color:#0550ae">168</span>.<span style="color:#0550ae">100</span>.<span style="color:#0550ae">181</span> <span style="color:#1f2328">ansible_user</span><span style="color:#1f2328">=</span><span style="color:#1f2328">ubuntu</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">master3</span> <span style="color:#1f2328">hostname</span><span style="color:#1f2328">=</span><span style="color:#1f2328">master3</span> <span style="color:#1f2328">ansible_host</span><span style="color:#1f2328">=</span><span style="color:#0550ae">192</span>.<span style="color:#0550ae">168</span>.<span style="color:#0550ae">100</span>.<span style="color:#0550ae">182</span> <span style="color:#1f2328">ansible_user</span><span style="color:#1f2328">=</span><span style="color:#1f2328">ubuntu</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#1f2328">workers</span>]
</span></span><span style="display:flex;"><span><span style="color:#1f2328">worker1</span> <span style="color:#1f2328">hostname</span><span style="color:#1f2328">=</span><span style="color:#1f2328">worker1</span> <span style="color:#1f2328">ansible_host</span><span style="color:#1f2328">=</span><span style="color:#0550ae">192</span>.<span style="color:#0550ae">168</span>.<span style="color:#0550ae">100</span>.<span style="color:#0550ae">188</span> <span style="color:#1f2328">ansible_user</span><span style="color:#1f2328">=</span><span style="color:#1f2328">ubuntu</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#<span style="color:#1f2328">Ensures</span> <span style="color:#1f2328">that</span> <span style="color:#1f2328">you</span> <span style="color:#1f2328">are</span> <span style="color:#1f2328">able</span> <span style="color:#1f2328">to</span> <span style="color:#1f2328">ping</span> <span style="color:#1f2328">all</span> <span style="color:#1f2328">nodes</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">env</span> <span style="color:#1f2328">ANSIBLE_CONFIG</span><span style="color:#1f2328">=</span><span style="color:#1f2328">ansible</span>/<span style="color:#1f2328">ansible</span>.<span style="color:#1f2328">cfg</span> <span style="color:#1f2328">ansible</span> <span style="color:#1f2328">all</span> <span style="color:#1f2328">-</span><span style="color:#1f2328">m</span> <span style="color:#1f2328">ping</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Fourthly, prior to the cluster setup, I ssh into each of the nodes and run the following.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ssh ubuntu@master1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sudo -i
</span></span><span style="display:flex;"><span>systemctl stop apt-daily.timer
</span></span><span style="display:flex;"><span>systemctl disable apt-daily.timer
</span></span><span style="display:flex;"><span>systemctl mask apt-daily.service
</span></span><span style="display:flex;"><span>systemctl daemon-reload
</span></span><span style="display:flex;"><span>reboot</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>These are some of my customizations:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span># <span style="color:#1f2328">group_vars</span>/<span style="color:#1f2328">all</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">26</span>: <span style="color:#1f2328">keepalived_vip</span>: <span style="color:#0a3069">&#39;192.168.100.200&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">32</span>: <span style="color:#1f2328">cri_plugin</span>: <span style="color:#1f2328">docker</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">38</span>: <span style="color:#1f2328">cni_plugin</span>: <span style="color:#0a3069">&#39;calico&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">group_var</span>/<span style="color:#1f2328">masters</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">16</span>: <span style="color:#1f2328">cluster_kube_proxy_enabled</span>:<span style="color:#1f2328">true</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">23</span>: <span style="color:#1f2328">cni_plugin</span>: <span style="color:#0a3069">&#39;calico&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/cluster/</span><span style="color:#1f2328">defaults</span><span style="color:#0a3069">/main/</span><span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">101</span>: <span style="color:#1f2328">docker</span>: <span style="color:#0a3069">&#39;unix:///run/containerd/containerd.sock&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/clusters/</span><span style="color:#1f2328">templates</span>/<span style="color:#1f2328">kubeadm</span><span style="color:#1f2328">-</span><span style="color:#1f2328">config</span>.<span style="color:#1f2328">yaml</span>.<span style="color:#1f2328">j2</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">25</span>: <span style="color:#1f2328">criSocket</span>: <span style="color:#1f2328">unix</span>:<span style="color:#0a3069">///run/</span><span style="color:#1f2328">containerd</span>/<span style="color:#1f2328">containerd</span>.<span style="color:#1f2328">sock</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/clusters/</span><span style="color:#1f2328">templates</span>/<span style="color:#1f2328">kubeadm</span><span style="color:#1f2328">-</span><span style="color:#1f2328">join</span>.<span style="color:#1f2328">yaml</span>.<span style="color:#1f2328">j2</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">26</span>: <span style="color:#1f2328">criSocket</span>: <span style="color:#1f2328">unix</span>:<span style="color:#0a3069">///run/</span><span style="color:#1f2328">containerd</span>/<span style="color:#1f2328">containerd</span>.<span style="color:#1f2328">sock</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/cni/</span><span style="color:#1f2328">defaults</span>/<span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">3</span>: <span style="color:#1f2328">cni_bgp_peer_address</span>: <span style="color:#0550ae">192</span>.<span style="color:#0550ae">168</span>.<span style="color:#0550ae">100</span>.<span style="color:#0550ae">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/common/</span><span style="color:#1f2328">tasks</span>/<span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span> <span style="color:#1f2328">(</span><span style="color:#1f2328">added</span> <span style="color:#1f2328">to</span> <span style="color:#1f2328">line</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">-</span> <span style="color:#1f2328">name</span>: <span style="color:#1f2328">Bugfix</span> <span style="color:#1f2328">for</span> <span style="color:#1f2328">Ubuntu</span> <span style="color:#0550ae">20</span>.<span style="color:#0550ae">04</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">set_fact</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">ansible_os_family</span>: <span style="color:#0a3069">&#34;debian&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/container-runtime/</span><span style="color:#1f2328">containerd</span><span style="color:#0a3069">/defaults/</span><span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">9</span>: <span style="color:#1f2328">containerd_use_docker_repo</span>: <span style="color:#1f2328">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/container-runtime/</span><span style="color:#1f2328">containerd</span><span style="color:#0a3069">/defaults/</span><span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span> <span style="color:#1f2328">(</span><span style="color:#1f2328">added</span> <span style="color:#1f2328">to</span> <span style="color:#1f2328">line</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">Instructions</span>: <span style="color:#1f2328">https</span>:<span style="color:#0a3069">//</span><span style="color:#1f2328">docs</span>.<span style="color:#1f2328">docker</span>.<span style="color:#1f2328">com</span><span style="color:#0a3069">/engine/</span><span style="color:#1f2328">install</span><span style="color:#0a3069">/ubuntu/</span>#<span style="color:#1f2328">install</span><span style="color:#1f2328">-</span><span style="color:#1f2328">using</span><span style="color:#1f2328">-</span><span style="color:#1f2328">the</span><span style="color:#1f2328">-</span><span style="color:#1f2328">repository</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">-</span> <span style="color:#1f2328">name</span>: <span style="color:#1f2328">Add</span> <span style="color:#1f2328">Docker</span>’<span style="color:#1f2328">s</span> <span style="color:#1f2328">official</span> <span style="color:#1f2328">GPG</span> <span style="color:#1f2328">key</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">apt_key</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">url</span>: <span style="color:#1f2328">https</span>:<span style="color:#0a3069">//</span><span style="color:#1f2328">download</span>.<span style="color:#1f2328">docker</span>.<span style="color:#1f2328">com</span><span style="color:#0a3069">/linux/</span><span style="color:#1f2328">ubuntu</span>/<span style="color:#1f2328">gpg</span>
</span></span><span style="display:flex;"><span>	<span style="color:#1f2328">state</span>: <span style="color:#1f2328">present</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span><span style="color:#1f2328">-</span> <span style="color:#1f2328">name</span>: <span style="color:#1f2328">Add</span> <span style="color:#1f2328">apt</span> <span style="color:#1f2328">repository</span> <span style="color:#1f2328">for</span> <span style="color:#1f2328">Docker</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">apt_repository</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">repo</span>: <span style="color:#1f2328">deb</span> [<span style="color:#1f2328">arch</span><span style="color:#1f2328">=</span><span style="color:#1f2328">amd64</span> <span style="color:#1f2328">signed</span><span style="color:#1f2328">-</span><span style="color:#1f2328">by</span><span style="color:#1f2328">=</span><span style="color:#0a3069">/usr/</span><span style="color:#1f2328">share</span><span style="color:#0a3069">/keyrings/</span><span style="color:#1f2328">docker</span><span style="color:#1f2328">-</span><span style="color:#1f2328">archive</span><span style="color:#1f2328">-</span><span style="color:#1f2328">keyring</span>.<span style="color:#1f2328">gpg</span>] <span style="color:#1f2328">https</span>:<span style="color:#0a3069">//</span><span style="color:#1f2328">download</span>.<span style="color:#1f2328">docker</span>.<span style="color:#1f2328">com</span><span style="color:#0a3069">/linux/</span><span style="color:#1f2328">ubuntu</span> <span style="color:#1f2328">focal</span> <span style="color:#1f2328">stable</span>  
</span></span><span style="display:flex;"><span>	<span style="color:#1f2328">state</span>: <span style="color:#1f2328">present</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">regiser</span>: <span style="color:#1f2328">docker_repository</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">until</span>: <span style="color:#1f2328">docker_repository</span> <span style="color:#1f2328">is</span> <span style="color:#1f2328">success</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/container-runtime/</span><span style="color:#1f2328">defaults</span>/<span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">2</span>: <span style="color:#1f2328">cri_plugin</span>: <span style="color:#0a3069">&#39;docker&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/container-runtime/</span><span style="color:#1f2328">docker</span><span style="color:#0a3069">/defaults/</span><span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span> 
</span></span><span style="display:flex;"><span><span style="color:#0550ae">12</span>: #<span style="color:#1f2328">-</span> <span style="color:#1f2328">docker</span><span style="color:#1f2328">-</span><span style="color:#1f2328">ce</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">13</span>: #<span style="color:#1f2328">-</span> <span style="color:#1f2328">docker</span><span style="color:#1f2328">-</span><span style="color:#1f2328">ce</span><span style="color:#1f2328">-</span><span style="color:#1f2328">cli</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">14</span>: #<span style="color:#1f2328">-</span> <span style="color:#1f2328">containerd</span>.<span style="color:#1f2328">io</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">15</span>: <span style="color:#1f2328">-</span> <span style="color:#1f2328">docker</span>.<span style="color:#1f2328">io</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/container-runtime/</span><span style="color:#1f2328">vars</span>/<span style="color:#1f2328">main</span>.<span style="color:#1f2328">yml</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">23</span>: <span style="color:#1f2328">docker</span>: <span style="color:#0a3069">&#39;unix:///run/containerd/containerd.sock&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># <span style="color:#1f2328">roles</span><span style="color:#0a3069">/haproxy/</span><span style="color:#1f2328">templates</span>/<span style="color:#1f2328">haproxy</span>.<span style="color:#1f2328">cfg</span>.<span style="color:#1f2328">j2</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">22</span>: <span style="color:#1f2328">server</span> {{<span style="color:#1f2328">hostvars</span>[<span style="color:#1f2328">host</span>][<span style="color:#0a3069">&#39;hostname&#39;</span>] }} {{<span style="color:#1f2328">hostvars</span>[<span style="color:#1f2328">host</span>][<span style="color:#0a3069">&#39;ansible_host&#39;</span>] }}:<span style="color:#0550ae">6433</span> <span style="color:#1f2328">check</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h2 id="installation">Installation</h2>
<p><em>(30 mins)</em></p>
<p>First, you may start the Kubernetes cluster setup by running 






  <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks.html" target="_blank" rel="noopener noreferrer" >Ansible playbook</a>
:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>env <span style="color:#953800">ANSIBLE_CONFIG</span><span style="color:#0550ae">=</span>ansible/ansible.cfg ansible-playbook ansible/playbooks/all.yml</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Second, when installation completes, you may copy contents of <em>ansible/playbooks/output/k8s-config.yaml</em> to your local machine:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a"># Create a kube folder in host machine</span>
</span></span><span style="display:flex;"><span>mkdir ~/.kube
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Paste copied content into config file</span>
</span></span><span style="display:flex;"><span>vi ~/.kube/config
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get nodes</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/ansible/kubectl-get-nodes.png"   alt="kubectl-get-nodes" class="sc-image sc-image-default"
       >


<p>Finally, the Kubernetes PI Cluster with Ansible is ready for play! If you are interested in creating a HA cluster, you may refer to 






  <a href="/posts/2020/08/ha-k8s-pi-cluster-i/" >my previous post</a>
</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="if-blkrrpart-failed-device-or-resource-busy">if BLKRRPART failed: Device or resource busy</h3>
<p>If you face similar error as above, you may comment out line 410 in flash script:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vi /usr/local/bin/flash</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span>#<span style="color:#1f2328">sudo</span> <span style="color:#1f2328">hdparm</span> <span style="color:#1f2328">-</span><span style="color:#1f2328">z</span> <span style="color:#0a3069">&#34;$1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">sleep</span> <span style="color:#0550ae">1</span>m</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h3 id="msg-only-python3-is-supported-youre-running-2717-locally">msg: Only python3 is supported, you&rsquo;re running 2.7.17 locally</h3>
<p>If you encouter this issue, you may install 






  <a href="https://docs.python-guide.org/starting/install3/linux/" target="_blank" rel="noopener noreferrer" >Python 3</a>
 and try re-running the playbook with the interpreter setting:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>env <span style="color:#953800">ANSIBLE_CONFIG</span><span style="color:#0550ae">=</span>ansible/ansible.cfg ansible-playbook ansible/playbooks/all.yml -e <span style="color:#953800">ansible_python_interpreter</span><span style="color:#0550ae">=</span>/usr/bin/python3</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h3 id="please-ensure-that-the-cluster-has-a-stable-controlplaneendpoint-address-the-certificates-that-must-be-shared-among-control-plane-instances-are-provided">Please ensure that: <em>The cluster has a stable controlPlaneEndpoint address.</em> The certificates that must be shared among control plane instances are provided.</h3>
<p>If you face this issue during ansible setup, you may need to ssh ubuntu@master1:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo -i
</span></span><span style="display:flex;"><span>vi /etc/kubernetes/kubeadm-join.yaml</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-vim" data-lang="vim"><span style="display:flex;"><span>#<span style="color:#1f2328">modify</span> <span style="color:#1f2328">apiServerEndpoint</span> <span style="color:#1f2328">to</span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">192</span>.<span style="color:#0550ae">168</span>.<span style="color:#0550ae">100</span>.<span style="color:#0550ae">180</span>:<span style="color:#0550ae">6443</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
    </section>

    <nav class="post-navigation">
      <div class="nav-links">
        
        
          <div class="nav-next">
            <a href="/posts/2021/06/pi-cluster-with-longhorn/" rel="next">
              <span class="meta-nav">Next →</span>
              <span class="post-title">Pi Cluster with Longhorn</span>
            </a>
          </div>
        
      </div>
    </nav>

    
<div class="giscus-comments-container">
</div>

<script>
  (function() {
    'use strict';

    const getGiscusTheme = () => {
      const storedTheme = localStorage.getItem('theme'); 
      if (storedTheme) {
        return storedTheme === 'dark-mode' ? 'dark' : 'light';
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };

    const setGiscusFrameTheme = (theme) => {
      const iframe = document.querySelector('iframe.giscus-frame');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({ giscus: { setConfig: { theme: theme } } }, 'https://giscus.app');
      }
    };

    const loadGiscus = () => {
      const giscusContainer = document.querySelector('.giscus-comments-container');
      if (!giscusContainer) {
        console.warn('Giscus container not found.');
        return;
      }

      while (giscusContainer.firstChild) {
        giscusContainer.removeChild(giscusContainer.firstChild);
      }

      const giscusScript = document.createElement('script');
      const giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo":             "seehiong\/seehiong.github.io",
        "data-repo-id":          "R_kgDOJg7Puw",
        "data-category":         "General",
        "data-category-id":      "DIC_kwDOJg7Pu84Cbyhc",
        "data-mapping":          "url", 
        "data-strict":           "0",
        "data-reactions-enabled":"1",
        "data-emit-metadata":    "0",
        "data-input-position":   "top", 
        "data-theme":            getGiscusTheme(), 
        "data-lang":             "en",
        "data-loading":          "lazy",
        "crossorigin":           "anonymous",
        "async":                 "true", 
      };

      if (!giscusAttributes["data-repo"] || !giscusAttributes["data-repo-id"] || !giscusAttributes["data-category-id"]) {
          console.error("Giscus parameters (giscusRepo, giscusRepoId, giscusCategoryId) are not configured in hugo.toml.");
          giscusContainer.innerHTML = "<p style='color: var(--text-secondary);'>Giscus comments are not configured correctly. Please check site parameters.</p>";
          return;
      }

      Object.entries(giscusAttributes).forEach(
        ([key, value]) => giscusScript.setAttribute(key, value)
      );
      giscusContainer.appendChild(giscusScript);
    };

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadGiscus);
    } else {
        loadGiscus();
    }

    const htmlElement = document.documentElement;
    const observer = new MutationObserver((mutationsList) => {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          setGiscusFrameTheme(getGiscusTheme());
        }
      }
    });
    observer.observe(htmlElement, { attributes: true });

  })();
</script>


  </article>
</div>
</main>
    </div>

    
    <div id="search-modal-overlay" class="search-modal-overlay" style="display: none;">
      <div id="search-modal-content" class="search-modal-content">
        <button id="search-modal-close" class="search-modal-close" aria-label="Close search" title="Close search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
        <input type="search" id="modal-search-input" class="modal-search-input" placeholder="Search content..." aria-label="Search input">
        <div id="modal-search-results" class="modal-search-results">
        </div>
      </div>
    </div>
    

  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js" defer></script>
  <script>
    (function() {
      'use strict';

      window.addEventListener('DOMContentLoaded', () => {
        const searchModalOverlay = document.getElementById('search-modal-overlay');
        const searchModalContent = document.getElementById('search-modal-content');
        const searchModalCloseButton = document.getElementById('search-modal-close');
        const searchToggleButton = document.getElementById('nav-search-toggle');
        const searchInputTarget = document.getElementById('modal-search-input');
        const searchResultsTarget = document.getElementById('modal-search-results');

        let fuseInstance = null;
        let searchData = [];

        const loadSearchData = async () => {
          if (searchData.length === 0 && !fuseInstance) {
            try {
              const response = await fetch('\/index.json');
              if (!response.ok) {
                throw new Error(`HTTP error loading index.json! status: ${response.status}`);
              }
              searchData = await response.json();
              initializeFuse();
            } catch (e) {
              console.error("[SearchSetup] Error loading search data:", e);
              if (searchResultsTarget) searchResultsTarget.innerHTML = "<p>Error loading search index.</p>";
            }
          } else if (searchData.length > 0 && !fuseInstance){
            initializeFuse();
          }
        };

        const initializeFuse = () => {
          if (searchData.length > 0 && !fuseInstance) {
            const options = {
              keys: [
                { name: 'title', weight: 0.7 }, { name: 'summary', weight: 0.5 },
                { name: 'content', weight: 0.3 }, { name: 'tags', weight: 0.4 }
              ],
              includeScore: true, threshold: 0.4, minMatchCharLength: 2,
            };
            fuseInstance = new Fuse(searchData, options);
          }
        };

        const performSearch = () => {
          if (!fuseInstance || !searchInputTarget || !searchResultsTarget) return;
          const query = searchInputTarget.value.trim();
          searchResultsTarget.innerHTML = '';
          if (query.length < 2) return;

          const results = fuseInstance.search(query);
          if (results.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'search-results-list';
            results.slice(0, 10).forEach(result => {
              const item = result.item;
              const li = document.createElement('li');
              li.className = 'search-result-item';
              const a = document.createElement('a');
              a.href = item.permalink;
              a.textContent = item.title;
              li.appendChild(a);
              ul.appendChild(li);
            });
            searchResultsTarget.appendChild(ul);
          } else {
            searchResultsTarget.innerHTML = '<p>No results found.</p>';
          }
        };

        const openSearchModal = async () => {
          await loadSearchData();
          if (searchInputTarget) searchInputTarget.value = '';
          if (searchResultsTarget) searchResultsTarget.innerHTML = '';

          if (searchModalOverlay) {
            searchModalOverlay.style.display = 'flex';
            setTimeout(() => searchModalOverlay.classList.add('active'), 10);
          } else { return; }

          if (searchInputTarget) setTimeout(() => searchInputTarget.focus(), 50);
          if (searchToggleButton) searchToggleButton.classList.add('active');
        };

        const closeSearchModal = () => {
          if (searchModalOverlay) {
            searchModalOverlay.classList.remove('active');
            setTimeout(() => searchModalOverlay.style.display = 'none', 300);
          }
          if (searchToggleButton) searchToggleButton.classList.remove('active');
        };

        if (searchToggleButton) {
          searchToggleButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (searchModalOverlay && searchModalOverlay.classList.contains('active')) {
              closeSearchModal();
            } else {
              openSearchModal();
            }
          });
        } else { console.error("[SearchSetup] #nav-search-toggle button not found."); }

        if (searchModalCloseButton) { searchModalCloseButton.addEventListener('click', closeSearchModal); }
        if (searchModalOverlay && searchModalContent) {
          searchModalOverlay.addEventListener('click', (event) => {
            if (event.target === searchModalOverlay) closeSearchModal();
          });
        }
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && searchModalOverlay && searchModalOverlay.classList.contains('active')) {
            closeSearchModal();
          }
        });
        if (searchInputTarget) {
          let debounceTimer;
          searchInputTarget.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(performSearch, 300);
          });
        }
      });
    })();
  </script>

    

    

  <script>
    MathJax = {
      tex: {
        displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        inlineMath: [['\\(', '\\)']], 
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams' 
      },
      svg: {
        fontCache: 'global' 
      },
      chtml: {
        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], 
        ignoreHtmlClass: 'tex2jax_ignore', 
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<footer class="footer-main simplified-footer">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="footer-content">
        <div class="copyright-line">
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> © 2025 See Hiong. All rights reserved.
        </div>
        <div class="social-links">
          
            <a href="https://github.com/seehiong" target="_blank" title="GitHub" class="social-link" aria-label="GitHub">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
          
            <a href="https://www.linkedin.com/in/seehiong/" target="_blank" title="LinkedIn" class="social-link" aria-label="LinkedIn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
          
          
            <a href="/index.xml" target="_blank" title="RSS" class="social-link" aria-label="RSS Feed">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
            </a>
          
        </div>
      </div>
    </div>
  </div>
</footer>
        <script src="/js/animation.js" defer></script>
    
        <script src="/js/code-copy.js" defer></script>
    
        <script src="/js/scroll-header.js" defer></script>
       
  </body>
</html>