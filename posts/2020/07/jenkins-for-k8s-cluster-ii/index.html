<!DOCTYPE html>
<html lang="en">
  <head><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="icon" href="/img/favicon.ico">
    

    <meta property="og:url" content="https://seehiong.github.io/posts/2020/07/jenkins-for-k8s-cluster-ii/">
  <meta property="og:site_name" content="See Hiong&#39;s Blog">
  <meta property="og:title" content="Jenkins for K8s Cluster (II)">
  <meta property="og:description" content="I’ve successfully set up Jenkins Agents for my Kubernetes Cluster, enhancing its capabilities for automated build, test, and scalable deployment pipelines. Following Docker image creation for the Jenkins agent on the Raspberry Pi, I configured Jenkins for scalability. Adjustments included setting the inbound agent protocol and configuring Kubernetes cloud settings. Creating Jenkins jobs and scheduling builds demonstrated the functionality, with agents initially suspended and later executing jobs successfully. The troubleshooting tip highlighted the importance of naming the container as jnlp. My Jenkins on Kubernetes Cluster is now fully operational, ready for future pipeline configurations.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-07-19T20:00:00+08:00">
    <meta property="article:modified_time" content="2020-07-19T20:00:00+08:00">
    <meta property="article:tag" content="Raspberry Pi">
    <meta property="article:tag" content="K8s">
    <meta property="article:tag" content="Cluster">
    <meta property="article:tag" content="Jenkins">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Jenkins for K8s Cluster (II)">
  <meta name="twitter:description" content="I’ve successfully set up Jenkins Agents for my Kubernetes Cluster, enhancing its capabilities for automated build, test, and scalable deployment pipelines. Following Docker image creation for the Jenkins agent on the Raspberry Pi, I configured Jenkins for scalability. Adjustments included setting the inbound agent protocol and configuring Kubernetes cloud settings. Creating Jenkins jobs and scheduling builds demonstrated the functionality, with agents initially suspended and later executing jobs successfully. The troubleshooting tip highlighted the importance of naming the container as jnlp. My Jenkins on Kubernetes Cluster is now fully operational, ready for future pipeline configurations.">

  <meta itemprop="name" content="Jenkins for K8s Cluster (II)">
  <meta itemprop="description" content="I’ve successfully set up Jenkins Agents for my Kubernetes Cluster, enhancing its capabilities for automated build, test, and scalable deployment pipelines. Following Docker image creation for the Jenkins agent on the Raspberry Pi, I configured Jenkins for scalability. Adjustments included setting the inbound agent protocol and configuring Kubernetes cloud settings. Creating Jenkins jobs and scheduling builds demonstrated the functionality, with agents initially suspended and later executing jobs successfully. The troubleshooting tip highlighted the importance of naming the container as jnlp. My Jenkins on Kubernetes Cluster is now fully operational, ready for future pipeline configurations.">
  <meta itemprop="datePublished" content="2020-07-19T20:00:00+08:00">
  <meta itemprop="dateModified" content="2020-07-19T20:00:00+08:00">
  <meta itemprop="wordCount" content="663">
  <meta itemprop="keywords" content="Raspberry Pi,K8s,Cluster,Jenkins"><title>Jenkins for K8s Cluster (II) | See Hiong&#39;s Blog</title>

    <link rel="canonical" href="https://seehiong.github.io/posts/2020/07/jenkins-for-k8s-cluster-ii/">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    
    <link rel="stylesheet" href="/css/variables.css">
    
    <link rel="stylesheet" href="/css/base.css">
    
    <link rel="stylesheet" href="/css/layout.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/cards.css">
    
    <link rel="stylesheet" href="/css/content_elements.css">
    
    <link rel="stylesheet" href="/css/codeblocks.css">
    
    <link rel="stylesheet" href="/css/page_specific.css">
    
    <link rel="stylesheet" href="/css/shortcodes.css">
    
    <link rel="stylesheet" href="/css/components.css">
    
    <link rel="stylesheet" href="/css/animations.css">
    
    <link rel="stylesheet" href="/css/media_queries.css">
    
    <link rel="stylesheet" href="/css/quantum-theme.css">
    

    
    <script>
      (function() {
        var theme = localStorage.getItem('theme');
        var H = document.documentElement;
        if (theme === 'dark-mode') {
          H.classList.add('dark-mode');
        } else if (theme === 'light-mode') {
          H.classList.remove('dark-mode');
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          H.classList.add('dark-mode');
        }
      })();
    </script>
</head></head>
  <body class="page-article"><nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/" class="nav-logo-link" title="See Hiong&#39;s Blog - Home">
          <span class="nav-site-title">
            <span class="nav-site-title__main">SEE HIONG’S</span>
            <span class="nav-site-title__sub">BLOG</span>
          </span>
        </a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            
            
            <a href="/posts/" class="nav-item-content active">Archives</a>
            
          </div>
          
          
          <div class="nav-item-wrapper">
            <a href="/tags/" class="nav-item-content ">Tags</a>
          </div>
          <div class="nav-item-wrapper">
            <a href="/about/" class="nav-item-content ">About</a>
          </div>
          <div class="nav-item-wrapper nav-search-toggle-wrapper">
            <button id="nav-search-toggle" class="nav-item-button" aria-label="Toggle search" title="Search">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" class="nav-item-icon">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </button>
          </div>
          
          
          <button id="theme-toggle" class="nav-item-button" aria-label="Toggle theme"></button> 
        </div>
      </div>
    </div>
  </div>
</nav>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const themeToggle = document.getElementById('theme-toggle');
    const H = document.documentElement; 

    if (H.classList.contains('dark-mode')) {
      themeToggle.textContent = 'Light Mode';
    } else {
      themeToggle.textContent = 'Dark Mode';
    }

    themeToggle.addEventListener('click', function() {
      H.classList.toggle('dark-mode');
      if (H.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark-mode');
        themeToggle.textContent = 'Light Mode';
      } else {
        localStorage.setItem('theme', 'light-mode');
        themeToggle.textContent = 'Dark Mode';
      }
    });
  });
</script><div id="content-wrapper">
        <main class="container" id="main-content">
<div class="main-content-area">
  <article class="post-layout container">

    <header class="post-header">
      <h1 class="post-title">Jenkins for K8s Cluster (II)</h1>

      <div class="post-meta">
        <span class="post-meta__date">
          <time datetime="2020-07-19T20:00:00&#43;08:00">July 19, 2020</time>
        </span>

        
          <span class="post-meta__author">Written by See Hiong</span>
        

        
          <span class="post-meta__tags">
            In:
            
              <a href="/tags/raspberry-pi">Raspberry Pi</a>
            
              , <a href="/tags/k8s">K8s</a>
            
              , <a href="/tags/cluster">Cluster</a>
            
              , <a href="/tags/jenkins">Jenkins</a>
            
          </span>
        

        
      </div>
    </header>

    
      
      
      <div class="post-cover-container post-cover--artistic-blur-wrapper">
        
          <div class="post-cover-blur-background" style="--bg-image: url('/images/jenkins-k8s2/jenkins-on-kubernetes.png');"></div>
          <img src="/images/jenkins-k8s2/jenkins-on-kubernetes.png" alt="Jenkins for K8s Cluster (II) cover image" class="post-cover-image post-cover-image--artistic-blur">
        
      </div>
    

    <section class="post-content">
      <p>With Jenkins Agent for Kubernetes Cluster, you can orchestrate your build, test and scale deployment pipelines automatically</p>
<h1 id="jenkins-on-kubernetes-cluster-part-ii">Jenkins on Kubernetes Cluster (Part II)</h1>
<p><em>(Total Setup Time: 25 mins)</em></p>
<p>In this guide, I will setup Jenkins agents for 






  <a href="/posts/2020/07/jenkins-for-k8s-cluster-i/" >previous post</a>
. With these agents, you can expand your Kubernetes cluster capabilities to handle additional loads.</p>
<h2 id="preparation">Preparation</h2>
<p><em>(15 mins)</em></p>
<p>First, you need to create the jenkins agent docker image for raspberry Pi cluster. You may start by creating a new <em>Dockerfile</em> and insert the following:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-docker" data-lang="docker"><span style="display:flex;"><span><span style="color:#57606a"># Source</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#57606a"># https://hub.docker.com/r/jenkins/slave/dockerfile</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">FROM</span><span style="color:#0a3069"> balenalib/raspberrypi4-64-debian-openjdk:11-bullseye</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">ARG</span> <span style="color:#953800">VERSION</span><span style="color:#0550ae">=</span><span style="color:#0550ae">4</span>.7<span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">ARG</span> <span style="color:#953800">user</span><span style="color:#0550ae">=</span>jenkins
</span></span><span style="display:flex;"><span><span style="color:#cf222e">ARG</span> <span style="color:#953800">group</span><span style="color:#0550ae">=</span>jenkins
</span></span><span style="display:flex;"><span><span style="color:#cf222e">ARG</span> <span style="color:#953800">uid</span><span style="color:#0550ae">=</span><span style="color:#0550ae">1000</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">ARG</span> <span style="color:#953800">gid</span><span style="color:#0550ae">=</span><span style="color:#0550ae">1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Modified for debian-bullseye</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">RUN</span> groupadd -g <span style="color:#0a3069">${</span><span style="color:#953800">gid</span><span style="color:#0a3069">}</span> <span style="color:#0a3069">${</span><span style="color:#953800">group</span><span style="color:#0a3069">}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">RUN</span> useradd -d /home/<span style="color:#0a3069">${</span><span style="color:#953800">user</span><span style="color:#0a3069">}</span> -u <span style="color:#0a3069">${</span><span style="color:#953800">uid</span><span style="color:#0a3069">}</span> -g <span style="color:#0a3069">${</span><span style="color:#953800">group</span><span style="color:#0a3069">}</span> -m <span style="color:#0a3069">${</span><span style="color:#953800">user</span><span style="color:#0a3069">}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">LABEL</span> <span style="color:#953800">Description</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;This is a base image, which provides the Jenkins agent executable (slave.jar)&#34;</span> <span style="color:#953800">Vendor</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Jenkins project&#34;</span> <span style="color:#953800">Version</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">${</span><span style="color:#953800">VERSION</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">ARG</span> <span style="color:#953800">AGENT_WORKDIR</span><span style="color:#0550ae">=</span>/home/<span style="color:#0a3069">${</span><span style="color:#953800">user</span><span style="color:#0a3069">}</span>/agent<span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#57606a"># Modified for debian-bullseye</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">RUN</span> apt-get update <span style="color:#0550ae">&amp;&amp;</span> apt-get install -y curl bash git git-lfs openssh-client openssl procps <span style="color:#0a3069">\
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span>  <span style="color:#0550ae">&amp;&amp;</span> curl --create-dirs -fsSLo /usr/share/jenkins/agent.jar https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/<span style="color:#0a3069">${</span><span style="color:#953800">VERSION</span><span style="color:#0a3069">}</span>/remoting-<span style="color:#0a3069">${</span><span style="color:#953800">VERSION</span><span style="color:#0a3069">}</span>.jar <span style="color:#0a3069">\
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span>  <span style="color:#0550ae">&amp;&amp;</span> chmod <span style="color:#0550ae">755</span> /usr/share/jenkins <span style="color:#0a3069">\
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span>  <span style="color:#0550ae">&amp;&amp;</span> chmod <span style="color:#0550ae">644</span> /usr/share/jenkins/agent.jar <span style="color:#0a3069">\
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span>  <span style="color:#0550ae">&amp;&amp;</span> ln -sf /usr/share/jenkins/agent.jar /usr/share/jenkins/slave.jar <span style="color:#0a3069">\
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span>  <span style="color:#0550ae">&amp;&amp;</span> apt-get remove -y curl<span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span>  <span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">USER</span><span style="color:#0a3069"> ${user}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">ENV</span> <span style="color:#953800">AGENT_WORKDIR</span><span style="color:#0550ae">=</span><span style="color:#0a3069">${</span><span style="color:#953800">AGENT_WORKDIR</span><span style="color:#0a3069">}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">RUN</span> mkdir /home/<span style="color:#0a3069">${</span><span style="color:#953800">user</span><span style="color:#0a3069">}</span>/.jenkins <span style="color:#0550ae">&amp;&amp;</span> mkdir -p <span style="color:#0a3069">${</span><span style="color:#953800">AGENT_WORKDIR</span><span style="color:#0a3069">}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">VOLUME</span><span style="color:#0a3069"> /home/${user}/.jenkins</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">VOLUME</span><span style="color:#0a3069"> ${AGENT_WORKDIR}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">WORKDIR</span><span style="color:#0a3069"> /home/${user}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#57606a"># Source</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#57606a"># https://hub.docker.com/r/jenkins/inbound-agent/dockerfile</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">USER</span><span style="color:#0a3069"> ${user}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">COPY</span> jenkins-agent /usr/share/jenkins/jenkins-agent<span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">USER</span><span style="color:#0a3069"> root</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">COPY</span> jenkins-agent /usr/local/bin/jenkins-agent<span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">RUN</span> chmod +x /usr/local/bin/jenkins-agent <span style="color:#0a3069">\
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069"></span>  <span style="color:#0550ae">&amp;&amp;</span> ln -s /usr/local/bin/jenkins-agent /usr/local/bin/jenkins-slave<span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">USER</span><span style="color:#0a3069"> ${user}</span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e">
</span></span></span><span style="display:flex;"><span><span style="color:#f6f8fa;background-color:#82071e"></span><span style="color:#cf222e">ENTRYPOINT</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;jenkins-agent&#34;</span><span style="color:#1f2328">]</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Second, create a local copy of 






  <a href="https://github.com/jenkinsci/docker-inbound-agent/blob/master/jenkins-agent" target="_blank" rel="noopener noreferrer" >jenkins-agent</a>
 file. The above <em>COPY</em> command will copy it into the docker image.</p>
<p>Third, 






  <a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="noopener noreferrer" >build</a>
 the jenkins-agent image and tag it:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker build -t seehiong/jenkins-agent:1.0 .</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Verify the built status by running <em>docker images</em>:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a"># REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># seehiong/jenkins-agent               1.0                 3e31e8033460        2 minutes ago       432MB</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>To check the java version, use 






  <a href="https://docs.docker.com/engine/reference/commandline/run/" target="_blank" rel="noopener noreferrer" >docker run</a>
:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -it seehiong/jenkins-agent:1.0 /bin/bash
</span></span><span style="display:flex;"><span>java -version</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Lastly, we are ready to configure Jenkins for Kubernetes Cluster for scalability, with this Jenkins agent image!</p>
<h2 id="configuring-jenkins-agent-for-kubernetes-cluster">Configuring Jenkins Agent for Kubernetes Cluster</h2>
<p><em>(5 mins)</em></p>
<p>First, log into Jenkins and navigate to Jenkins &gt; Configure Global Security. Set TCP port for inbound agents to the defualt port 50000. Since remoting 3.0 is using 






  <a href="https://github.com/jenkinsci/remoting/blob/master/docs/protocols.md#jnlp4-connect" target="_blank" rel="noopener noreferrer" >JNLP4-connect</a>
, verify that the Inbound TCP Agent Protocol/4 option is marked.</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-global-security-50000.png"   alt="jenkins-global-security" class="sc-image sc-image-default"
       >


<p>Second, navigate to Jenkins &gt; Configure Clouds, add a new cloud and select Kubernetes. You may test the connection by clicking on the <em>Test Connection</em> button.</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-test-kubernetes-connection.png"   alt="jenkins-test-kubernetes-connection" class="sc-image sc-image-default"
       >


<p>Next, check that the Jenkins URL and tunnel is set correctly. You can find the IP address by running this:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl get svc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Sample output</span>
</span></span><span style="display:flex;"><span>NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span style="color:#0550ae">(</span>S<span style="color:#0550ae">)</span>                          AGE
</span></span><span style="display:flex;"><span>jenkins      NodePort    10.99.201.197   &lt;none&gt;        8080:30080/TCP,50000:32502/TCP   8d</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>This is the my cloud configuration:</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-configure-cloud.png"   alt="jenkins-configure-cloud" class="sc-image sc-image-default"
       >


<p>Third, click on the pod templates to add a pod template. Next, click on the add container to add a new <em>jnlp</em> container. This is my pod template setting:</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-pod-templates.png"   alt="jenkins-pod-templates" class="sc-image sc-image-default"
       >


<h2 id="creating-the-first-jenkins-job">Creating the First Jenkins Job</h2>
<p><em>(5 mins)</em></p>
<p>First, click on the New Item, enter item name as <em>First Job</em> and select Freestyle project. From the Build tab, enter any abitrary command. I use <em>sleep 1m</em> to execute in shell. Click on the <strong>save</strong> button.</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-sleep-on-first-job.png"   alt="jenkins-sleep-on-first-job" class="sc-image sc-image-default"
       >


<p>Second, following the above steps, I created 3 jobs, to sleep for 1 minute, 45 seconds and 30 seconds respectively.</p>
<p>Lastlty, from the main page, you can click on the schedule a build for each job. You will notice that the jenkins-agents are initially suspended:</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-agents-suspended.png"   alt="jenkins-agents-suspended" class="sc-image sc-image-default"
       >


<p>After some pod initialization processes, it will execute the jobs, similar to this:</p>


































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-agents-running.png"   alt="jenkins-agents-running" class="sc-image sc-image-default"
       >


<p>You may check the logs from jenkins master by running:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a"># Get pod name</span>
</span></span><span style="display:flex;"><span>kubectl get pods
</span></span><span style="display:flex;"><span>kubectl logs jenkins-7c5ffc6f55-c8fmj</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/jenkins-k8s2/jenkins-master-logs.png"   alt="jenkins-master-logs" class="sc-image sc-image-default"
       >


<p>That&rsquo;s all folks! You have configured a working Jenkins on Kubernetes Cluster with scalability capabilities. Stay tuned to our subsequent posts on configuring Jenkins pipeline for our builds.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="nodes-stay-suspended">Nodes stay suspended</h3>
<p>The important point to note is that, as opposed to many site on the internet, the container name must be named as <em>jnlp</em>. Even though it is stated correctly 






  <a href="https://plugins.jenkins.io/kubernetes/" target="_blank" rel="noopener noreferrer" >here</a>
, the screen shot on the page itself states otherwise.</p>

    </section>

    <nav class="post-navigation">
      <div class="nav-links">
        
          <div class="nav-previous">
            <a href="/posts/2020/07/jenkins-for-k8s-cluster-i/" rel="prev">
              <span class="meta-nav">← Previous</span>
              <span class="post-title">Jenkins for K8s Cluster (I)</span>
            </a>
          </div>
        
        
          <div class="nav-next">
            <a href="/posts/2020/07/helm-for-k8s-cluster/" rel="next">
              <span class="meta-nav">Next →</span>
              <span class="post-title">Helm for K8s Cluster</span>
            </a>
          </div>
        
      </div>
    </nav>

    
<div class="giscus-comments-container">
</div>

<script>
  (function() {
    'use strict';

    const getGiscusTheme = () => {
      const storedTheme = localStorage.getItem('theme'); 
      if (storedTheme) {
        return storedTheme === 'dark-mode' ? 'dark' : 'light';
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };

    const setGiscusFrameTheme = (theme) => {
      const iframe = document.querySelector('iframe.giscus-frame');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({ giscus: { setConfig: { theme: theme } } }, 'https://giscus.app');
      }
    };

    const loadGiscus = () => {
      const giscusContainer = document.querySelector('.giscus-comments-container');
      if (!giscusContainer) {
        console.warn('Giscus container not found.');
        return;
      }

      while (giscusContainer.firstChild) {
        giscusContainer.removeChild(giscusContainer.firstChild);
      }

      const giscusScript = document.createElement('script');
      const giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo":             "seehiong\/seehiong.github.io",
        "data-repo-id":          "R_kgDOJg7Puw",
        "data-category":         "General",
        "data-category-id":      "DIC_kwDOJg7Pu84Cbyhc",
        "data-mapping":          "url", 
        "data-strict":           "0",
        "data-reactions-enabled":"1",
        "data-emit-metadata":    "0",
        "data-input-position":   "top", 
        "data-theme":            getGiscusTheme(), 
        "data-lang":             "en",
        "data-loading":          "lazy",
        "crossorigin":           "anonymous",
        "async":                 "true", 
      };

      if (!giscusAttributes["data-repo"] || !giscusAttributes["data-repo-id"] || !giscusAttributes["data-category-id"]) {
          console.error("Giscus parameters (giscusRepo, giscusRepoId, giscusCategoryId) are not configured in hugo.toml.");
          giscusContainer.innerHTML = "<p style='color: var(--text-secondary);'>Giscus comments are not configured correctly. Please check site parameters.</p>";
          return;
      }

      Object.entries(giscusAttributes).forEach(
        ([key, value]) => giscusScript.setAttribute(key, value)
      );
      giscusContainer.appendChild(giscusScript);
    };

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadGiscus);
    } else {
        loadGiscus();
    }

    const htmlElement = document.documentElement;
    const observer = new MutationObserver((mutationsList) => {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          setGiscusFrameTheme(getGiscusTheme());
        }
      }
    });
    observer.observe(htmlElement, { attributes: true });

  })();
</script>


  </article>
</div>
</main>
    </div>

    
    <div id="search-modal-overlay" class="search-modal-overlay" style="display: none;">
      <div id="search-modal-content" class="search-modal-content">
        <button id="search-modal-close" class="search-modal-close" aria-label="Close search" title="Close search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
        <input type="search" id="modal-search-input" class="modal-search-input" placeholder="Search content..." aria-label="Search input">
        <div id="modal-search-results" class="modal-search-results">
        </div>
      </div>
    </div>
    

  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js" defer></script>
  <script>
    (function() {
      'use strict';

      window.addEventListener('DOMContentLoaded', () => {
        const searchModalOverlay = document.getElementById('search-modal-overlay');
        const searchModalContent = document.getElementById('search-modal-content');
        const searchModalCloseButton = document.getElementById('search-modal-close');
        const searchToggleButton = document.getElementById('nav-search-toggle');
        const searchInputTarget = document.getElementById('modal-search-input');
        const searchResultsTarget = document.getElementById('modal-search-results');

        let fuseInstance = null;
        let searchData = [];

        const loadSearchData = async () => {
          if (searchData.length === 0 && !fuseInstance) {
            try {
              const response = await fetch('\/index.json');
              if (!response.ok) {
                throw new Error(`HTTP error loading index.json! status: ${response.status}`);
              }
              searchData = await response.json();
              initializeFuse();
            } catch (e) {
              console.error("[SearchSetup] Error loading search data:", e);
              if (searchResultsTarget) searchResultsTarget.innerHTML = "<p>Error loading search index.</p>";
            }
          } else if (searchData.length > 0 && !fuseInstance){
            initializeFuse();
          }
        };

        const initializeFuse = () => {
          if (searchData.length > 0 && !fuseInstance) {
            const options = {
              keys: [
                { name: 'title', weight: 0.7 }, { name: 'summary', weight: 0.5 },
                { name: 'content', weight: 0.3 }, { name: 'tags', weight: 0.4 }
              ],
              includeScore: true, threshold: 0.4, minMatchCharLength: 2,
            };
            fuseInstance = new Fuse(searchData, options);
          }
        };

        const performSearch = () => {
          if (!fuseInstance || !searchInputTarget || !searchResultsTarget) return;
          const query = searchInputTarget.value.trim();
          searchResultsTarget.innerHTML = '';
          if (query.length < 2) return;

          const results = fuseInstance.search(query);
          if (results.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'search-results-list';
            results.slice(0, 10).forEach(result => {
              const item = result.item;
              const li = document.createElement('li');
              li.className = 'search-result-item';
              const a = document.createElement('a');
              a.href = item.permalink;
              a.textContent = item.title;
              li.appendChild(a);
              ul.appendChild(li);
            });
            searchResultsTarget.appendChild(ul);
          } else {
            searchResultsTarget.innerHTML = '<p>No results found.</p>';
          }
        };

        const openSearchModal = async () => {
          await loadSearchData();
          if (searchInputTarget) searchInputTarget.value = '';
          if (searchResultsTarget) searchResultsTarget.innerHTML = '';

          if (searchModalOverlay) {
            searchModalOverlay.style.display = 'flex';
            setTimeout(() => searchModalOverlay.classList.add('active'), 10);
          } else { return; }

          if (searchInputTarget) setTimeout(() => searchInputTarget.focus(), 50);
          if (searchToggleButton) searchToggleButton.classList.add('active');
        };

        const closeSearchModal = () => {
          if (searchModalOverlay) {
            searchModalOverlay.classList.remove('active');
            setTimeout(() => searchModalOverlay.style.display = 'none', 300);
          }
          if (searchToggleButton) searchToggleButton.classList.remove('active');
        };

        if (searchToggleButton) {
          searchToggleButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (searchModalOverlay && searchModalOverlay.classList.contains('active')) {
              closeSearchModal();
            } else {
              openSearchModal();
            }
          });
        } else { console.error("[SearchSetup] #nav-search-toggle button not found."); }

        if (searchModalCloseButton) { searchModalCloseButton.addEventListener('click', closeSearchModal); }
        if (searchModalOverlay && searchModalContent) {
          searchModalOverlay.addEventListener('click', (event) => {
            if (event.target === searchModalOverlay) closeSearchModal();
          });
        }
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && searchModalOverlay && searchModalOverlay.classList.contains('active')) {
            closeSearchModal();
          }
        });
        if (searchInputTarget) {
          let debounceTimer;
          searchInputTarget.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(performSearch, 300);
          });
        }
      });
    })();
  </script>

    

    

  <script>
    MathJax = {
      tex: {
        displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        inlineMath: [['\\(', '\\)']], 
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams' 
      },
      svg: {
        fontCache: 'global' 
      },
      chtml: {
        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], 
        ignoreHtmlClass: 'tex2jax_ignore', 
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<footer class="footer-main simplified-footer">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="footer-content">
        <div class="copyright-line">
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> © 2025 See Hiong. All rights reserved.
        </div>
        <div class="social-links">
          
            <a href="https://github.com/seehiong" target="_blank" title="GitHub" class="social-link" aria-label="GitHub">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
          
            <a href="https://www.linkedin.com/in/seehiong/" target="_blank" title="LinkedIn" class="social-link" aria-label="LinkedIn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
          
          
            <a href="/index.xml" target="_blank" title="RSS" class="social-link" aria-label="RSS Feed">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
            </a>
          
        </div>
      </div>
    </div>
  </div>
</footer>
        <script src="/js/animation.js" defer></script>
    
        <script src="/js/code-copy.js" defer></script>
    
        <script src="/js/scroll-header.js" defer></script>
       
  </body>
</html>