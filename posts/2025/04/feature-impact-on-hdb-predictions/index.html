<!DOCTYPE html>
<html lang="en">
  <head><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="icon" href="/img/favicon.ico">
    

    <meta property="og:url" content="https://seehiong.github.io/posts/2025/04/feature-impact-on-hdb-predictions/">
  <meta property="og:site_name" content="See Hiong&#39;s Blog">
  <meta property="og:title" content="Feature Impact on HDB predictions">
  <meta property="og:description" content="In this post, I explore the impact of different feature sets on XGBoost model performance for HDB resale price prediction. By combining numerical, categorical, and engineered features, I conducted a series of experiments and tracked their performance using MLflow. The results reveal how thoughtful feature engineering and selection can significantly influence metrics like RMSE, MAE, and R²—offering valuable insights into building more accurate predictive models.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-13T10:00:00+08:00">
    <meta property="article:modified_time" content="2025-04-13T10:00:00+08:00">
    <meta property="article:tag" content="Network Model">
    <meta property="article:tag" content="Network Architecture">
    <meta property="article:tag" content="TensorFlow">
    <meta property="article:tag" content="XGBoost">
    <meta property="article:tag" content="MLflow">
    <meta property="article:tag" content="Kubeflow">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Feature Impact on HDB predictions">
  <meta name="twitter:description" content="In this post, I explore the impact of different feature sets on XGBoost model performance for HDB resale price prediction. By combining numerical, categorical, and engineered features, I conducted a series of experiments and tracked their performance using MLflow. The results reveal how thoughtful feature engineering and selection can significantly influence metrics like RMSE, MAE, and R²—offering valuable insights into building more accurate predictive models.">

  <meta itemprop="name" content="Feature Impact on HDB predictions">
  <meta itemprop="description" content="In this post, I explore the impact of different feature sets on XGBoost model performance for HDB resale price prediction. By combining numerical, categorical, and engineered features, I conducted a series of experiments and tracked their performance using MLflow. The results reveal how thoughtful feature engineering and selection can significantly influence metrics like RMSE, MAE, and R²—offering valuable insights into building more accurate predictive models.">
  <meta itemprop="datePublished" content="2025-04-13T10:00:00+08:00">
  <meta itemprop="dateModified" content="2025-04-13T10:00:00+08:00">
  <meta itemprop="wordCount" content="3822">
  <meta itemprop="keywords" content="Network Model,Network Architecture,TensorFlow,XGBoost,MLflow,Kubeflow,MinIO"><title>Feature Impact on HDB predictions | See Hiong&#39;s Blog</title>

    <link rel="canonical" href="https://seehiong.github.io/posts/2025/04/feature-impact-on-hdb-predictions/">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    
    <link rel="stylesheet" href="/css/variables.css">
    
    <link rel="stylesheet" href="/css/base.css">
    
    <link rel="stylesheet" href="/css/layout.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/cards.css">
    
    <link rel="stylesheet" href="/css/content_elements.css">
    
    <link rel="stylesheet" href="/css/codeblocks.css">
    
    <link rel="stylesheet" href="/css/page_specific.css">
    
    <link rel="stylesheet" href="/css/shortcodes.css">
    
    <link rel="stylesheet" href="/css/components.css">
    
    <link rel="stylesheet" href="/css/animations.css">
    
    <link rel="stylesheet" href="/css/media_queries.css">
    
    <link rel="stylesheet" href="/css/quantum-theme.css">
    

    
    <script>
      (function() {
        var theme = localStorage.getItem('theme');
        var H = document.documentElement;
        if (theme === 'dark-mode') {
          H.classList.add('dark-mode');
        } else if (theme === 'light-mode') {
          H.classList.remove('dark-mode');
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          H.classList.add('dark-mode');
        }
      })();
    </script>
</head></head>
  <body class="page-article"><nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/" class="nav-logo-link" title="See Hiong&#39;s Blog - Home">
          <span class="nav-site-title">
            <span class="nav-site-title__main">SEE HIONG’S</span>
            <span class="nav-site-title__sub">BLOG</span>
          </span>
        </a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            
            
            <a href="/posts/" class="nav-item-content active">Archives</a>
            
          </div>
          
          
          <div class="nav-item-wrapper">
            <a href="/tags/" class="nav-item-content ">Tags</a>
          </div>
          <div class="nav-item-wrapper">
            <a href="/about/" class="nav-item-content ">About</a>
          </div>
          <div class="nav-item-wrapper nav-search-toggle-wrapper">
            <button id="nav-search-toggle" class="nav-item-button" aria-label="Toggle search" title="Search">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" class="nav-item-icon">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </button>
          </div>
          
          
          <button id="theme-toggle" class="nav-item-button" aria-label="Toggle theme"></button> 
        </div>
      </div>
    </div>
  </div>
</nav>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const themeToggle = document.getElementById('theme-toggle');
    const H = document.documentElement; 

    if (H.classList.contains('dark-mode')) {
      themeToggle.textContent = 'Light Mode';
    } else {
      themeToggle.textContent = 'Dark Mode';
    }

    themeToggle.addEventListener('click', function() {
      H.classList.toggle('dark-mode');
      if (H.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark-mode');
        themeToggle.textContent = 'Light Mode';
      } else {
        localStorage.setItem('theme', 'light-mode');
        themeToggle.textContent = 'Dark Mode';
      }
    });
  });
</script><div id="content-wrapper">
        <main class="container" id="main-content">
<div class="main-content-area">
  <article class="post-layout container">

    <header class="post-header">
      <h1 class="post-title">Feature Impact on HDB predictions</h1>

      <div class="post-meta">
        <span class="post-meta__date">
          <time datetime="2025-04-13T10:00:00&#43;08:00">April 13, 2025</time>
        </span>

        
          <span class="post-meta__author">Written by See Hiong</span>
        

        
          <span class="post-meta__tags">
            In:
            
              <a href="/tags/network-model">Network Model</a>
            
              , <a href="/tags/network-architecture">Network Architecture</a>
            
              , <a href="/tags/tensorflow">TensorFlow</a>
            
              , <a href="/tags/xgboost">XGBoost</a>
            
              , <a href="/tags/mlflow">MLflow</a>
            
              , <a href="/tags/kubeflow">Kubeflow</a>
            
              , <a href="/tags/minio">MinIO</a>
            
          </span>
        

        
      </div>
    </header>

    
      
      
      <div class="post-cover-container post-cover--artistic-blur-wrapper">
        
          <div class="post-cover-blur-background" style="--bg-image: url('/images/hdb/feature-impact-on-hdb-predictions.svg');"></div>
          <img src="/images/hdb/feature-impact-on-hdb-predictions.svg" alt="Feature Impact on HDB predictions cover image" class="post-cover-image post-cover-image--artistic-blur">
        
      </div>
    

    <section class="post-content">
      <p>Predicting HDB resale prices is a fascinating application of machine learning, blending feature engineering, neural networks, and advanced models like XGBoost. This post walks through the end-to-end process—from data loading and cleaning, to feature engineering, and preparing the dataset for predictive modeling. Let’s dive in using Singapore’s structured HDB Resale Flat Prices dataset from 






  <a href="https://data.gov.sg/datasets?topics=housing" target="_blank" rel="noopener noreferrer" >data.gov.sg</a>
.</p>
<h2 id="data-loading-and-exploration">Data Loading and Exploration</h2>
<p>To begin, we load the HDB resale flat prices dataset and explore the first few rows.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">pandas</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">pd</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file_path <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;Resale flat prices based on registration date from Jan-2017 onwards.csv&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    df <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>read_csv<span style="color:#1f2328">(</span>file_path<span style="color:#1f2328">,</span> skipinitialspace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Successfully loaded DataFrame. First 5 rows:&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>df<span style="color:#0550ae">.</span>head<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">except</span> FileNotFoundError<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error: The file &#39;</span><span style="color:#0a3069">{</span>file_path<span style="color:#0a3069">}</span><span style="color:#0a3069">&#39; was not found.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    exit<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;An error occurred while reading the CSV file: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    exit<span style="color:#1f2328">()</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/hdb/hdb-resale-flat-price-dataset.png"   alt="hdb-resale-flat-price-dataset" class="sc-image sc-image-default"
       >


<h2 id="feature-engineering--preprocessing">Feature Engineering &amp; Preprocessing</h2>
<p>To get meaningful insights from the dataset, we’ll process some of the raw columns and convert them into usable numerical features.</p>
<h3 id="1-extract-remaining_">1. Extract <em>remaining_lease_years</em></h3>
<p>HDB leases are represented in strings like &ldquo;92 years 3 months&rdquo;. We’ll convert that into a single numerical column.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">extract_years</span><span style="color:#1f2328">(</span>lease_str<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> pd<span style="color:#0550ae">.</span>isna<span style="color:#1f2328">(</span>lease_str<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>    parts <span style="color:#0550ae">=</span> lease_str<span style="color:#0550ae">.</span>split<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    years <span style="color:#0550ae">=</span> <span style="color:#0550ae">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> i<span style="color:#1f2328">,</span> part <span style="color:#0550ae">in</span> <span style="color:#6639ba">enumerate</span><span style="color:#1f2328">(</span>parts<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> part<span style="color:#0550ae">.</span>isdigit<span style="color:#1f2328">()</span> <span style="color:#0550ae">and</span> i<span style="color:#0550ae">+</span><span style="color:#0550ae">1</span> <span style="color:#0550ae">&lt;</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>parts<span style="color:#1f2328">)</span> <span style="color:#0550ae">and</span> parts<span style="color:#1f2328">[</span>i<span style="color:#0550ae">+</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;year&#39;</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            years <span style="color:#0550ae">+=</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">(</span>part<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">elif</span> part<span style="color:#0550ae">.</span>isdigit<span style="color:#1f2328">()</span> <span style="color:#0550ae">and</span> i<span style="color:#0550ae">+</span><span style="color:#0550ae">1</span> <span style="color:#0550ae">&lt;</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>parts<span style="color:#1f2328">)</span> <span style="color:#0550ae">and</span> parts<span style="color:#1f2328">[</span>i<span style="color:#0550ae">+</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            years <span style="color:#0550ae">+=</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">(</span>part<span style="color:#1f2328">)</span><span style="color:#0550ae">/</span><span style="color:#0550ae">12</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> years
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Min original remaining lease: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Max original remaining lease: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span>extract_years<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Min remaining lease years: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Max remaining lease years: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;NaNs in remaining lease years: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>sum<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">if</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>any<span style="color:#1f2328">():</span>
</span></span><span style="display:flex;"><span>    median_lease <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>median<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Imputing </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>sum<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> NaNs in remaining_lease_years with median value: </span><span style="color:#0a3069">{</span>median_lease<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>fillna<span style="color:#1f2328">(</span>median_lease<span style="color:#1f2328">,</span> inplace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Min original remaining lease: 40 years 01 month</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Max original remaining lease: 97 years 09 months</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Min remaining lease years: 40.083333333333336</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Max remaining lease years: 97.75</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># NaNs in remaining lease years: 0</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h3 id="2-convert-storey_-to-average-storey">2. Convert <em>storey_range</em> to Average Storey</h3>
<p>Ranges like <code>&quot;04 TO 06&quot;</code> are transformed into a single value—here, the average storey number.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">convert_storey</span><span style="color:#1f2328">(</span>storey_range<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> pd<span style="color:#0550ae">.</span>isna<span style="color:#1f2328">(</span>storey_range<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        low<span style="color:#1f2328">,</span> high <span style="color:#0550ae">=</span> <span style="color:#6639ba">map</span><span style="color:#1f2328">(</span><span style="color:#6639ba">int</span><span style="color:#1f2328">,</span> storey_range<span style="color:#0550ae">.</span>split<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39; TO &#39;</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#1f2328">(</span>low <span style="color:#0550ae">+</span> high<span style="color:#1f2328">)</span> <span style="color:#0550ae">/</span> <span style="color:#0550ae">2.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Warning: Could not parse storey_range: </span><span style="color:#0a3069">{</span>storey_range<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Min in original storey_range: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Max in original storey_range: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span>convert_storey<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Min in storey_avg: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Max in storey_avg: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">NaNs in storey_avg: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>sum<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">if</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>any<span style="color:#1f2328">():</span>
</span></span><span style="display:flex;"><span>    median_storey <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>median<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Imputing </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>sum<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> NaNs in storey_avg with median value: </span><span style="color:#0a3069">{</span>median_storey<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>fillna<span style="color:#1f2328">(</span>median_storey<span style="color:#1f2328">,</span> inplace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Min in original storey_range: 01 TO 03</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Max in original storey_range: 49 TO 51</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Min in storey_avg: 2.0</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Max in storey_avg: 50.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># NaNs in storey_avg: 0</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h3 id="3-extracting-year--month-components">3. Extracting Year &amp; Month Components</h3>
<p>From the month column (e.g., 2020-05), we extract:</p>
<ul>
<li>sale_year</li>
<li>sale_month</li>
<li>cyclical encodings (month_sin and month_cos) to capture seasonality.</li>
</ul>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">numpy</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">np</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>to_datetime<span style="color:#1f2328">(</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">],</span> <span style="color:#6639ba">format</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;%Y-%m&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>dt<span style="color:#0550ae">.</span>year
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>dt<span style="color:#0550ae">.</span>month
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_sin&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>sin<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span> <span style="color:#0550ae">*</span> np<span style="color:#0550ae">.</span>pi <span style="color:#0550ae">*</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">/</span> <span style="color:#0550ae">12.0</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_cos&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>cos<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span> <span style="color:#0550ae">*</span> np<span style="color:#0550ae">.</span>pi <span style="color:#0550ae">*</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">/</span> <span style="color:#0550ae">12.0</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Min in original month: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Max in original month: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Min in sale_year: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Max in sale_year: </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a"># Sample Output</span>
</span></span><span style="display:flex;"><span>Min in original month: 2017-01-01 00:00:00
</span></span><span style="display:flex;"><span>Max in original month: 2025-04-01 00:00:00
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Min in sale_year: <span style="color:#0550ae">2017</span>
</span></span><span style="display:flex;"><span>Max in sale_year: <span style="color:#0550ae">2025</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h3 id="4-one-hot-encoding-categorical-features">4. One-Hot Encoding Categorical Features</h3>
<p>To handle categorical features like <code>flat_type</code>, <code>flat_model</code>, and <code>town</code>, we use one-hot encoding.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>categorical_cols <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Applying One-Hot Encoding to: </span><span style="color:#0a3069">{</span>categorical_cols<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>df <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>get_dummies<span style="color:#1f2328">(</span>df<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>categorical_cols<span style="color:#1f2328">,</span> prefix<span style="color:#0550ae">=</span>categorical_cols<span style="color:#1f2328">,</span> dummy_na<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span> dtype<span style="color:#0550ae">=</span><span style="color:#6639ba">int</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Shape after One-Hot Encoding: </span><span style="color:#0a3069">{</span>df<span style="color:#0550ae">.</span>shape<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Columns after preprocessing:&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>df<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>Post-encoding shape and preview:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a"># Applying One-Hot Encoding to: [&#39;flat_type&#39;, &#39;flat_model&#39;, &#39;town&#39;]</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Shape after One-Hot Encoding: (203694, 68)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Columns after preprocessing:</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Index([&#39;month&#39;, &#39;block&#39;, &#39;street_name&#39;, &#39;storey_range&#39;, &#39;floor_area_sqm&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;lease_commence_date&#39;, &#39;remaining_lease&#39;, &#39;resale_price&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;remaining_lease_years&#39;, &#39;storey_avg&#39;, &#39;sale_year&#39;, &#39;sale_month&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;month_sin&#39;, &#39;month_cos&#39;, &#39;flat_type_1 ROOM&#39;, &#39;flat_type_2 ROOM&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_type_3 ROOM&#39;, &#39;flat_type_4 ROOM&#39;, &#39;flat_type_5 ROOM&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_type_EXECUTIVE&#39;, &#39;flat_type_MULTI-GENERATION&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_2-room&#39;, &#39;flat_model_3Gen&#39;, &#39;flat_model_Adjoined flat&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Apartment&#39;, &#39;flat_model_DBSS&#39;, &#39;flat_model_Improved&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Improved-Maisonette&#39;, &#39;flat_model_Maisonette&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Model A&#39;, &#39;flat_model_Model A-Maisonette&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Model A2&#39;, &#39;flat_model_Multi Generation&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_New Generation&#39;, &#39;flat_model_Premium Apartment&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Premium Apartment Loft&#39;, &#39;flat_model_Premium Maisonette&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Simplified&#39;, &#39;flat_model_Standard&#39;, &#39;flat_model_Terrace&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;flat_model_Type S1&#39;, &#39;flat_model_Type S2&#39;, &#39;town_ANG MO KIO&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_BEDOK&#39;, &#39;town_BISHAN&#39;, &#39;town_BUKIT BATOK&#39;, &#39;town_BUKIT MERAH&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_BUKIT PANJANG&#39;, &#39;town_BUKIT TIMAH&#39;, &#39;town_CENTRAL AREA&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_CHOA CHU KANG&#39;, &#39;town_CLEMENTI&#39;, &#39;town_GEYLANG&#39;, &#39;town_HOUGANG&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_JURONG EAST&#39;, &#39;town_JURONG WEST&#39;, &#39;town_KALLANG/WHAMPOA&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_MARINE PARADE&#39;, &#39;town_PASIR RIS&#39;, &#39;town_PUNGGOL&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_QUEENSTOWN&#39;, &#39;town_SEMBAWANG&#39;, &#39;town_SENGKANG&#39;, &#39;town_SERANGOON&#39;,</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#        &#39;town_TAMPINES&#39;, &#39;town_TOA PAYOH&#39;, &#39;town_WOODLANDS&#39;, &#39;town_YISHUN&#39;],</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">#       dtype=&#39;object&#39;)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h3 id="defining-features-and-target">Defining Features and Target</h3>
<p>Now we prepare the dataset for model training:</p>
<ul>
<li>Numerical features: <code>floor_area_sqm</code>, <code>remaining_lease_years</code>, <code>storey_avg</code>, <code>sale_year</code>, <code>sale_month</code></li>
<li>Categorical (One-hot): Selected <code>town</code> and <code>flat_model</code> columns</li>
<li>Target: <code>resale_price</code></li>
</ul>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>numerical_features <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>categorical_prefixes <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> df<span style="color:#0550ae">.</span>columns <span style="color:#cf222e">if</span> col<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;flat_type_&#39;</span><span style="color:#1f2328">)],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> df<span style="color:#0550ae">.</span>columns <span style="color:#cf222e">if</span> col<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;flat_model_&#39;</span><span style="color:#1f2328">)],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> df<span style="color:#0550ae">.</span>columns <span style="color:#cf222e">if</span> col<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;town_&#39;</span><span style="color:#1f2328">)]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>feature_columns <span style="color:#0550ae">=</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>target_column <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;resale_price&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>X <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span>feature_columns<span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>values
</span></span><span style="display:flex;"><span>y <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span>target_column<span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Shape of X: </span><span style="color:#0a3069">{</span>X<span style="color:#0550ae">.</span>shape<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Shape of y: </span><span style="color:#0a3069">{</span>y<span style="color:#0550ae">.</span>shape<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Successfully prepared X and y for training.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Shape of X: (203694, 52)</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Shape of y: (203694,)</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Successfully prepared X and y for training.</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>In the next part, we’ll feed this preprocessed data into machine learning models—starting with neural networks, then comparing with XGBoost for boosted performance.</p>
<h2 id="neural-networks">Neural Networks</h2>
<p>With the features and target variable prepped, I experimented with a simple feedforward neural network using Keras. This serves as a strong baseline model for structured data like the HDB resale dataset.

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    Neural Networks - python code
  </summary>
  <div class="details-shortcode__content">
    
    
    





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">tensorflow</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">tf</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">pandas</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">numpy</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">np</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">matplotlib.pyplot</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">plt</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.model_selection</span> <span style="color:#cf222e">import</span> train_test_split
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.preprocessing</span> <span style="color:#cf222e">import</span> MinMaxScaler
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">tensorflow.keras.models</span> <span style="color:#cf222e">import</span> Sequential
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">tensorflow.keras.layers</span> <span style="color:#cf222e">import</span> Dense
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">tensorflow.keras.optimizers</span> <span style="color:#cf222e">import</span> Adam
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">tensorflow.keras.callbacks</span> <span style="color:#cf222e">import</span> EarlyStopping
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">train_model_with_features</span><span style="color:#1f2328">(</span>X_data<span style="color:#1f2328">,</span> y_data<span style="color:#1f2328">,</span> feature_names<span style="color:#1f2328">,</span> epochs<span style="color:#0550ae">=</span><span style="color:#0550ae">50</span><span style="color:#1f2328">,</span> batch_size<span style="color:#0550ae">=</span><span style="color:#0550ae">64</span><span style="color:#1f2328">,</span> verbose<span style="color:#0550ae">=</span><span style="color:#0550ae">1</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Split data</span>
</span></span><span style="display:flex;"><span>    X_train<span style="color:#1f2328">,</span> X_test<span style="color:#1f2328">,</span> y_train<span style="color:#1f2328">,</span> y_test <span style="color:#0550ae">=</span> train_test_split<span style="color:#1f2328">(</span>X_data<span style="color:#1f2328">,</span> y_data<span style="color:#1f2328">,</span> test_size<span style="color:#0550ae">=</span><span style="color:#0550ae">0.2</span><span style="color:#1f2328">,</span> random_state<span style="color:#0550ae">=</span><span style="color:#0550ae">42</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Scale the data</span>
</span></span><span style="display:flex;"><span>    X_scaler <span style="color:#0550ae">=</span> MinMaxScaler<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    y_scaler <span style="color:#0550ae">=</span> MinMaxScaler<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    X_train_scaled <span style="color:#0550ae">=</span> X_scaler<span style="color:#0550ae">.</span>fit_transform<span style="color:#1f2328">(</span>X_train<span style="color:#1f2328">)</span> <span style="color:#57606a"># Fit and transform Train</span>
</span></span><span style="display:flex;"><span>    X_test_scaled <span style="color:#0550ae">=</span> X_scaler<span style="color:#0550ae">.</span>transform<span style="color:#1f2328">(</span>X_test<span style="color:#1f2328">)</span>       <span style="color:#57606a"># Transform Test</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    y_train_scaled <span style="color:#0550ae">=</span> y_scaler<span style="color:#0550ae">.</span>fit_transform<span style="color:#1f2328">(</span>y_train<span style="color:#0550ae">.</span>reshape<span style="color:#1f2328">(</span><span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">))</span><span style="color:#0550ae">.</span>flatten<span style="color:#1f2328">()</span> <span style="color:#57606a"># Fit and transform Train</span>
</span></span><span style="display:flex;"><span>    y_test_scaled <span style="color:#0550ae">=</span> y_scaler<span style="color:#0550ae">.</span>transform<span style="color:#1f2328">(</span>y_test<span style="color:#0550ae">.</span>reshape<span style="color:#1f2328">(</span><span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">))</span><span style="color:#0550ae">.</span>flatten<span style="color:#1f2328">()</span>       <span style="color:#57606a"># Transform Test</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> verbose <span style="color:#0550ae">&gt;=</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Training with </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> features.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;X_train shape:&#34;</span><span style="color:#1f2328">,</span> X_train<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;y_train shape:&#34;</span><span style="color:#1f2328">,</span> y_train<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;X_test shape:&#34;</span><span style="color:#1f2328">,</span> X_test<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;y_test shape:&#34;</span><span style="color:#1f2328">,</span> y_test<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;X_train_scaled range:&#34;</span><span style="color:#1f2328">,</span> X_train_scaled<span style="color:#0550ae">.</span>min<span style="color:#1f2328">(),</span> X_train_scaled<span style="color:#0550ae">.</span>max<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;y_train_scaled range:&#34;</span><span style="color:#1f2328">,</span> y_train_scaled<span style="color:#0550ae">.</span>min<span style="color:#1f2328">(),</span> y_train_scaled<span style="color:#0550ae">.</span>max<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Any NaN in X_train_scaled:&#34;</span><span style="color:#1f2328">,</span> np<span style="color:#0550ae">.</span>isnan<span style="color:#1f2328">(</span>X_train_scaled<span style="color:#1f2328">)</span><span style="color:#0550ae">.</span>any<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Any NaN in y_train_scaled:&#34;</span><span style="color:#1f2328">,</span> np<span style="color:#0550ae">.</span>isnan<span style="color:#1f2328">(</span>y_train_scaled<span style="color:#1f2328">)</span><span style="color:#0550ae">.</span>any<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Build model</span>
</span></span><span style="display:flex;"><span>    model <span style="color:#0550ae">=</span> Sequential<span style="color:#1f2328">([</span>
</span></span><span style="display:flex;"><span>        Dense<span style="color:#1f2328">(</span><span style="color:#0550ae">64</span><span style="color:#1f2328">,</span> activation<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;relu&#39;</span><span style="color:#1f2328">,</span> input_shape<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span>X_train_scaled<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">[</span><span style="color:#0550ae">1</span><span style="color:#1f2328">],)),</span>
</span></span><span style="display:flex;"><span>        Dense<span style="color:#1f2328">(</span><span style="color:#0550ae">32</span><span style="color:#1f2328">,</span> activation<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;relu&#39;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>        Dense<span style="color:#1f2328">(</span><span style="color:#0550ae">1</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Compile model</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#0550ae">.</span>compile<span style="color:#1f2328">(</span>optimizer<span style="color:#0550ae">=</span>Adam<span style="color:#1f2328">(</span>learning_rate<span style="color:#0550ae">=</span><span style="color:#0550ae">0.001</span><span style="color:#1f2328">),</span> loss<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;mse&#39;</span><span style="color:#1f2328">)</span> <span style="color:#57606a"># Use MSE for regression</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Train with early stopping</span>
</span></span><span style="display:flex;"><span>    early_stop <span style="color:#0550ae">=</span> EarlyStopping<span style="color:#1f2328">(</span>monitor<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;val_loss&#39;</span><span style="color:#1f2328">,</span> patience<span style="color:#0550ae">=</span><span style="color:#0550ae">10</span><span style="color:#1f2328">,</span> restore_best_weights<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Train model</span>
</span></span><span style="display:flex;"><span>    history <span style="color:#0550ae">=</span> model<span style="color:#0550ae">.</span>fit<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        X_train_scaled<span style="color:#1f2328">,</span> y_train_scaled<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        epochs<span style="color:#0550ae">=</span>epochs<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        batch_size<span style="color:#0550ae">=</span>batch_size<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        validation_split<span style="color:#0550ae">=</span><span style="color:#0550ae">0.2</span><span style="color:#1f2328">,</span> <span style="color:#57606a"># Validation on a split of the training data</span>
</span></span><span style="display:flex;"><span>        callbacks<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span>early_stop<span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        verbose<span style="color:#0550ae">=</span>verbose
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Make predictions</span>
</span></span><span style="display:flex;"><span>    y_pred_scaled <span style="color:#0550ae">=</span> model<span style="color:#0550ae">.</span>predict<span style="color:#1f2328">(</span>X_test_scaled<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    y_pred <span style="color:#0550ae">=</span> y_scaler<span style="color:#0550ae">.</span>inverse_transform<span style="color:#1f2328">(</span>y_pred_scaled<span style="color:#1f2328">)</span><span style="color:#0550ae">.</span>flatten<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Calculate metrics using the original UNscaled test data</span>
</span></span><span style="display:flex;"><span>    mse <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>mean<span style="color:#1f2328">((</span>y_test <span style="color:#0550ae">-</span> y_pred<span style="color:#1f2328">)</span><span style="color:#0550ae">**</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    rmse <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>sqrt<span style="color:#1f2328">(</span>mse<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    mae <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>mean<span style="color:#1f2328">(</span>np<span style="color:#0550ae">.</span>abs<span style="color:#1f2328">(</span>y_test <span style="color:#0550ae">-</span> y_pred<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> np<span style="color:#0550ae">.</span>var<span style="color:#1f2328">(</span>y_test<span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">1e-9</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>         r2 <span style="color:#0550ae">=</span> <span style="color:#0550ae">1</span> <span style="color:#0550ae">-</span> <span style="color:#1f2328">(</span>np<span style="color:#0550ae">.</span>sum<span style="color:#1f2328">((</span>y_test <span style="color:#0550ae">-</span> y_pred<span style="color:#1f2328">)</span><span style="color:#0550ae">**</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">/</span> np<span style="color:#0550ae">.</span>sum<span style="color:#1f2328">((</span>y_test <span style="color:#0550ae">-</span> np<span style="color:#0550ae">.</span>mean<span style="color:#1f2328">(</span>y_test<span style="color:#1f2328">))</span><span style="color:#0550ae">**</span><span style="color:#0550ae">2</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>         r2 <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Print results</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Model Performance (</span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> features):&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Mean Squared Error (MSE): </span><span style="color:#0a3069">{</span>mse<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Root Mean Squared Error (RMSE): </span><span style="color:#0a3069">{</span>rmse<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Mean Absolute Error (MAE): </span><span style="color:#0a3069">{</span>mae<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;R-squared (R²): </span><span style="color:#0a3069">{</span>r2<span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Plotting (Plot against one key feature or just residuals)</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>figure<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span><span style="color:#0550ae">10</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">6</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>scatter<span style="color:#1f2328">(</span>y_test<span style="color:#1f2328">,</span> y_pred<span style="color:#1f2328">,</span> alpha<span style="color:#0550ae">=</span><span style="color:#0550ae">0.3</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>plot<span style="color:#1f2328">([</span><span style="color:#6639ba">min</span><span style="color:#1f2328">(</span>y_test<span style="color:#0550ae">.</span>min<span style="color:#1f2328">(),</span> y_pred<span style="color:#0550ae">.</span>min<span style="color:#1f2328">()),</span> <span style="color:#6639ba">max</span><span style="color:#1f2328">(</span>y_test<span style="color:#0550ae">.</span>max<span style="color:#1f2328">(),</span> y_pred<span style="color:#0550ae">.</span>max<span style="color:#1f2328">())],</span>
</span></span><span style="display:flex;"><span>             <span style="color:#1f2328">[</span><span style="color:#6639ba">min</span><span style="color:#1f2328">(</span>y_test<span style="color:#0550ae">.</span>min<span style="color:#1f2328">(),</span> y_pred<span style="color:#0550ae">.</span>min<span style="color:#1f2328">()),</span> <span style="color:#6639ba">max</span><span style="color:#1f2328">(</span>y_test<span style="color:#0550ae">.</span>max<span style="color:#1f2328">(),</span> y_pred<span style="color:#0550ae">.</span>max<span style="color:#1f2328">())],</span>
</span></span><span style="display:flex;"><span>             <span style="color:#0a3069">&#39;--&#39;</span><span style="color:#1f2328">,</span> color<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;red&#39;</span><span style="color:#1f2328">,</span> linewidth<span style="color:#0550ae">=</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span> 
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>xlabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Actual Resale Price&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>ylabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Predicted Resale Price&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>title<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Actual vs. Predicted Resale Price&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>grid<span style="color:#1f2328">(</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#0550ae">.</span>show<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Check if history object contains loss and val_loss</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;loss&#39;</span> <span style="color:#0550ae">in</span> history<span style="color:#0550ae">.</span>history <span style="color:#0550ae">and</span> <span style="color:#0a3069">&#39;val_loss&#39;</span> <span style="color:#0550ae">in</span> history<span style="color:#0550ae">.</span>history<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>figure<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span><span style="color:#0550ae">10</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">6</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>plot<span style="color:#1f2328">(</span>history<span style="color:#0550ae">.</span>history<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;loss&#39;</span><span style="color:#1f2328">],</span> label<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;Training Loss&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>plot<span style="color:#1f2328">(</span>history<span style="color:#0550ae">.</span>history<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;val_loss&#39;</span><span style="color:#1f2328">],</span> label<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;Validation Loss&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>xlabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Epochs&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>ylabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Loss (MSE)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>title<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Training and Validation Loss&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>legend<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>grid<span style="color:#1f2328">(</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        plt<span style="color:#0550ae">.</span>show<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Loss history not found for plotting.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;model&#39;</span><span style="color:#1f2328">:</span> model<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;history&#39;</span><span style="color:#1f2328">:</span> history<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;X_test&#39;</span><span style="color:#1f2328">:</span> X_test<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;y_test&#39;</span><span style="color:#1f2328">:</span> y_test<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;y_pred&#39;</span><span style="color:#1f2328">:</span> y_pred<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;mse&#39;</span><span style="color:#1f2328">:</span> mse<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">:</span> rmse<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;r2&#39;</span><span style="color:#1f2328">:</span> r2<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;mae&#39;</span><span style="color:#1f2328">:</span> mae<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;X_scaler&#39;</span><span style="color:#1f2328">:</span> X_scaler<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;y_scaler&#39;</span><span style="color:#1f2328">:</span> y_scaler<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;feature_names&#39;</span><span style="color:#1f2328">:</span> feature_names
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>results <span style="color:#0550ae">=</span> train_model_with_features<span style="color:#1f2328">(</span>X<span style="color:#1f2328">,</span> y<span style="color:#1f2328">,</span> feature_columns<span style="color:#1f2328">,</span> epochs<span style="color:#0550ae">=</span><span style="color:#0550ae">50</span><span style="color:#1f2328">,</span> batch_size<span style="color:#0550ae">=</span><span style="color:#0550ae">64</span><span style="color:#1f2328">,</span> verbose<span style="color:#0550ae">=</span><span style="color:#0550ae">1</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Training complete.&#34;</span><span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
  </div>
</details></p>
<p>The model learns to minimize Mean Squared Error (MSE), and we track Mean Absolute Error (MAE) to gauge real-world price prediction deviation.</p>


































 
  
  





  <img src="/images/hdb/hdb-neural-networks-training.png"   alt="hdb-neural-networks-training" class="sc-image sc-image-default"
       >


<h3 id="training-history">Training History</h3>
<p>You can visualize how the model trains over time—helpful for spotting underfitting or overfitting trends.</p>


































 
  
  





  <img src="/images/hdb/hdb-neural-networks-performance.png"   alt="hdb-neural-networks-performance" class="sc-image sc-image-default"
       >




































 
  
  





  <img src="/images/hdb/hdb-neural-networks-training-loss.png"   alt="hdb-neural-networks-training-loss" class="sc-image sc-image-default"
       >


<h3 id="neural-network-predict-price">Neural Network Predict Price</h3>
<p>After training, the model&rsquo;s performance on unseen test data is crucial.

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    Neural Networks Predict Price - python code
  </summary>
  <div class="details-shortcode__content">
    
    
    





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">predict_price</span><span style="color:#1f2328">(</span>input_data<span style="color:#1f2328">,</span> model<span style="color:#1f2328">,</span> x_scaler<span style="color:#1f2328">,</span> y_scaler<span style="color:#1f2328">,</span> feature_names_list<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        df_input <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">([</span>input_data<span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        original_categorical_cols <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;town&#39;</span> <span style="color:#0550ae">in</span> df_input<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             original_categorical_cols<span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;flat_type&#39;</span> <span style="color:#0550ae">in</span> df_input<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             original_categorical_cols<span style="color:#0550ae">.</span>append<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> original_categorical_cols<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             df_input <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>get_dummies<span style="color:#1f2328">(</span>df_input<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>original_categorical_cols<span style="color:#1f2328">,</span> dtype<span style="color:#0550ae">=</span><span style="color:#6639ba">int</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        df_aligned <span style="color:#0550ae">=</span> df_input<span style="color:#0550ae">.</span>reindex<span style="color:#1f2328">(</span>columns<span style="color:#0550ae">=</span>feature_names_list<span style="color:#1f2328">,</span> fill_value<span style="color:#0550ae">=</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        X_new <span style="color:#0550ae">=</span> df_aligned<span style="color:#0550ae">.</span>values
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        expected_features <span style="color:#0550ae">=</span> model<span style="color:#0550ae">.</span>input_shape<span style="color:#1f2328">[</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> X_new<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">[</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">!=</span> expected_features<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error: Input data has </span><span style="color:#0a3069">{</span>X_new<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">[</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> features, but model expects </span><span style="color:#0a3069">{</span>expected_features<span style="color:#0a3069">}</span><span style="color:#0a3069">.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>             <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Feature mismatch. Ensure input_data and feature_names_list are correct.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>             <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Expected features:&#34;</span><span style="color:#1f2328">,</span> feature_names_list<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>             <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Provided features after processing:&#34;</span><span style="color:#1f2328">,</span> df_aligned<span style="color:#0550ae">.</span>columns<span style="color:#0550ae">.</span>tolist<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>             <span style="color:#cf222e">return</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        X_new_scaled <span style="color:#0550ae">=</span> x_scaler<span style="color:#0550ae">.</span>transform<span style="color:#1f2328">(</span>X_new<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        y_pred_scaled <span style="color:#0550ae">=</span> model<span style="color:#0550ae">.</span>predict<span style="color:#1f2328">(</span>X_new_scaled<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        y_pred <span style="color:#0550ae">=</span> y_scaler<span style="color:#0550ae">.</span>inverse_transform<span style="color:#1f2328">(</span>y_pred_scaled<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        predicted_price <span style="color:#0550ae">=</span> y_pred<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">][</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> predicted_price
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;An error occurred during prediction: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">import</span> <span style="color:#24292e">traceback</span>
</span></span><span style="display:flex;"><span>        traceback<span style="color:#0550ae">.</span>print_exc<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Assuming &#39;results&#39; is the dictionary returned by your train_model_with_features function</span>
</span></span><span style="display:flex;"><span>trained_model <span style="color:#0550ae">=</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;model&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>fitted_x_scaler <span style="color:#0550ae">=</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;X_scaler&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>fitted_y_scaler <span style="color:#0550ae">=</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;y_scaler&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>model_feature_names <span style="color:#0550ae">=</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;feature_names&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Create a dictionary representing the flat you want to predict</span>
</span></span><span style="display:flex;"><span>new_flat_data <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">44.0</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">61.333</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">2.0</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">2018</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;ANG MO KIO&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;3 ROOM&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Predict the price</span>
</span></span><span style="display:flex;"><span>predicted_hdb_price <span style="color:#0550ae">=</span> predict_price<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    input_data<span style="color:#0550ae">=</span>new_flat_data<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#0550ae">=</span>trained_model<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    x_scaler<span style="color:#0550ae">=</span>fitted_x_scaler<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    y_scaler<span style="color:#0550ae">=</span>fitted_y_scaler<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    feature_names_list<span style="color:#0550ae">=</span>model_feature_names
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Display the result</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">if</span> predicted_hdb_price <span style="color:#0550ae">is</span> <span style="color:#0550ae">not</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">--- Prediction ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Input Features: </span><span style="color:#0a3069">{</span>new_flat_data<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Predicted Resale Price: $</span><span style="color:#0a3069">{</span>predicted_hdb_price<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Prediction failed. Please check the input data and error messages.&#34;</span><span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
  </div>
</details></p>
<p>This gives a sense of how close our predicted resale prices are to the actual values.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#57606a"># 1/1 [==============================] - 0s 11ms/step</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># --- Prediction ---</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Input Features: {&#39;floor_area_sqm&#39;: 44.0, &#39;remaining_lease_years&#39;: 61.333, &#39;storey_avg&#39;: 2.0, &#39;sale_year&#39;: 2018, &#39;sale_month&#39;: 1, &#39;town&#39;: &#39;ANG MO KIO&#39;, &#39;flat_type&#39;: &#39;3 ROOM&#39;}</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Predicted Resale Price: $248,929.12</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><h2 id="xgboost-regressor">XGBoost Regressor</h2>
<p>To complement the neural network, I also trained a Gradient Boosted Trees model using XGBoost—a powerful algorithm for tabular data.

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    XGBoost Regressor - python code
  </summary>
  <div class="details-shortcode__content">
    
    
    





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">pandas</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">numpy</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">np</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">matplotlib.pyplot</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">plt</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.model_selection</span> <span style="color:#cf222e">import</span> train_test_split
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">sklearn.preprocessing</span> <span style="color:#cf222e">import</span> MinMaxScaler
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">xgboost</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">xgb</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">xgboost</span> <span style="color:#cf222e">import</span> plot_importance
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">mlflow</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">mlflow.xgboost</span> 
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">os</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">joblib</span> 
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">traceback</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">get_dynamic_figsize</span><span style="color:#1f2328">(</span>feature_count<span style="color:#1f2328">,</span> max_features<span style="color:#0550ae">=</span><span style="color:#0550ae">20</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    height <span style="color:#0550ae">=</span> <span style="color:#6639ba">min</span><span style="color:#1f2328">(</span><span style="color:#0550ae">14</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">max</span><span style="color:#1f2328">(</span><span style="color:#0550ae">6</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">min</span><span style="color:#1f2328">(</span>feature_count<span style="color:#1f2328">,</span> max_features<span style="color:#1f2328">)</span> <span style="color:#0550ae">*</span> <span style="color:#0550ae">0.4</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>    width <span style="color:#0550ae">=</span> <span style="color:#0550ae">12</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> <span style="color:#1f2328">(</span>width<span style="color:#1f2328">,</span> height<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">train_xgboost_model</span><span style="color:#1f2328">(</span>X_data<span style="color:#1f2328">,</span> y_data<span style="color:#1f2328">,</span> feature_names<span style="color:#1f2328">,</span> n_estimators<span style="color:#0550ae">=</span><span style="color:#0550ae">100</span><span style="color:#1f2328">,</span> learning_rate<span style="color:#0550ae">=</span><span style="color:#0550ae">0.1</span><span style="color:#1f2328">,</span> max_depth<span style="color:#0550ae">=</span><span style="color:#0550ae">5</span><span style="color:#1f2328">,</span> early_stopping_rounds<span style="color:#0550ae">=</span><span style="color:#0550ae">10</span><span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>    colsample_bytree<span style="color:#0550ae">=</span><span style="color:#0550ae">0.8</span><span style="color:#1f2328">,</span> min_child_weight<span style="color:#0550ae">=</span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span> use_scaling<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span> verbose<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span> run_name<span style="color:#0550ae">=</span><span style="color:#cf222e">None</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    mlflow<span style="color:#0550ae">.</span>xgboost<span style="color:#0550ae">.</span>autolog<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        log_input_examples<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        log_model_signatures<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        log_models<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        log_datasets<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        disable<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    active_run <span style="color:#0550ae">=</span> mlflow<span style="color:#0550ae">.</span>active_run<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> active_run <span style="color:#0550ae">is</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>start_run<span style="color:#1f2328">(</span>run_name<span style="color:#0550ae">=</span>run_name<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>set_tag<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;mlflow.runName&#34;</span><span style="color:#1f2328">,</span> run_name<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        current_run <span style="color:#0550ae">=</span> mlflow<span style="color:#0550ae">.</span>active_run<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        current_run_id <span style="color:#0550ae">=</span> current_run<span style="color:#0550ae">.</span>info<span style="color:#0550ae">.</span>run_id
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Using MLflow Run ID: </span><span style="color:#0a3069">{</span>current_run_id<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Logging parameters manually...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;feature_set_name&#34;</span><span style="color:#1f2328">,</span> run_name <span style="color:#cf222e">if</span> run_name <span style="color:#cf222e">else</span> <span style="color:#0a3069">&#34;default_feature_set&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;num_features&#34;</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;n_estimators&#34;</span><span style="color:#1f2328">,</span> n_estimators<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;learning_rate&#34;</span><span style="color:#1f2328">,</span> learning_rate<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;max_depth&#34;</span><span style="color:#1f2328">,</span> max_depth<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;early_stopping_rounds&#34;</span><span style="color:#1f2328">,</span> early_stopping_rounds<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;colsample_bytree&#34;</span><span style="color:#1f2328">,</span> colsample_bytree<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;min_child_weight&#34;</span><span style="color:#1f2328">,</span> min_child_weight<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;use_scaling&#34;</span><span style="color:#1f2328">,</span> use_scaling<span style="color:#1f2328">)</span> 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        max_len <span style="color:#0550ae">=</span> <span style="color:#0550ae">250</span>
</span></span><span style="display:flex;"><span>        feature_names_str <span style="color:#0550ae">=</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names_str<span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;</span> max_len<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;feature_names_truncated&#34;</span><span style="color:#1f2328">,</span> feature_names_str<span style="color:#1f2328">[:</span>max_len<span style="color:#0550ae">-</span><span style="color:#0550ae">3</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> <span style="color:#0a3069">&#34;...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">with</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;feature_names.txt&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;w&#34;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">as</span> f<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                f<span style="color:#0550ae">.</span>write<span style="color:#1f2328">(</span>feature_names_str<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_artifact<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;feature_names.txt&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            os<span style="color:#0550ae">.</span>remove<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;feature_names.txt&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             mlflow<span style="color:#0550ae">.</span>log_param<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;feature_names&#34;</span><span style="color:#1f2328">,</span> feature_names_str<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- Data Preparation ---</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> <span style="color:#6639ba">isinstance</span><span style="color:#1f2328">(</span>X_data<span style="color:#1f2328">,</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Converting X_data (NumPy array) to DataFrame using provided feature_names.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            X_data <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">(</span>X_data<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>feature_names<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        X_data<span style="color:#0550ae">.</span>columns <span style="color:#0550ae">=</span> feature_names
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        X_train<span style="color:#1f2328">,</span> X_test<span style="color:#1f2328">,</span> y_train<span style="color:#1f2328">,</span> y_test <span style="color:#0550ae">=</span> train_test_split<span style="color:#1f2328">(</span>X_data<span style="color:#1f2328">,</span> y_data<span style="color:#1f2328">,</span> test_size<span style="color:#0550ae">=</span><span style="color:#0550ae">0.2</span><span style="color:#1f2328">,</span> random_state<span style="color:#0550ae">=</span><span style="color:#0550ae">42</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        X_scaler <span style="color:#0550ae">=</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> use_scaling<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Using Scaled Features for XGBoost.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            X_scaler <span style="color:#0550ae">=</span> MinMaxScaler<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Fit on Training, Transform Train and Test</span>
</span></span><span style="display:flex;"><span>            X_train_scaled_np  <span style="color:#0550ae">=</span> X_scaler<span style="color:#0550ae">.</span>fit_transform<span style="color:#1f2328">(</span>X_train<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            X_test_scaled_np  <span style="color:#0550ae">=</span> X_scaler<span style="color:#0550ae">.</span>transform<span style="color:#1f2328">(</span>X_test<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Convert back to DataFrame with original index and columns</span>
</span></span><span style="display:flex;"><span>            X_train <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">(</span>X_train_scaled_np<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>feature_names<span style="color:#1f2328">,</span> index<span style="color:#0550ae">=</span>X_train<span style="color:#0550ae">.</span>index<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            X_test <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">(</span>X_test_scaled_np<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>feature_names<span style="color:#1f2328">,</span> index<span style="color:#0550ae">=</span>X_test<span style="color:#0550ae">.</span>index<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;X_train range (scaled): </span><span style="color:#0a3069">{</span>X_train<span style="color:#0550ae">.</span>values<span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> to </span><span style="color:#0a3069">{</span>X_train<span style="color:#0550ae">.</span>values<span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                scaler_path <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;min_max_scaler.joblib&#34;</span>
</span></span><span style="display:flex;"><span>                joblib<span style="color:#0550ae">.</span>dump<span style="color:#1f2328">(</span>X_scaler<span style="color:#1f2328">,</span> scaler_path<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                mlflow<span style="color:#0550ae">.</span>log_artifact<span style="color:#1f2328">(</span>scaler_path<span style="color:#1f2328">,</span> artifact_path<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;scaler&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                os<span style="color:#0550ae">.</span>remove<span style="color:#1f2328">(</span>scaler_path<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Scaler logged as artifact.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                 <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Warning: Could not save or log scaler: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Using Original Features for XGBoost.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">--- Training XGBoost with </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> features ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;X_train shape:&#34;</span><span style="color:#1f2328">,</span> X_train<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;y_train shape:&#34;</span><span style="color:#1f2328">,</span> y_train<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;X_test shape:&#34;</span><span style="color:#1f2328">,</span> X_test<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;y_test shape:&#34;</span><span style="color:#1f2328">,</span> y_test<span style="color:#0550ae">.</span>shape<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;X_train columns:&#34;</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">(</span>X_train<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#6639ba">isinstance</span><span style="color:#1f2328">(</span>y_train<span style="color:#1f2328">,</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">):</span> y_train_series <span style="color:#0550ae">=</span> y_train<span style="color:#0550ae">.</span>iloc<span style="color:#1f2328">[:,</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">elif</span> <span style="color:#6639ba">isinstance</span><span style="color:#1f2328">(</span>y_train<span style="color:#1f2328">,</span> np<span style="color:#0550ae">.</span>ndarray<span style="color:#1f2328">):</span> y_train_series <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>Series<span style="color:#1f2328">(</span>y_train<span style="color:#0550ae">.</span>ravel<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span> y_train_series <span style="color:#0550ae">=</span> y_train
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Any NaN in y_train:&#34;</span><span style="color:#1f2328">,</span> y_train_series<span style="color:#0550ae">.</span>isnull<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>any<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- Model Training ---</span>
</span></span><span style="display:flex;"><span>        xgb_model <span style="color:#0550ae">=</span> xgb<span style="color:#0550ae">.</span>XGBRegressor<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            objective<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;reg:squarederror&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            n_estimators<span style="color:#0550ae">=</span>n_estimators<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            learning_rate<span style="color:#0550ae">=</span>learning_rate<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            max_depth<span style="color:#0550ae">=</span>max_depth<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            subsample<span style="color:#0550ae">=</span><span style="color:#0550ae">0.8</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            colsample_bytree<span style="color:#0550ae">=</span>colsample_bytree<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            min_child_weight<span style="color:#0550ae">=</span>min_child_weight<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            random_state<span style="color:#0550ae">=</span><span style="color:#0550ae">42</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            n_jobs<span style="color:#0550ae">=-</span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            enable_categorical<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            eval_metric<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            early_stopping_rounds<span style="color:#0550ae">=</span>early_stopping_rounds
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        eval_set <span style="color:#0550ae">=</span> <span style="color:#1f2328">[(</span>X_test<span style="color:#1f2328">,</span> y_test<span style="color:#1f2328">)]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Training XGBoost for up to </span><span style="color:#0a3069">{</span>n_estimators<span style="color:#0a3069">}</span><span style="color:#0a3069"> rounds with early stopping patience </span><span style="color:#0a3069">{</span>early_stopping_rounds<span style="color:#0a3069">}</span><span style="color:#0a3069">...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        xgb_model<span style="color:#0550ae">.</span>fit<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            X_train<span style="color:#1f2328">,</span> y_train<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            eval_set<span style="color:#0550ae">=</span>eval_set<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            verbose<span style="color:#0550ae">=</span>verbose
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>xgboost<span style="color:#0550ae">.</span>log_model<span style="color:#1f2328">(</span>xgb_model<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;model&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- Prediction and Evaluation ---</span>
</span></span><span style="display:flex;"><span>        y_pred <span style="color:#0550ae">=</span> xgb_model<span style="color:#0550ae">.</span>predict<span style="color:#1f2328">(</span>X_test<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#6639ba">isinstance</span><span style="color:#1f2328">(</span>y_test<span style="color:#1f2328">,</span> <span style="color:#1f2328">(</span>pd<span style="color:#0550ae">.</span>Series<span style="color:#1f2328">,</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">)):</span>
</span></span><span style="display:flex;"><span>            y_test_np <span style="color:#0550ae">=</span> y_test<span style="color:#0550ae">.</span>values<span style="color:#0550ae">.</span>ravel<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            y_test_np <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>array<span style="color:#1f2328">(</span>y_test<span style="color:#1f2328">)</span><span style="color:#0550ae">.</span>ravel<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        valid_indices <span style="color:#0550ae">=</span> <span style="color:#0550ae">~</span>np<span style="color:#0550ae">.</span>isnan<span style="color:#1f2328">(</span>y_test_np<span style="color:#1f2328">)</span> <span style="color:#0550ae">&amp;</span> <span style="color:#0550ae">~</span>np<span style="color:#0550ae">.</span>isinf<span style="color:#1f2328">(</span>y_test_np<span style="color:#1f2328">)</span> <span style="color:#0550ae">&amp;</span> <span style="color:#0550ae">~</span>np<span style="color:#0550ae">.</span>isnan<span style="color:#1f2328">(</span>y_pred<span style="color:#1f2328">)</span> <span style="color:#0550ae">&amp;</span> <span style="color:#0550ae">~</span>np<span style="color:#0550ae">.</span>isinf<span style="color:#1f2328">(</span>y_pred<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> np<span style="color:#0550ae">.</span>all<span style="color:#1f2328">(</span>valid_indices<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Warning: NaN or Inf detected in y_test or y_pred. Metrics calculated on valid data points only.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            y_test_np <span style="color:#0550ae">=</span> y_test_np<span style="color:#1f2328">[</span>valid_indices<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>            y_pred <span style="color:#0550ae">=</span> y_pred<span style="color:#1f2328">[</span>valid_indices<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        mse <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>mean<span style="color:#1f2328">((</span>y_test_np <span style="color:#0550ae">-</span> y_pred<span style="color:#1f2328">)</span><span style="color:#0550ae">**</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        rmse <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>sqrt<span style="color:#1f2328">(</span>mse<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mae <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>mean<span style="color:#1f2328">(</span>np<span style="color:#0550ae">.</span>abs<span style="color:#1f2328">(</span>y_test_np <span style="color:#0550ae">-</span> y_pred<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> np<span style="color:#0550ae">.</span>var<span style="color:#1f2328">(</span>y_test_np<span style="color:#1f2328">)</span> <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">1e-9</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             r2 <span style="color:#0550ae">=</span> <span style="color:#0550ae">1</span> <span style="color:#0550ae">-</span> <span style="color:#1f2328">(</span>np<span style="color:#0550ae">.</span>sum<span style="color:#1f2328">((</span>y_test_np <span style="color:#0550ae">-</span> y_pred<span style="color:#1f2328">)</span><span style="color:#0550ae">**</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">/</span> np<span style="color:#0550ae">.</span>sum<span style="color:#1f2328">((</span>y_test_np <span style="color:#0550ae">-</span> np<span style="color:#0550ae">.</span>mean<span style="color:#1f2328">(</span>y_test_np<span style="color:#1f2328">))</span><span style="color:#0550ae">**</span><span style="color:#0550ae">2</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             r2 <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>        best_iteration <span style="color:#0550ae">=</span> xgb_model<span style="color:#0550ae">.</span>best_iteration <span style="color:#cf222e">if</span> <span style="color:#6639ba">hasattr</span><span style="color:#1f2328">(</span>xgb_model<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;best_iteration&#39;</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">and</span> xgb_model<span style="color:#0550ae">.</span>best_iteration <span style="color:#0550ae">is</span> <span style="color:#0550ae">not</span> <span style="color:#cf222e">None</span> <span style="color:#cf222e">else</span> n_estimators
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- Log Metrics Manually ---</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Logging final evaluation metrics to MLflow...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_metric<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;eval_mse&#34;</span><span style="color:#1f2328">,</span> mse<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_metric<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;eval_rmse&#34;</span><span style="color:#1f2328">,</span> rmse<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_metric<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;eval_mae&#34;</span><span style="color:#1f2328">,</span> mae<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#0550ae">not</span> np<span style="color:#0550ae">.</span>isnan<span style="color:#1f2328">(</span>r2<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_metric<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;eval_r2&#34;</span><span style="color:#1f2328">,</span> r2<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>log_metric<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;best_iteration&#34;</span><span style="color:#1f2328">,</span> best_iteration<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">--- XGBoost Model Performance ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;(Features: </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069">, Scaled: </span><span style="color:#0a3069">{</span>use_scaling<span style="color:#0a3069">}</span><span style="color:#0a3069">)&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Best Iteration: </span><span style="color:#0a3069">{</span>best_iteration<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Test Set MSE: </span><span style="color:#0a3069">{</span>mse<span style="color:#0a3069">:</span><span style="color:#0a3069">,.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Test Set RMSE: </span><span style="color:#0a3069">{</span>rmse<span style="color:#0a3069">:</span><span style="color:#0a3069">,.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Test Set MAE: </span><span style="color:#0a3069">{</span>mae<span style="color:#0a3069">:</span><span style="color:#0a3069">,.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Test Set R²: </span><span style="color:#0a3069">{</span><span style="color:#0a3069">&#39;N/A&#39;</span> <span style="color:#cf222e">if</span> np<span style="color:#0550ae">.</span>isnan<span style="color:#1f2328">(</span>r2<span style="color:#1f2328">)</span> <span style="color:#cf222e">else</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#39;</span><span style="color:#0a3069">{</span>r2<span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#39;</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- Log Custom Plots as Artifacts ---</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Generating and logging custom plots to MLflow...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Plotting Actual vs Predicted</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            fig_pred<span style="color:#1f2328">,</span> ax_pred <span style="color:#0550ae">=</span> plt<span style="color:#0550ae">.</span>subplots<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span><span style="color:#0550ae">10</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">6</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>scatter<span style="color:#1f2328">(</span>y_test_np<span style="color:#1f2328">,</span> y_pred<span style="color:#1f2328">,</span> alpha<span style="color:#0550ae">=</span><span style="color:#0550ae">0.5</span><span style="color:#1f2328">,</span> label<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Predictions&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            min_val <span style="color:#0550ae">=</span> <span style="color:#6639ba">min</span><span style="color:#1f2328">(</span>y_test_np<span style="color:#0550ae">.</span>min<span style="color:#1f2328">(),</span> y_pred<span style="color:#0550ae">.</span>min<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>            max_val <span style="color:#0550ae">=</span> <span style="color:#6639ba">max</span><span style="color:#1f2328">(</span>y_test_np<span style="color:#0550ae">.</span>max<span style="color:#1f2328">(),</span> y_pred<span style="color:#0550ae">.</span>max<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>plot<span style="color:#1f2328">([</span>min_val<span style="color:#1f2328">,</span> max_val<span style="color:#1f2328">],</span> <span style="color:#1f2328">[</span>min_val<span style="color:#1f2328">,</span> max_val<span style="color:#1f2328">],</span> <span style="color:#0a3069">&#39;--&#39;</span><span style="color:#1f2328">,</span> color<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;red&#39;</span><span style="color:#1f2328">,</span> linewidth<span style="color:#0550ae">=</span><span style="color:#0550ae">2</span><span style="color:#1f2328">,</span> label<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;Ideal Fit&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>set_xlabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Actual Target&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>set_ylabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Predicted Target (XGBoost)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>set_title<span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#39;Actual vs. Predicted (Run: </span><span style="color:#0a3069">{</span>run_name <span style="color:#0550ae">or</span> current_run_id<span style="color:#1f2328">[:</span><span style="color:#0550ae">8</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>legend<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            ax_pred<span style="color:#0550ae">.</span>grid<span style="color:#1f2328">(</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>tight_layout<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_figure<span style="color:#1f2328">(</span>fig_pred<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;actual_vs_predicted.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>close<span style="color:#1f2328">(</span>fig_pred<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Logged actual_vs_predicted.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Could not plot or log Actual vs Predicted plot: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Weight importance</span>
</span></span><span style="display:flex;"><span>            fig_imp_w<span style="color:#1f2328">,</span> ax_imp_w <span style="color:#0550ae">=</span> plt<span style="color:#0550ae">.</span>subplots<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span>get_dynamic_figsize<span style="color:#1f2328">(</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)))</span>
</span></span><span style="display:flex;"><span>            plot_importance<span style="color:#1f2328">(</span>xgb_model<span style="color:#1f2328">,</span> ax<span style="color:#0550ae">=</span>ax_imp_w<span style="color:#1f2328">,</span> max_num_features<span style="color:#0550ae">=</span><span style="color:#0550ae">20</span><span style="color:#1f2328">,</span> importance_type<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;weight&#39;</span><span style="color:#1f2328">,</span> show_values<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_imp_w<span style="color:#0550ae">.</span>set_title<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;XGBoost Feature Importance (Weight/F score)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>tight_layout<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_figure<span style="color:#1f2328">(</span>fig_imp_w<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;feature_importance_weight.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>close<span style="color:#1f2328">(</span>fig_imp_w<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Logged feature_importance_weight.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Gain importance</span>
</span></span><span style="display:flex;"><span>            fig_imp_g<span style="color:#1f2328">,</span> ax_imp_g <span style="color:#0550ae">=</span> plt<span style="color:#0550ae">.</span>subplots<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span>get_dynamic_figsize<span style="color:#1f2328">(</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)))</span>
</span></span><span style="display:flex;"><span>            plot_importance<span style="color:#1f2328">(</span>xgb_model<span style="color:#1f2328">,</span> ax<span style="color:#0550ae">=</span>ax_imp_g<span style="color:#1f2328">,</span> max_num_features<span style="color:#0550ae">=</span><span style="color:#0550ae">20</span><span style="color:#1f2328">,</span> importance_type<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;gain&#39;</span><span style="color:#1f2328">,</span> show_values<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_imp_g<span style="color:#0550ae">.</span>set_title<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;XGBoost Feature Importance (Gain)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>tight_layout<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_figure<span style="color:#1f2328">(</span>fig_imp_g<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;feature_importance_gain.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>close<span style="color:#1f2328">(</span>fig_imp_g<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Logged feature_importance_gain.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># Cover importance</span>
</span></span><span style="display:flex;"><span>            fig_imp_c<span style="color:#1f2328">,</span> ax_imp_c <span style="color:#0550ae">=</span> plt<span style="color:#0550ae">.</span>subplots<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span>get_dynamic_figsize<span style="color:#1f2328">(</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)))</span>
</span></span><span style="display:flex;"><span>            plot_importance<span style="color:#1f2328">(</span>xgb_model<span style="color:#1f2328">,</span> ax<span style="color:#0550ae">=</span>ax_imp_c<span style="color:#1f2328">,</span> max_num_features<span style="color:#0550ae">=</span><span style="color:#0550ae">20</span><span style="color:#1f2328">,</span> importance_type<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;cover&#39;</span><span style="color:#1f2328">,</span> show_values<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            ax_imp_c<span style="color:#0550ae">.</span>set_title<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;XGBoost Feature Importance (Cover)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>tight_layout<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>log_figure<span style="color:#1f2328">(</span>fig_imp_c<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;feature_importance_cover.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            plt<span style="color:#0550ae">.</span>close<span style="color:#1f2328">(</span>fig_imp_c<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Logged feature_importance_cover.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Could not plot or log importance plots: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Plot training history (RMSE)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            results <span style="color:#0550ae">=</span> xgb_model<span style="color:#0550ae">.</span>evals_result<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> results <span style="color:#0550ae">and</span> <span style="color:#0a3069">&#39;validation_0&#39;</span> <span style="color:#0550ae">in</span> results <span style="color:#0550ae">and</span> <span style="color:#0a3069">&#39;rmse&#39;</span> <span style="color:#0550ae">in</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;validation_0&#39;</span><span style="color:#1f2328">]:</span>
</span></span><span style="display:flex;"><span>                eval_metric_history <span style="color:#0550ae">=</span> results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;validation_0&#39;</span><span style="color:#1f2328">][</span><span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>                fig_hist<span style="color:#1f2328">,</span> ax_hist <span style="color:#0550ae">=</span> plt<span style="color:#0550ae">.</span>subplots<span style="color:#1f2328">(</span>figsize<span style="color:#0550ae">=</span><span style="color:#1f2328">(</span><span style="color:#0550ae">10</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">6</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>                epochs_ran <span style="color:#0550ae">=</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>eval_metric_history<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                x_axis <span style="color:#0550ae">=</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span><span style="color:#0550ae">0</span><span style="color:#1f2328">,</span> epochs_ran<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                ax_hist<span style="color:#0550ae">.</span>plot<span style="color:#1f2328">(</span>x_axis<span style="color:#1f2328">,</span> eval_metric_history<span style="color:#1f2328">,</span> label<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;Validation RMSE&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                ax_hist<span style="color:#0550ae">.</span>set_xlabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;Boosting Rounds&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                ax_hist<span style="color:#0550ae">.</span>set_ylabel<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;RMSE&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                ax_hist<span style="color:#0550ae">.</span>set_title<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;XGBoost Training History (Validation RMSE)&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                ax_hist<span style="color:#0550ae">.</span>legend<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>                ax_hist<span style="color:#0550ae">.</span>grid<span style="color:#1f2328">(</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                plt<span style="color:#0550ae">.</span>tight_layout<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>                mlflow<span style="color:#0550ae">.</span>log_figure<span style="color:#1f2328">(</span>fig_hist<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;training_rmse_history.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                plt<span style="color:#0550ae">.</span>close<span style="color:#1f2328">(</span>fig_hist<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Logged training_rmse_history.png&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Could not plot or log training history plot: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        mlflow<span style="color:#0550ae">.</span>end_run<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;MLflow Run completed and logging finished.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;mlflow_run_id&#39;</span><span style="color:#1f2328">:</span> current_run_id<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;model&#39;</span><span style="color:#1f2328">:</span> xgb_model<span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;evals_result&#39;</span><span style="color:#1f2328">:</span> xgb_model<span style="color:#0550ae">.</span>evals_result<span style="color:#1f2328">()</span> <span style="color:#cf222e">if</span> <span style="color:#6639ba">hasattr</span><span style="color:#1f2328">(</span>xgb_model<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;evals_result&#39;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">else</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;X_test&#39;</span><span style="color:#1f2328">:</span> X_test<span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;y_test&#39;</span><span style="color:#1f2328">:</span> y_test<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;y_pred&#39;</span><span style="color:#1f2328">:</span> y_pred<span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;mse&#39;</span><span style="color:#1f2328">:</span> mse<span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">:</span> rmse<span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;r2&#39;</span><span style="color:#1f2328">:</span> r2<span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;mae&#39;</span><span style="color:#1f2328">:</span> mae<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;X_scaler&#39;</span><span style="color:#1f2328">:</span> X_scaler<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;feature_names&#39;</span><span style="color:#1f2328">:</span> feature_names<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;best_iteration&#39;</span><span style="color:#1f2328">:</span> best_iteration
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">finally</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> active_run <span style="color:#0550ae">is</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            mlflow<span style="color:#0550ae">.</span>end_run<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;--- Running Experiment with MLflow ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>xgb_results <span style="color:#0550ae">=</span> train_xgboost_model<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    X<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    y<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    feature_columns<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    n_estimators<span style="color:#0550ae">=</span><span style="color:#0550ae">500</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    learning_rate<span style="color:#0550ae">=</span><span style="color:#0550ae">0.05</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    max_depth<span style="color:#0550ae">=</span><span style="color:#0550ae">6</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    early_stopping_rounds<span style="color:#0550ae">=</span><span style="color:#0550ae">15</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    use_scaling<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    verbose<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    run_name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#34;FeatureSet_TownFlatModel&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
  </div>
</details></p>


































 
  
  





  <img src="/images/hdb/hdb-xgboost-training-mlflow-logging.png"   alt="hdb-xgboost-training-mlflow-logging" class="sc-image sc-image-default"
       >




































 
  
  





  <img src="/images/hdb/hdb-xgboost-training-mlflow-overview.png"   alt="hdb-xgboost-training-mlflow-overview" class="sc-image sc-image-default"
       >




































 
  
  





  <img src="/images/hdb/hdb-xgboost-training-mlflow-artifacts-actual-vs-predicted.png"   alt="hdb-xgboost-training-mlflow-artifacts-actual-vs-predicted" class="sc-image sc-image-default"
       >




































 
  
  





  <img src="/images/hdb/hdb-xgboost-training-mlflow-artifacts-fscore.png"   alt="hdb-xgboost-training-mlflow-artifacts-fscore" class="sc-image sc-image-default"
       >


<h3 id="xgboost-predict-price">XGBoost Predict Price</h3>

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    XGBoost Predict Price - python code
  </summary>
  <div class="details-shortcode__content">
    
    
    





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">pandas</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">numpy</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">np</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">predict_price_xgboost</span><span style="color:#1f2328">(</span>input_data_dict<span style="color:#1f2328">,</span> model<span style="color:#1f2328">,</span> scaler<span style="color:#1f2328">,</span> feature_names<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># 1. Convert input dict to DataFrame</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        new_data_raw <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">(</span>input_data_dict<span style="color:#1f2328">,</span> index<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> ValueError<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        new_data_raw <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">({</span>k<span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>v<span style="color:#1f2328">]</span> <span style="color:#cf222e">for</span> k<span style="color:#1f2328">,</span> v <span style="color:#0550ae">in</span> input_data_dict<span style="color:#0550ae">.</span>items<span style="color:#1f2328">()},</span> index<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;--- Preprocessing New Data Inside Wrapper ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    new_data_processed <span style="color:#0550ae">=</span> new_data_raw<span style="color:#0550ae">.</span>copy<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Apply THE SAME Preprocessing Steps as Training Data ---</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;month&#39;</span> <span style="color:#0550ae">in</span> new_data_processed<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>to_datetime<span style="color:#1f2328">(</span>new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">],</span> <span style="color:#6639ba">format</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;%Y-%m&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>dt<span style="color:#0550ae">.</span>year
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>dt<span style="color:#0550ae">.</span>month
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_sin&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>sin<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span> <span style="color:#0550ae">*</span> np<span style="color:#0550ae">.</span>pi <span style="color:#0550ae">*</span> new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">/</span> <span style="color:#0550ae">12.0</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_cos&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> np<span style="color:#0550ae">.</span>cos<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span> <span style="color:#0550ae">*</span> np<span style="color:#0550ae">.</span>pi <span style="color:#0550ae">*</span> new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">/</span> <span style="color:#0550ae">12.0</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;remaining_lease&#39;</span> <span style="color:#0550ae">in</span> new_data_processed<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span>extract_years<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;storey_range&#39;</span> <span style="color:#0550ae">in</span> new_data_processed<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> new_data_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span>convert_storey<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    categorical_cols_base <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    cols_to_encode <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> categorical_cols_base <span style="color:#cf222e">if</span> col <span style="color:#0550ae">in</span> new_data_processed<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> cols_to_encode<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        new_data_processed <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>get_dummies<span style="color:#1f2328">(</span>new_data_processed<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>cols_to_encode<span style="color:#1f2328">,</span> prefix<span style="color:#0550ae">=</span>cols_to_encode<span style="color:#1f2328">,</span> dummy_na<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span> dtype<span style="color:#0550ae">=</span><span style="color:#6639ba">int</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Align columns to the required feature_names ---</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Aligning columns to </span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>feature_names<span style="color:#1f2328">)</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> features...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        X_new_prepared <span style="color:#0550ae">=</span> new_data_processed<span style="color:#0550ae">.</span>reindex<span style="color:#1f2328">(</span>columns<span style="color:#0550ae">=</span>feature_names<span style="color:#1f2328">,</span> fill_value<span style="color:#0550ae">=</span><span style="color:#0550ae">0</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error during reindex. Check feature_names and processed columns. Error: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Columns in processed data:&#34;</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">(</span>new_data_processed<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Columns expected by model:&#34;</span><span style="color:#1f2328">,</span> feature_names<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Columns aligned.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Scaling (if applicable) ---</span>
</span></span><span style="display:flex;"><span>    X_new_scaled <span style="color:#0550ae">=</span> X_new_prepared
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> scaler <span style="color:#0550ae">is</span> <span style="color:#0550ae">not</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Applying scaler...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            X_new_scaled_np <span style="color:#0550ae">=</span> scaler<span style="color:#0550ae">.</span>transform<span style="color:#1f2328">(</span>X_new_prepared<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            X_new_scaled <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">(</span>X_new_scaled_np<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>feature_names<span style="color:#1f2328">,</span> index<span style="color:#0550ae">=</span>X_new_prepared<span style="color:#0550ae">.</span>index<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>             <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error during scaling. Check data types. Error: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>             <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Data dtypes before scaling:</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">,</span> X_new_prepared<span style="color:#0550ae">.</span>dtypes<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>             <span style="color:#cf222e">return</span> <span style="color:#cf222e">None</span> <span style="color:#57606a"># Or raise error</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;No scaler applied.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Prediction ---</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Making prediction...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        prediction <span style="color:#0550ae">=</span> model<span style="color:#0550ae">.</span>predict<span style="color:#1f2328">(</span>X_new_scaled<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        final_prediction <span style="color:#0550ae">=</span> prediction<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">]</span> <span style="color:#cf222e">if</span> <span style="color:#6639ba">isinstance</span><span style="color:#1f2328">(</span>prediction<span style="color:#1f2328">,</span> np<span style="color:#0550ae">.</span>ndarray<span style="color:#1f2328">)</span> <span style="color:#cf222e">else</span> prediction
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Prediction successful.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> final_prediction
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error during model prediction: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>xgb_model <span style="color:#0550ae">=</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;model&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>X_scaler <span style="color:#0550ae">=</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;X_scaler&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>feature_names <span style="color:#0550ae">=</span> <span style="color:#6639ba">list</span><span style="color:#1f2328">(</span>xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;feature_names&#39;</span><span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>new_flat_data_raw <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0550ae">44.0</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;61 years 4 months&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;01 TO 03&#39;</span><span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;2018-01&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;ANG MO KIO&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;3 ROOM&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>predicted_price_xgb <span style="color:#0550ae">=</span> predict_price_xgboost<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    input_data_dict<span style="color:#0550ae">=</span>new_flat_data_raw<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#0550ae">=</span>xgb_model<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    scaler<span style="color:#0550ae">=</span>X_scaler<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    feature_names<span style="color:#0550ae">=</span>feature_names
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">if</span> predicted_price_xgb <span style="color:#0550ae">is</span> <span style="color:#0550ae">not</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Predicted HDB Price (XGBoost): $</span><span style="color:#0a3069">{</span>predicted_price_xgb<span style="color:#0a3069">:</span><span style="color:#0a3069">,.2f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">XGBoost prediction failed.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># --- Preprocessing New Data Inside Wrapper ---</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Aligning columns to 52 features...</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Columns aligned.</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Applying scaler...</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Making prediction...</span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Prediction successful.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Predicted HDB Price (XGBoost): $213,966.08</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
  </div>
</details>
<h2 id="optional---experimenting-with-features">Optional - Experimenting with Features</h2>
<p>To evaluate the impact of various feature combinations, I conducted a series of XGBoost experiments—exploring numerical, categorical, and engineered features. Each setup was tracked using MLflow to capture key performance metrics such as RMSE, MAE, and R². Here&rsquo;s how the different feature sets performed:</p>

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    Features experimenting - python code
  </summary>
  <div class="details-shortcode__content">
    
    
    <ol>
<li>Features Setup</li>
</ol>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>numerical_features <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>categorical_prefixes <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> X_data<span style="color:#0550ae">.</span>columns <span style="color:#cf222e">if</span> col<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;flat_type_&#39;</span><span style="color:#1f2328">)],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> X_data<span style="color:#0550ae">.</span>columns <span style="color:#cf222e">if</span> col<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;flat_model_&#39;</span><span style="color:#1f2328">)],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> X_data<span style="color:#0550ae">.</span>columns <span style="color:#cf222e">if</span> col<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;town_&#39;</span><span style="color:#1f2328">)]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Time-based features</span>
</span></span><span style="display:flex;"><span>df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;years_since_2017&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">-</span> <span style="color:#0550ae">2017</span>
</span></span><span style="display:flex;"><span>df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_of_year&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span><span style="color:#cf222e">lambda</span> x<span style="color:#1f2328">:</span> <span style="color:#1f2328">(</span>x<span style="color:#0550ae">-</span><span style="color:#0550ae">1</span><span style="color:#1f2328">)</span><span style="color:#0550ae">//</span><span style="color:#0550ae">3</span> <span style="color:#0550ae">+</span> <span style="color:#0550ae">1</span><span style="color:#1f2328">)</span>  <span style="color:#57606a"># Quarters</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Space-time interactions</span>
</span></span><span style="display:flex;"><span>df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_per_floor_area&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">/</span> df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># Lease remaining ratios</span>
</span></span><span style="display:flex;"><span>df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;lease_floor_ratio&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">/</span> df_processed<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>time_features <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;years_since_2017&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;month_of_year&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>numerical_less_time_features <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;floor_area_sqm&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>month_sin_cos_features <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_sin&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;month_cos&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>interaction_features <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_per_floor_area&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;lease_floor_ratio&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>new_engineered_features <span style="color:#0550ae">=</span> time_features <span style="color:#0550ae">+</span> interaction_features <span style="color:#0550ae">+</span> month_sin_cos_features
</span></span><span style="display:flex;"><span><span style="color:#cf222e">for</span> feature <span style="color:#0550ae">in</span> new_engineered_features<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    X_data<span style="color:#1f2328">[</span>feature<span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df_processed<span style="color:#1f2328">[</span>feature<span style="color:#1f2328">]</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><ol start="2">
<li>Experiment Setup</li>
</ol>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>experiments <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;Numerical+TimeBased&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> time_features <span style="color:#0550ae">+</span> numerical_less_time_features<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;NumericalOnly&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;Numerical+FlatType&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;Numerical+FlatModel&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;Numerical+Town&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;AllFeatures&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> 
</span></span><span style="display:flex;"><span>                   categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">False</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;Numerical+Engineered&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> new_engineered_features<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;AllFeatures+Scaling&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> 
</span></span><span style="display:flex;"><span>                   categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#39;Numerical+Town+FlatModel&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">:</span> numerical_features <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">+</span> categorical_prefixes<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">]</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><ol start="3">
<li>Running Experiments</li>
</ol>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>experiment_results <span style="color:#0550ae">=</span> <span style="color:#1f2328">[]</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">for</span> exp <span style="color:#0550ae">in</span> experiments<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">--- Running Experiment: </span><span style="color:#0a3069">{</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Features (</span><span style="color:#0a3069">{</span><span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">])</span><span style="color:#0a3069">}</span><span style="color:#0a3069">): </span><span style="color:#0a3069">{</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">][:</span><span style="color:#0550ae">5</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#0a3069">&#39;preprocessor&#39;</span> <span style="color:#0550ae">in</span> exp<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        X_modified <span style="color:#0550ae">=</span> exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;preprocessor&#39;</span><span style="color:#1f2328">](</span>X_data<span style="color:#0550ae">.</span>copy<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        X_modified <span style="color:#0550ae">=</span> X_data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Dynamic hyperparameter adjustment based on feature count</span>
</span></span><span style="display:flex;"><span>    feature_count <span style="color:#0550ae">=</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>    learning_rate <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.05</span>
</span></span><span style="display:flex;"><span>    max_depth <span style="color:#0550ae">=</span> <span style="color:#0550ae">6</span>
</span></span><span style="display:flex;"><span>    colsample_bytree <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.8</span>
</span></span><span style="display:flex;"><span>    min_child_weight <span style="color:#0550ae">=</span> <span style="color:#0550ae">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Adjust parameters for larger feature sets</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> feature_count <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">30</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        learning_rate <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.04</span>
</span></span><span style="display:flex;"><span>        max_depth <span style="color:#0550ae">=</span> <span style="color:#0550ae">7</span>
</span></span><span style="display:flex;"><span>        colsample_bytree <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.7</span>
</span></span><span style="display:flex;"><span>        min_child_weight <span style="color:#0550ae">=</span> <span style="color:#0550ae">3</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    xgb_results <span style="color:#0550ae">=</span> train_xgboost_model<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        X_modified<span style="color:#1f2328">[</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">]],</span>
</span></span><span style="display:flex;"><span>        y_data<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        feature_names<span style="color:#0550ae">=</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        n_estimators<span style="color:#0550ae">=</span><span style="color:#0550ae">500</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        learning_rate<span style="color:#0550ae">=</span>learning_rate<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        max_depth<span style="color:#0550ae">=</span>max_depth<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        early_stopping_rounds<span style="color:#0550ae">=</span><span style="color:#0550ae">15</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        colsample_bytree<span style="color:#0550ae">=</span>colsample_bytree<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        min_child_weight<span style="color:#0550ae">=</span>min_child_weight<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        use_scaling<span style="color:#0550ae">=</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        verbose<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        run_name<span style="color:#0550ae">=</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Exp_</span><span style="color:#0a3069">{</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;RMSE for </span><span style="color:#0a3069">{</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">: </span><span style="color:#0a3069">{</span>xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;R2 for </span><span style="color:#0a3069">{</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">: </span><span style="color:#0a3069">{</span>xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;r2&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;MAE for </span><span style="color:#0a3069">{</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">: </span><span style="color:#0a3069">{</span>xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;mae&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">:</span><span style="color:#0a3069">.4f</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    experiment_results<span style="color:#0550ae">.</span>append<span style="color:#1f2328">({</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">:</span> exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;name&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;num_features&#39;</span><span style="color:#1f2328">:</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;features&#39;</span><span style="color:#1f2328">]),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">:</span> exp<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;use_scaling&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">:</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;r2&#39;</span><span style="color:#1f2328">:</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;r2&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;mae&#39;</span><span style="color:#1f2328">:</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;mae&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;best_iteration&#39;</span><span style="color:#1f2328">:</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;best_iteration&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;mlflow_run_id&#39;</span><span style="color:#1f2328">:</span> xgb_results<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;mlflow_run_id&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">})</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>results_df <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>DataFrame<span style="color:#1f2328">(</span>experiment_results<span style="color:#1f2328">)</span><span style="color:#0550ae">.</span>sort_values<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;rmse&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">--- Experiment Summary ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>results_df<span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
  </div>
</details>


































 
  
  





  <img src="/images/hdb/hdb-xgboost-training-mlflow-compare-runs.png"   alt="hdb-xgboost-training-mlflow-compare-runs" class="sc-image sc-image-default"
       >




































 
  
  





  <img src="/images/hdb/hdb-xgboost-training-mlflow-compare-artifacts.png"   alt="hdb-xgboost-training-mlflow-compare-artifacts" class="sc-image sc-image-default"
       >


<h2 id="optional---data-preprocess-pipeline">Optional - Data Preprocess Pipeline</h2>
<p>To ensure our model receives clean and well-structured input, we’ll build a preprocessing pipeline that:</p>
<ul>
<li>Reads raw CSV data from MinIO</li>
<li>Cleans and transforms important fields (e.g., lease years, storey ranges)</li>
<li>Applies one-hot encoding on categorical variables</li>
<li>Saves the output in Parquet format for downstream training</li>
</ul>
<p>This preprocessing step is encapsulated as a Kubeflow Pipeline component.</p>

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    Kubeflow pipeline - python code
  </summary>
  <div class="details-shortcode__content">
    
    
    





<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">kfp</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">kfp</span> <span style="color:#cf222e">import</span> dsl
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">kfp.client</span> <span style="color:#cf222e">import</span> Client
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">kfp.compiler</span> <span style="color:#cf222e">import</span> Compiler
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">kfp.dsl</span> <span style="color:#cf222e">import</span> Input<span style="color:#1f2328">,</span> Output<span style="color:#1f2328">,</span> Dataset<span style="color:#1f2328">,</span> Model<span style="color:#1f2328">,</span> Metrics<span style="color:#1f2328">,</span> OutputPath<span style="color:#1f2328">,</span> InputPath
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">@dsl.component</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    base_image<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;python:3.10&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    packages_to_install<span style="color:#0550ae">=</span><span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;pandas==2.1.4&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;numpy==1.24.4&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;scikit-learn==1.3.2&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;pyarrow==19.0.1&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;s3fs&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">preprocess_resale_data</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    raw_data_path<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> 
</span></span><span style="display:flex;"><span>    processed_data_output_path<span style="color:#1f2328">:</span> OutputPath<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Dataset&#34;</span><span style="color:#1f2328">),</span>
</span></span><span style="display:flex;"><span>    permanent_output_uri<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">import</span> <span style="color:#24292e">pandas</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">pd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">import</span> <span style="color:#24292e">numpy</span> <span style="color:#cf222e">as</span> <span style="color:#24292e">np</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">import</span> <span style="color:#24292e">os</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;--- Starting Preprocessing ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Raw data S3 URI: </span><span style="color:#0a3069">{</span>raw_data_path<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;KFP Output Path (for artifact tracking): </span><span style="color:#0a3069">{</span>processed_data_output_path<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Permanent Output URI (for custom storage): </span><span style="color:#0a3069">{</span>permanent_output_uri<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Define MinIO Connection Details ---</span>
</span></span><span style="display:flex;"><span>    minio_endpoint_url <span style="color:#0550ae">=</span> os<span style="color:#0550ae">.</span>environ<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;AWS_ENDPOINT_URL&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;http://minio-service.kubeflow:9000&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    minio_access_key <span style="color:#0550ae">=</span> os<span style="color:#0550ae">.</span>environ<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;AWS_ACCESS_KEY_ID&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;minio&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    minio_secret_key <span style="color:#0550ae">=</span> os<span style="color:#0550ae">.</span>environ<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;AWS_SECRET_ACCESS_KEY&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;minio123&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    s3_storage_options <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;key&#39;</span><span style="color:#1f2328">:</span> minio_access_key<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;secret&#39;</span><span style="color:#1f2328">:</span> minio_secret_key<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#39;client_kwargs&#39;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#0a3069">&#39;endpoint_url&#39;</span><span style="color:#1f2328">:</span> minio_endpoint_url
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Load Data ---</span>
</span></span><span style="display:flex;"><span>    df <span style="color:#0550ae">=</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        df <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>read_csv<span style="color:#1f2328">(</span>raw_data_path<span style="color:#1f2328">,</span> skipinitialspace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">,</span> storage_options<span style="color:#0550ae">=</span>s3_storage_options<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Successfully loaded DataFrame using pandas+s3fs with storage_options. Shape: </span><span style="color:#0a3069">{</span>df<span style="color:#0550ae">.</span>shape<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> FileNotFoundError<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error: The S3 object &#39;</span><span style="color:#0a3069">{</span>raw_data_path<span style="color:#0a3069">}</span><span style="color:#0a3069">&#39; was not found.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">raise</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;An error occurred while reading the CSV file from S3: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">raise</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> df <span style="color:#0550ae">is</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">raise</span> RuntimeError<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;DataFrame could not be loaded.&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">DataFrame Info before processing:&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#0550ae">.</span>info<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">extract_years</span><span style="color:#1f2328">(</span>lease_str<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> pd<span style="color:#0550ae">.</span>isna<span style="color:#1f2328">(</span>lease_str<span style="color:#1f2328">):</span> <span style="color:#cf222e">return</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>        parts <span style="color:#0550ae">=</span> lease_str<span style="color:#0550ae">.</span>split<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        years <span style="color:#0550ae">=</span> <span style="color:#0550ae">0</span>
</span></span><span style="display:flex;"><span>        months <span style="color:#0550ae">=</span> <span style="color:#0550ae">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">for</span> i<span style="color:#1f2328">,</span> part <span style="color:#0550ae">in</span> <span style="color:#6639ba">enumerate</span><span style="color:#1f2328">(</span>parts<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> part<span style="color:#0550ae">.</span>isdigit<span style="color:#1f2328">():</span>
</span></span><span style="display:flex;"><span>                value <span style="color:#0550ae">=</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">(</span>part<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">if</span> i <span style="color:#0550ae">+</span> <span style="color:#0550ae">1</span> <span style="color:#0550ae">&lt;</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>parts<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>                    unit <span style="color:#0550ae">=</span> parts<span style="color:#1f2328">[</span>i<span style="color:#0550ae">+</span><span style="color:#0550ae">1</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>lower<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#cf222e">if</span> unit<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;year&#39;</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>                        years <span style="color:#0550ae">+=</span> value
</span></span><span style="display:flex;"><span>                    <span style="color:#cf222e">elif</span> unit<span style="color:#0550ae">.</span>startswith<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>                        months <span style="color:#0550ae">+=</span> value
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">return</span> years <span style="color:#0550ae">+</span> months <span style="color:#0550ae">/</span> <span style="color:#0550ae">12.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">def</span> <span style="color:#6639ba">convert_storey</span><span style="color:#1f2328">(</span>storey_range<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> pd<span style="color:#0550ae">.</span>isna<span style="color:#1f2328">(</span>storey_range<span style="color:#1f2328">):</span> <span style="color:#cf222e">return</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            low<span style="color:#1f2328">,</span> high <span style="color:#0550ae">=</span> <span style="color:#6639ba">map</span><span style="color:#1f2328">(</span><span style="color:#6639ba">int</span><span style="color:#1f2328">,</span> storey_range<span style="color:#0550ae">.</span>split<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39; TO &#39;</span><span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> <span style="color:#1f2328">(</span>low <span style="color:#0550ae">+</span> high<span style="color:#1f2328">)</span> <span style="color:#0550ae">/</span> <span style="color:#0550ae">2.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Warning: Could not parse storey_range: </span><span style="color:#0a3069">{</span>storey_range<span style="color:#0a3069">}</span><span style="color:#0a3069">. Error: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> np<span style="color:#0550ae">.</span>nan
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Apply Feature Engineering ---</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Remaining Lease</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Processing &#39;remaining_lease&#39;...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span>extract_years<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Min/Max remaining lease years (raw): </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> / </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    nan_count_lease <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>sum<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;NaNs in remaining lease years: </span><span style="color:#0a3069">{</span>nan_count_lease<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> nan_count_lease <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        median_lease <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>median<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Imputing </span><span style="color:#0a3069">{</span>nan_count_lease<span style="color:#0a3069">}</span><span style="color:#0a3069"> NaNs with median: </span><span style="color:#0a3069">{</span>median_lease<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;remaining_lease_years&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>fillna<span style="color:#1f2328">(</span>median_lease<span style="color:#1f2328">,</span> inplace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Storey Range</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Processing &#39;storey_range&#39;...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>apply<span style="color:#1f2328">(</span>convert_storey<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Min/Max storey avg (raw): </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> / </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    nan_count_storey <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>isna<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>sum<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;NaNs in storey_avg: </span><span style="color:#0a3069">{</span>nan_count_storey<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> nan_count_storey <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        median_storey <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>median<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Imputing </span><span style="color:#0a3069">{</span>nan_count_storey<span style="color:#0a3069">}</span><span style="color:#0a3069"> NaNs with median: </span><span style="color:#0a3069">{</span>median_storey<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;storey_avg&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>fillna<span style="color:#1f2328">(</span>median_storey<span style="color:#1f2328">,</span> inplace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># Date Features</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Processing &#39;month&#39;...&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_dt&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>to_datetime<span style="color:#1f2328">(</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">],</span> <span style="color:#6639ba">format</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;%Y-%m&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_dt&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>dt<span style="color:#0550ae">.</span>year
</span></span><span style="display:flex;"><span>        df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month_dt&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>dt<span style="color:#0550ae">.</span>month
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Created &#39;sale_year&#39; (Min/Max): </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> / </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_year&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Created &#39;sale_month&#39; (Min/Max): </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>min<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069"> / </span><span style="color:#0a3069">{</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;sale_month&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>max<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Error processing date column &#39;month&#39;: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">raise</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># One-Hot Encoding</span>
</span></span><span style="display:flex;"><span>    categorical_cols <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;flat_type&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;flat_model&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;town&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Applying One-Hot Encoding to: </span><span style="color:#0a3069">{</span>categorical_cols<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    valid_cat_cols <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> categorical_cols <span style="color:#cf222e">if</span> col <span style="color:#0550ae">in</span> df<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>valid_cat_cols<span style="color:#1f2328">)</span> <span style="color:#0550ae">!=</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>categorical_cols<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Warning: Missing some categorical columns in the DataFrame. Found: </span><span style="color:#0a3069">{</span>valid_cat_cols<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>get_dummies<span style="color:#1f2328">(</span>df<span style="color:#1f2328">,</span> columns<span style="color:#0550ae">=</span>valid_cat_cols<span style="color:#1f2328">,</span> prefix<span style="color:#0550ae">=</span>valid_cat_cols<span style="color:#1f2328">,</span> dummy_na<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span> dtype<span style="color:#0550ae">=</span><span style="color:#6639ba">int</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Shape after One-Hot Encoding: </span><span style="color:#0a3069">{</span>df<span style="color:#0550ae">.</span>shape<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- Select Final Columns &amp; Save ---</span>
</span></span><span style="display:flex;"><span>    cols_to_drop <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;month&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;remaining_lease&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;storey_range&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;block&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;street_name&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;lease_commence_date&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;month_dt&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    cols_exist_to_drop <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span>col <span style="color:#cf222e">for</span> col <span style="color:#0550ae">in</span> cols_to_drop <span style="color:#cf222e">if</span> col <span style="color:#0550ae">in</span> df<span style="color:#0550ae">.</span>columns<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#0550ae">.</span>drop<span style="color:#1f2328">(</span>columns<span style="color:#0550ae">=</span>cols_exist_to_drop<span style="color:#1f2328">,</span> inplace<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Dropped original/intermediate columns: </span><span style="color:#0a3069">{</span>cols_exist_to_drop<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Final columns in processed DataFrame:&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>df<span style="color:#0550ae">.</span>columns<span style="color:#0550ae">.</span>tolist<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Processed DataFrame Info:&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    df<span style="color:#0550ae">.</span>info<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">\n</span><span style="color:#0a3069">Saving copy of processed data to permanent URI: </span><span style="color:#0a3069">{</span>permanent_output_uri<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">try</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        df<span style="color:#0550ae">.</span>to_parquet<span style="color:#1f2328">(</span>permanent_output_uri<span style="color:#1f2328">,</span> index<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span> engine<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;pyarrow&#39;</span><span style="color:#1f2328">,</span> storage_options<span style="color:#0550ae">=</span>s3_storage_options<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">except</span> Exception <span style="color:#cf222e">as</span> e<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Warning: Error saving copy to permanent path </span><span style="color:#0a3069">{</span>permanent_output_uri<span style="color:#0a3069">}</span><span style="color:#0a3069">: </span><span style="color:#0a3069">{</span>e<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">raise</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;--- Preprocessing Complete ---&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0550ae">@dsl.pipeline</span><span style="color:#1f2328">(</span>name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;HDB Resale Data Preprocessing Pipeline&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">hdb_preprocessing_pipeline</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    raw_data_uri<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span> <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;s3://mlpipeline/Resale flat prices based on registration date from Jan-2017 onwards.csv&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    permanent_save_uri<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span> <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;s3://mlpipeline/hdb-resale-data/resale-data.parquet&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    preprocess_task <span style="color:#0550ae">=</span> preprocess_resale_data<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        raw_data_path<span style="color:#0550ae">=</span>raw_data_uri<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        permanent_output_uri<span style="color:#0550ae">=</span>permanent_save_uri
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">if</span> <span style="color:#953800">__name__</span> <span style="color:#0550ae">==</span> <span style="color:#0a3069">&#39;__main__&#39;</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    Compiler<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>compile<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>        pipeline_func<span style="color:#0550ae">=</span>hdb_preprocessing_pipeline<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        package_path<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;pipeline.yaml&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Compilation complete.&#34;</span><span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>
  </div>
</details>


































 
  
  





  <img src="/images/hdb/hdb-resale-data-preprocessing-pipeline.png"   alt="hdb-resale-data-preprocessing-pipeline" class="sc-image sc-image-default"
       >


<h2 id="final-thoughts">Final Thoughts</h2>
<p>Both models demonstrate strong predictive power, though their strengths differ:</p>
<ul>
<li>Neural Networks are flexible and learn complex patterns but may require tuning.</li>
<li>XGBoost tends to perform out-of-the-box and handles missing values and categorical splits efficiently.</li>
</ul>

    </section>

    <nav class="post-navigation">
      <div class="nav-links">
        
          <div class="nav-previous">
            <a href="/posts/2025/04/mnist-digit-classifier-in-tensorflow/" rel="prev">
              <span class="meta-nav">← Previous</span>
              <span class="post-title">MNIST Digit Classifier in TensorFlow</span>
            </a>
          </div>
        
        
          <div class="nav-next">
            <a href="/posts/2025/04/from-model-to-hdb-app/" rel="next">
              <span class="meta-nav">Next →</span>
              <span class="post-title">From Model to HDB App</span>
            </a>
          </div>
        
      </div>
    </nav>

    
<div class="giscus-comments-container">
</div>

<script>
  (function() {
    'use strict';

    const getGiscusTheme = () => {
      const storedTheme = localStorage.getItem('theme'); 
      if (storedTheme) {
        return storedTheme === 'dark-mode' ? 'dark' : 'light';
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };

    const setGiscusFrameTheme = (theme) => {
      const iframe = document.querySelector('iframe.giscus-frame');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({ giscus: { setConfig: { theme: theme } } }, 'https://giscus.app');
      }
    };

    const loadGiscus = () => {
      const giscusContainer = document.querySelector('.giscus-comments-container');
      if (!giscusContainer) {
        console.warn('Giscus container not found.');
        return;
      }

      while (giscusContainer.firstChild) {
        giscusContainer.removeChild(giscusContainer.firstChild);
      }

      const giscusScript = document.createElement('script');
      const giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo":             "seehiong\/seehiong.github.io",
        "data-repo-id":          "R_kgDOJg7Puw",
        "data-category":         "General",
        "data-category-id":      "DIC_kwDOJg7Pu84Cbyhc",
        "data-mapping":          "url", 
        "data-strict":           "0",
        "data-reactions-enabled":"1",
        "data-emit-metadata":    "0",
        "data-input-position":   "top", 
        "data-theme":            getGiscusTheme(), 
        "data-lang":             "en",
        "data-loading":          "lazy",
        "crossorigin":           "anonymous",
        "async":                 "true", 
      };

      if (!giscusAttributes["data-repo"] || !giscusAttributes["data-repo-id"] || !giscusAttributes["data-category-id"]) {
          console.error("Giscus parameters (giscusRepo, giscusRepoId, giscusCategoryId) are not configured in hugo.toml.");
          giscusContainer.innerHTML = "<p style='color: var(--text-secondary);'>Giscus comments are not configured correctly. Please check site parameters.</p>";
          return;
      }

      Object.entries(giscusAttributes).forEach(
        ([key, value]) => giscusScript.setAttribute(key, value)
      );
      giscusContainer.appendChild(giscusScript);
    };

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadGiscus);
    } else {
        loadGiscus();
    }

    const htmlElement = document.documentElement;
    const observer = new MutationObserver((mutationsList) => {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          setGiscusFrameTheme(getGiscusTheme());
        }
      }
    });
    observer.observe(htmlElement, { attributes: true });

  })();
</script>


  </article>
</div>
</main>
    </div>

    
    <div id="search-modal-overlay" class="search-modal-overlay" style="display: none;">
      <div id="search-modal-content" class="search-modal-content">
        <button id="search-modal-close" class="search-modal-close" aria-label="Close search" title="Close search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
        <input type="search" id="modal-search-input" class="modal-search-input" placeholder="Search content..." aria-label="Search input">
        <div id="modal-search-results" class="modal-search-results">
        </div>
      </div>
    </div>
    

  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js" defer></script>
  <script>
    (function() {
      'use strict';

      window.addEventListener('DOMContentLoaded', () => {
        const searchModalOverlay = document.getElementById('search-modal-overlay');
        const searchModalContent = document.getElementById('search-modal-content');
        const searchModalCloseButton = document.getElementById('search-modal-close');
        const searchToggleButton = document.getElementById('nav-search-toggle');
        const searchInputTarget = document.getElementById('modal-search-input');
        const searchResultsTarget = document.getElementById('modal-search-results');

        let fuseInstance = null;
        let searchData = [];

        const loadSearchData = async () => {
          if (searchData.length === 0 && !fuseInstance) {
            try {
              const response = await fetch('\/index.json');
              if (!response.ok) {
                throw new Error(`HTTP error loading index.json! status: ${response.status}`);
              }
              searchData = await response.json();
              initializeFuse();
            } catch (e) {
              console.error("[SearchSetup] Error loading search data:", e);
              if (searchResultsTarget) searchResultsTarget.innerHTML = "<p>Error loading search index.</p>";
            }
          } else if (searchData.length > 0 && !fuseInstance){
            initializeFuse();
          }
        };

        const initializeFuse = () => {
          if (searchData.length > 0 && !fuseInstance) {
            const options = {
              keys: [
                { name: 'title', weight: 0.7 }, { name: 'summary', weight: 0.5 },
                { name: 'content', weight: 0.3 }, { name: 'tags', weight: 0.4 }
              ],
              includeScore: true, threshold: 0.4, minMatchCharLength: 2,
            };
            fuseInstance = new Fuse(searchData, options);
          }
        };

        const performSearch = () => {
          if (!fuseInstance || !searchInputTarget || !searchResultsTarget) return;
          const query = searchInputTarget.value.trim();
          searchResultsTarget.innerHTML = '';
          if (query.length < 2) return;

          const results = fuseInstance.search(query);
          if (results.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'search-results-list';
            results.slice(0, 10).forEach(result => {
              const item = result.item;
              const li = document.createElement('li');
              li.className = 'search-result-item';
              const a = document.createElement('a');
              a.href = item.permalink;
              a.textContent = item.title;
              li.appendChild(a);
              ul.appendChild(li);
            });
            searchResultsTarget.appendChild(ul);
          } else {
            searchResultsTarget.innerHTML = '<p>No results found.</p>';
          }
        };

        const openSearchModal = async () => {
          await loadSearchData();
          if (searchInputTarget) searchInputTarget.value = '';
          if (searchResultsTarget) searchResultsTarget.innerHTML = '';

          if (searchModalOverlay) {
            searchModalOverlay.style.display = 'flex';
            setTimeout(() => searchModalOverlay.classList.add('active'), 10);
          } else { return; }

          if (searchInputTarget) setTimeout(() => searchInputTarget.focus(), 50);
          if (searchToggleButton) searchToggleButton.classList.add('active');
        };

        const closeSearchModal = () => {
          if (searchModalOverlay) {
            searchModalOverlay.classList.remove('active');
            setTimeout(() => searchModalOverlay.style.display = 'none', 300);
          }
          if (searchToggleButton) searchToggleButton.classList.remove('active');
        };

        if (searchToggleButton) {
          searchToggleButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (searchModalOverlay && searchModalOverlay.classList.contains('active')) {
              closeSearchModal();
            } else {
              openSearchModal();
            }
          });
        } else { console.error("[SearchSetup] #nav-search-toggle button not found."); }

        if (searchModalCloseButton) { searchModalCloseButton.addEventListener('click', closeSearchModal); }
        if (searchModalOverlay && searchModalContent) {
          searchModalOverlay.addEventListener('click', (event) => {
            if (event.target === searchModalOverlay) closeSearchModal();
          });
        }
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && searchModalOverlay && searchModalOverlay.classList.contains('active')) {
            closeSearchModal();
          }
        });
        if (searchInputTarget) {
          let debounceTimer;
          searchInputTarget.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(performSearch, 300);
          });
        }
      });
    })();
  </script>

    

    

  <script>
    MathJax = {
      tex: {
        displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        inlineMath: [['\\(', '\\)']], 
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams' 
      },
      svg: {
        fontCache: 'global' 
      },
      chtml: {
        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], 
        ignoreHtmlClass: 'tex2jax_ignore', 
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<footer class="footer-main simplified-footer">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="footer-content">
        <div class="copyright-line">
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> © 2025 See Hiong. All rights reserved.
        </div>
        <div class="social-links">
          
            <a href="https://github.com/seehiong" target="_blank" title="GitHub" class="social-link" aria-label="GitHub">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
          
            <a href="https://www.linkedin.com/in/seehiong/" target="_blank" title="LinkedIn" class="social-link" aria-label="LinkedIn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
          
          
            <a href="/index.xml" target="_blank" title="RSS" class="social-link" aria-label="RSS Feed">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
            </a>
          
        </div>
      </div>
    </div>
  </div>
</footer>
        <script src="/js/animation.js" defer></script>
    
        <script src="/js/code-copy.js" defer></script>
    
        <script src="/js/scroll-header.js" defer></script>
       
  </body>
</html>