<!DOCTYPE html>
<html lang="en">
  <head><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <link rel="icon" href="/images/favicon.ico">
    

    <meta property="og:url" content="https://seehiong.github.io/posts/2024/06/setting-up-and-using-kserve-with-kubeflow/">
  <meta property="og:site_name" content="See Hiong&#39;s Blog">
  <meta property="og:title" content="Setting Up and Using KServe with Kubeflow">
  <meta property="og:description" content="In this post, we explore KServe, a model inference platform on Kubernetes designed for scalability. Building on our previous Kubeflow guide, we detail how to set up your first KServe endpoint, make predictions, and troubleshoot common issues. Follow our step-by-step instructions to seamlessly integrate KServe with your Kubeflow environment and enhance your machine learning deployment process.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-30T10:00:00+08:00">
    <meta property="article:modified_time" content="2024-07-07T00:00:00+00:00">
    <meta property="article:tag" content="Metallb">
    <meta property="article:tag" content="KServe">
    <meta property="article:tag" content="Kubeflow">
    <meta property="article:tag" content="K3s">
    <meta property="article:tag" content="K8s">
    <meta property="article:tag" content="HomeLab">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Setting Up and Using KServe with Kubeflow">
  <meta name="twitter:description" content="In this post, we explore KServe, a model inference platform on Kubernetes designed for scalability. Building on our previous Kubeflow guide, we detail how to set up your first KServe endpoint, make predictions, and troubleshoot common issues. Follow our step-by-step instructions to seamlessly integrate KServe with your Kubeflow environment and enhance your machine learning deployment process.">

  <meta itemprop="name" content="Setting Up and Using KServe with Kubeflow">
  <meta itemprop="description" content="In this post, we explore KServe, a model inference platform on Kubernetes designed for scalability. Building on our previous Kubeflow guide, we detail how to set up your first KServe endpoint, make predictions, and troubleshoot common issues. Follow our step-by-step instructions to seamlessly integrate KServe with your Kubeflow environment and enhance your machine learning deployment process.">
  <meta itemprop="datePublished" content="2024-06-30T10:00:00+08:00">
  <meta itemprop="dateModified" content="2024-07-07T00:00:00+00:00">
  <meta itemprop="wordCount" content="1034">
  <meta itemprop="keywords" content="Metallb,KServe,Kubeflow,K3s,K8s,HomeLab,MLOps,Istio,Gitlab,Sklearn"><title>Setting Up and Using KServe with Kubeflow | See Hiong&#39;s Blog</title>

    <link rel="canonical" href="https://seehiong.github.io/posts/2024/06/setting-up-and-using-kserve-with-kubeflow/">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
      
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-5PNPM4HWQ0"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-5PNPM4HWQ0');
        }
      </script>
    
    <link rel="stylesheet" href="/css/variables.css">
    
    <link rel="stylesheet" href="/css/base.css">
    
    <link rel="stylesheet" href="/css/layout.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/header.css">
    
    <link rel="stylesheet" href="/css/cards.css">
    
    <link rel="stylesheet" href="/css/content_elements.css">
    
    <link rel="stylesheet" href="/css/codeblocks.css">
    
    <link rel="stylesheet" href="/css/page_specific.css">
    
    <link rel="stylesheet" href="/css/shortcodes.css">
    
    <link rel="stylesheet" href="/css/components.css">
    
    <link rel="stylesheet" href="/css/animations.css">
    
    <link rel="stylesheet" href="/css/media_queries.css">
    
    <link rel="stylesheet" href="/css/quantum-theme.css">
    

    
    <script>
      (function() {
        var theme = localStorage.getItem('theme');
        var H = document.documentElement;
        if (theme === 'dark-mode') {
          H.classList.add('dark-mode');
        } else if (theme === 'light-mode') {
          H.classList.remove('dark-mode');
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          H.classList.add('dark-mode');
        }
      })();
    </script>
</head></head>
  <body class="page-article"><nav class="nav">
  <div class="nav-wrapper">
    <div class="nav-content-wrapper">
      <div class="nav-content">
        <a href="/" class="nav-logo-link" title="See Hiong&#39;s Blog - Home">
          <span class="nav-site-title">
            <span class="nav-site-title__main">SEE HIONG’S</span>
            <span class="nav-site-title__sub">BLOG</span>
          </span>
        </a>
        <div class="nav-menu">
          <div class="nav-item-wrapper">
            
            
            <a href="/posts/" class="nav-item-content active">Archives</a>
            
          </div>
          
          
          <div class="nav-item-wrapper">
            <a href="/tags/" class="nav-item-content ">Tags</a>
          </div>
          <div class="nav-item-wrapper">
            <a href="/about/" class="nav-item-content ">About</a>
          </div>
          <div class="nav-item-wrapper nav-search-toggle-wrapper">
            <button id="nav-search-toggle" class="nav-item-button" aria-label="Toggle search" title="Search">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" class="nav-item-icon">
                <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
            </button>
          </div>
          
          
          <button id="theme-toggle" class="nav-item-button" aria-label="Toggle theme"></button> 
        </div>
      </div>
    </div>
  </div>
</nav>


<script>
  document.addEventListener('DOMContentLoaded', function () {
    const themeToggle = document.getElementById('theme-toggle');
    const H = document.documentElement; 

    if (H.classList.contains('dark-mode')) {
      themeToggle.textContent = 'Light Mode';
    } else {
      themeToggle.textContent = 'Dark Mode';
    }

    themeToggle.addEventListener('click', function() {
      H.classList.toggle('dark-mode');
      if (H.classList.contains('dark-mode')) {
        localStorage.setItem('theme', 'dark-mode');
        themeToggle.textContent = 'Light Mode';
      } else {
        localStorage.setItem('theme', 'light-mode');
        themeToggle.textContent = 'Dark Mode';
      }
    });
  });
</script><div id="content-wrapper">
        <main class="container" id="main-content">
<div class="main-content-area">
  <article class="post-layout container">

    <header class="post-header">
      <h1 class="post-title">Setting Up and Using KServe with Kubeflow</h1>

      <div class="post-meta">
        <span class="post-meta__date">
          <time datetime="2024-06-30T10:00:00&#43;08:00">June 30, 2024</time>
        </span>

        
          <span class="post-meta__author">Written by See Hiong</span>
        

        
          <span class="post-meta__tags">
            In:
            
              <a href="/tags/metallb">Metallb</a>
            
              , <a href="/tags/kserve">KServe</a>
            
              , <a href="/tags/kubeflow">Kubeflow</a>
            
              , <a href="/tags/k3s">K3s</a>
            
              , <a href="/tags/k8s">K8s</a>
            
              , <a href="/tags/homelab">HomeLab</a>
            
              , <a href="/tags/mlops">MLOps</a>
            
              , <a href="/tags/istio">Istio</a>
            
              , <a href="/tags/gitlab">Gitlab</a>
            
              , <a href="/tags/sklearn">sklearn</a>
            
          </span>
        

        
      </div>
    </header>

    
      
      
      <div class="post-cover-container post-cover--artistic-blur-wrapper">
        
          <div class="post-cover-blur-background" style="--bg-image: url('/images/kserve/setting-up-and-using-kserve-with-kubeflow.png');"></div>
          <img src="/images/kserve/setting-up-and-using-kserve-with-kubeflow.png" alt="Setting Up and Using KServe with Kubeflow cover image" class="post-cover-image post-cover-image--artistic-blur">
        
      </div>
    

    <section class="post-content">
      <p>Expanding on my previous post on 






  <a href="/posts/2024/06/setting-up-kubeflow-on-kubernetes-a-step-by-step-guide/" >Kubeflow</a>
, I will explore 






  <a href="https://kserve.github.io/website/latest/" target="_blank" rel="noopener noreferrer" >KServe</a>
, a standard Model Inference Platform on Kubernetes built for highly scalable use cases.</p>
<h2 id="first-kserve-endpoint">First KServe Endpoint</h2>
<p>Referencing 






  <a href="https://github.com/kserve/kserve/blob/master/docs/samples/istio-dex/README.md" target="_blank" rel="noopener noreferrer" >KServe on Kubeflow with Istio-Dex</a>
, below is the <em>sklearn.yaml</em> configuration. Note the sidecar annotation, which instructs not to inject the istio sidecar. Without this annotation, you may encounter error (refer to the troubleshooting section):</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#0550ae">apiVersion</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;serving.kserve.io/v1beta1&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">kind</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;InferenceService&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">metadata</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;sklearn-iris&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">annotations</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">sidecar.istio.io/inject</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;false&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">spec</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">predictor</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">model</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">modelFormat</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>sklearn<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">storageUri</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;gs://kfserving-examples/models/sklearn/1.0/model&#34;</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>From the Kubeflow dashboard, navigate to KServe Endpoints, click on the <strong>New Endpoint</strong> button on the top right, and input the above configuration:</p>


































 
  
  





  <img src="/images/kserve/kserve-first-endpoint.png"   alt="kserve-first-endpoint" class="sc-image sc-image-default"
       >


<p>Here is the overview of the sklearn-iris endpoint:</p>


































 
  
  





  <img src="/images/kserve/kserve-sklearn-iris-endpoint.png"   alt="kserve-sklearn-iris-endpoint" class="sc-image sc-image-default"
       >


<p>And its corresponding Kubernetes deployment:</p>


































 
  
  





  <img src="/images/kserve/kserve-sklearn-iris-predictor-deployment.png"   alt="kserve-sklearn-iris-predictor-deployment" class="sc-image sc-image-default"
       >


<h2 id="first-prediction">First Prediction</h2>
<p>Using the 






  <a href="https://github.com/kserve/kserve/blob/master/docs/samples/istio-dex/dex_auth.py" target="_blank" rel="noopener noreferrer" >dex_auth.py</a>
, input the following into your first notebook:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">re</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">from</span> <span style="color:#24292e">urllib.parse</span> <span style="color:#cf222e">import</span> urlsplit
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">get_istio_auth_session</span><span style="color:#1f2328">(</span>url<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> username<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">,</span> password<span style="color:#1f2328">:</span> <span style="color:#6639ba">str</span><span style="color:#1f2328">)</span> <span style="color:#0550ae">-&gt;</span> <span style="color:#6639ba">dict</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#0a3069">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    Determine if the specified URL is secured by Dex and try to obtain a session cookie.
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    WARNING: only Dex `staticPasswords` and `LDAP` authentication are currently supported
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">             (we default to using `staticPasswords` if both are enabled)
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    :param url: Kubeflow server URL, including protocol
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    :param username: Dex `staticPasswords` or `LDAP` username
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    :param password: Dex `staticPasswords` or `LDAP` password
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    :return: auth session information
</span></span></span><span style="display:flex;"><span><span style="color:#0a3069">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># define the default return object</span>
</span></span><span style="display:flex;"><span>    auth_session <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;endpoint_url&#34;</span><span style="color:#1f2328">:</span> url<span style="color:#1f2328">,</span>  <span style="color:#57606a"># KF endpoint URL</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;redirect_url&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># KF redirect URL, if applicable</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;dex_login_url&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># Dex login URL (for POST of credentials)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;is_secured&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># True if KF endpoint is secured</span>
</span></span><span style="display:flex;"><span>        <span style="color:#0a3069">&#34;session_cookie&#34;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">,</span>  <span style="color:#57606a"># Resulting session cookies in the form &#34;key1=value1; key2=value2&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># use a persistent session (for cookies)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">with</span> requests<span style="color:#0550ae">.</span>Session<span style="color:#1f2328">()</span> <span style="color:#cf222e">as</span> s<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a">################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Determine if Endpoint is Secured</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a">################</span>
</span></span><span style="display:flex;"><span>        resp <span style="color:#0550ae">=</span> s<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span>url<span style="color:#1f2328">,</span> allow_redirects<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> resp<span style="color:#0550ae">.</span>status_code <span style="color:#0550ae">!=</span> <span style="color:#0550ae">200</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">raise</span> RuntimeError<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;HTTP status code &#39;</span><span style="color:#0a3069">{</span>resp<span style="color:#0550ae">.</span>status_code<span style="color:#0a3069">}</span><span style="color:#0a3069">&#39; for GET against: </span><span style="color:#0a3069">{</span>url<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;redirect_url&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> resp<span style="color:#0550ae">.</span>url
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># if we were NOT redirected, then the endpoint is UNSECURED</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>resp<span style="color:#0550ae">.</span>history<span style="color:#1f2328">)</span> <span style="color:#0550ae">==</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;is_secured&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#cf222e">False</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">return</span> auth_session
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;is_secured&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#cf222e">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a">################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Get Dex Login URL</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a">################</span>
</span></span><span style="display:flex;"><span>        redirect_url_obj <span style="color:#0550ae">=</span> urlsplit<span style="color:#1f2328">(</span>auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;redirect_url&#34;</span><span style="color:#1f2328">])</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># if we are at `/auth?=xxxx` path, we need to select an auth type</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> re<span style="color:#0550ae">.</span>search<span style="color:#1f2328">(</span><span style="color:#0a3069">r</span><span style="color:#0a3069">&#34;/auth$&#34;</span><span style="color:#1f2328">,</span> redirect_url_obj<span style="color:#0550ae">.</span>path<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a">#######</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># TIP: choose the default auth type by including ONE of the following</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a">#######</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># OPTION 1: set &#34;staticPasswords&#34; as default auth type</span>
</span></span><span style="display:flex;"><span>            redirect_url_obj <span style="color:#0550ae">=</span> redirect_url_obj<span style="color:#0550ae">.</span>_replace<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>                path<span style="color:#0550ae">=</span>re<span style="color:#0550ae">.</span>sub<span style="color:#1f2328">(</span><span style="color:#0a3069">r</span><span style="color:#0a3069">&#34;/auth$&#34;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;/auth/local&#34;</span><span style="color:#1f2328">,</span> redirect_url_obj<span style="color:#0550ae">.</span>path<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># OPTION 2: set &#34;ldap&#34; as default auth type</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># redirect_url_obj = redirect_url_obj._replace(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a">#     path=re.sub(r&#34;/auth$&#34;, &#34;/auth/ldap&#34;, redirect_url_obj.path)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># )</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># if we are at `/auth/xxxx/login` path, then no further action is needed (we can use it for login POST)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> re<span style="color:#0550ae">.</span>search<span style="color:#1f2328">(</span><span style="color:#0a3069">r</span><span style="color:#0a3069">&#34;/auth/.*/login$&#34;</span><span style="color:#1f2328">,</span> redirect_url_obj<span style="color:#0550ae">.</span>path<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>            auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;dex_login_url&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> redirect_url_obj<span style="color:#0550ae">.</span>geturl<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># else, we need to be redirected to the actual login page</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># this GET should redirect us to the `/auth/xxxx/login` path</span>
</span></span><span style="display:flex;"><span>            resp <span style="color:#0550ae">=</span> s<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span>redirect_url_obj<span style="color:#0550ae">.</span>geturl<span style="color:#1f2328">(),</span> allow_redirects<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> resp<span style="color:#0550ae">.</span>status_code <span style="color:#0550ae">!=</span> <span style="color:#0550ae">200</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">raise</span> RuntimeError<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;HTTP status code &#39;</span><span style="color:#0a3069">{</span>resp<span style="color:#0550ae">.</span>status_code<span style="color:#0a3069">}</span><span style="color:#0a3069">&#39; for GET against: </span><span style="color:#0a3069">{</span>redirect_url_obj<span style="color:#0550ae">.</span>geturl<span style="color:#1f2328">()</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># set the login url</span>
</span></span><span style="display:flex;"><span>            auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;dex_login_url&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> resp<span style="color:#0550ae">.</span>url
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a">################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># Attempt Dex Login</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a">################</span>
</span></span><span style="display:flex;"><span>        resp <span style="color:#0550ae">=</span> s<span style="color:#0550ae">.</span>post<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;dex_login_url&#34;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>            data<span style="color:#0550ae">=</span><span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;login&#34;</span><span style="color:#1f2328">:</span> username<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;password&#34;</span><span style="color:#1f2328">:</span> password<span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>            allow_redirects<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> <span style="color:#6639ba">len</span><span style="color:#1f2328">(</span>resp<span style="color:#0550ae">.</span>history<span style="color:#1f2328">)</span> <span style="color:#0550ae">==</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">raise</span> RuntimeError<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;Login credentials were probably invalid - &#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;No redirect after POST to: </span><span style="color:#0a3069">{</span>auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;dex_login_url&#39;</span><span style="color:#1f2328">]</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># store the session cookies in a &#34;key1=value1; key2=value2&#34; string</span>
</span></span><span style="display:flex;"><span>        auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;session_cookie&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;; &#34;</span><span style="color:#0550ae">.</span>join<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#1f2328">[</span><span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">{</span>c<span style="color:#0550ae">.</span>name<span style="color:#0a3069">}</span><span style="color:#0a3069">=</span><span style="color:#0a3069">{</span>c<span style="color:#0550ae">.</span>value<span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> <span style="color:#cf222e">for</span> c <span style="color:#0550ae">in</span> s<span style="color:#0550ae">.</span>cookies<span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#34;authservice_session&#34;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> s<span style="color:#0550ae">.</span>cookies<span style="color:#0550ae">.</span>get<span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;authservice_session&#34;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">return</span> auth_session</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>To determine the cluster IP, use this command:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#953800">CLUSTER_IP</span><span style="color:#0550ae">=</span><span style="color:#cf222e">$(</span>kubectl -n istio-system get service istio-ingressgateway -o <span style="color:#953800">jsonpath</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;{.spec.clusterIP}&#39;</span><span style="color:#cf222e">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">echo</span> <span style="color:#953800">$CLUSTER_IP</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/kserve/kserve-cluster-ip.png"   alt="kserve-cluster-ip" class="sc-image sc-image-default"
       >


<p>Next, in the notebook, enter the following:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">requests</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>KUBEFLOW_ENDPOINT <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;http://10.43.239.213&#34;</span>   <span style="color:#57606a"># Cluster or LoadBalancer IP and port</span>
</span></span><span style="display:flex;"><span>KUBEFLOW_USERNAME <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;user@example.com&#34;</span>
</span></span><span style="display:flex;"><span>KUBEFLOW_PASSWORD <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;12341234&#34;</span>
</span></span><span style="display:flex;"><span>MODEL_NAME <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;sklearn-iris&#34;</span>
</span></span><span style="display:flex;"><span>SERVICE_HOSTNAME <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#34;sklearn-iris.kubeflow-user-example-com.svc.cluster.local&#34;</span>
</span></span><span style="display:flex;"><span>PREDICT_ENDPOINT <span style="color:#0550ae">=</span> <span style="color:#0a3069">f</span><span style="color:#0a3069">&#34;</span><span style="color:#0a3069">{</span>KUBEFLOW_ENDPOINT<span style="color:#0a3069">}</span><span style="color:#0a3069">/v1/models/</span><span style="color:#0a3069">{</span>MODEL_NAME<span style="color:#0a3069">}</span><span style="color:#0a3069">:predict&#34;</span>
</span></span><span style="display:flex;"><span>iris_input <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;instances&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[[</span><span style="color:#0550ae">6.8</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">2.8</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">4.8</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">1.4</span><span style="color:#1f2328">],</span> <span style="color:#1f2328">[</span><span style="color:#0550ae">6.0</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">3.4</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">4.5</span><span style="color:#1f2328">,</span> <span style="color:#0550ae">1.6</span><span style="color:#1f2328">]]}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>_auth_session <span style="color:#0550ae">=</span> get_istio_auth_session<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    url<span style="color:#0550ae">=</span>KUBEFLOW_ENDPOINT<span style="color:#1f2328">,</span> username<span style="color:#0550ae">=</span>KUBEFLOW_USERNAME<span style="color:#1f2328">,</span> password<span style="color:#0550ae">=</span>KUBEFLOW_PASSWORD
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>_auth_session<span style="color:#1f2328">)</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/kserve/kserve-sklearn-iris-auth-service.png"   alt="kserve-sklearn-iris-auth-service" class="sc-image sc-image-default"
       >


<p>Finally, in the last cell, input the following:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cookies <span style="color:#0550ae">=</span> <span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;authservice_session&#34;</span><span style="color:#1f2328">:</span> _auth_session<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;authservice_session&#39;</span><span style="color:#1f2328">]}</span>
</span></span><span style="display:flex;"><span>jar <span style="color:#0550ae">=</span> requests<span style="color:#0550ae">.</span>cookies<span style="color:#0550ae">.</span>cookiejar_from_dict<span style="color:#1f2328">(</span>cookies<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>res <span style="color:#0550ae">=</span> requests<span style="color:#0550ae">.</span>post<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    url<span style="color:#0550ae">=</span>PREDICT_ENDPOINT<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    headers<span style="color:#0550ae">=</span><span style="color:#1f2328">{</span><span style="color:#0a3069">&#34;Host&#34;</span><span style="color:#1f2328">:</span> SERVICE_HOSTNAME<span style="color:#1f2328">,</span> <span style="color:#0a3069">&#34;Content-Type&#34;</span><span style="color:#1f2328">:</span> <span style="color:#0a3069">&#34;application/json&#34;</span><span style="color:#1f2328">},</span>
</span></span><span style="display:flex;"><span>    cookies<span style="color:#0550ae">=</span>jar<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    json<span style="color:#0550ae">=</span>iris_input<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    timeout<span style="color:#0550ae">=</span><span style="color:#0550ae">200</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Status Code: &#34;</span><span style="color:#1f2328">,</span> res<span style="color:#0550ae">.</span>status_code<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#34;Response: &#34;</span><span style="color:#1f2328">,</span> res<span style="color:#0550ae">.</span>json<span style="color:#1f2328">())</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/kserve/kserve-sklearn-iris-prediction.png"   alt="kserve-sklearn-iris-prediction" class="sc-image sc-image-default"
       >


<p>This is the log:</p>


































 
  
  





  <img src="/images/kserve/kserve-sklearn-iris-endpoint-logs.png"   alt="kserve-sklearn-iris-endpoint-logs" class="sc-image sc-image-default"
       >


<p>And that&rsquo;s it! We see the expected two predictions returned (i.e. {&ldquo;predictions&rdquo;: [1, 1]}).</p>
<h2 id="optional---load-balancer">Optional - Load Balancer</h2>
<p>In this section, referencing 






  <a href="/posts/2023/12/streamlining-api-management-with-kong/" >my previous post on MetalLB</a>
, we will install MetalLB.</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#57606a"># Apply the required MetalLB manifests</span>
</span></span><span style="display:flex;"><span>kca metallb-native.yaml
</span></span><span style="display:flex;"><span>kca metallb-l2-advertisement.yaml
</span></span><span style="display:flex;"><span>kca metallb-ip-address-pool.yaml</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div>

































 
  
  





  <img src="/images/kserve/kserve-install-metallb.png"   alt="kserve-install-metallb" class="sc-image sc-image-default"
       >


<p>Next, change the service type from <em>ClusterIP</em> to <strong>LoadBalacer</strong> in the <em>common/istio-1-22/istio-install/base/patches/service.yaml</em> file:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#0550ae">apiVersion</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>v1<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">kind</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>Service<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">metadata</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>istio-ingressgateway<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">namespace</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>istio-system<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">spec</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">type</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>LoadBalancer</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>This is the <em>istio-system</em> namespace:</p>


































 
  
  





  <img src="/images/kserve/kserve-istio-system-namespace.png"   alt="kserve-istio-system-namespace" class="sc-image sc-image-default"
       >


<p>With this configuration, you can now access Kubeflow directly via <em>http://192.168.68.234/</em> without using the port-forward command:</p>


































 
  
  





  <img src="/images/kserve/kserve-sklearn-iris-endpoint-details.png"   alt="kserve-sklearn-iris-endpoint-details" class="sc-image sc-image-default"
       >


<h2 id="optional---integrate-with-gitlab">Optional - Integrate with GitLab</h2>
<p>After organising your notebooks, such as into a <em>first-notebook</em>, you can commit them to GitLab by opening a terminal. Alternatively, you may use the built-in 






  <a href="https://github.com/jupyterlab/jupyterlab-git" target="_blank" rel="noopener noreferrer" >jupyterlab-git</a>
 UI for a more visual approach.</p>
<h2 id="initialise-environment">Initialise Environment</h2>
<p>Set global Git settings as follows:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git config --global --add safe.directory /home/jovyan
</span></span><span style="display:flex;"><span>git config --global user.email <span style="color:#0a3069">&#34;seehiong@xxxxxx.xxx&#34;</span>
</span></span><span style="display:flex;"><span>git config --global user.name <span style="color:#0a3069">&#34;seehiong.local&#34;</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>After creating the project in GitLab, commit the code:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git init --initial-branch<span style="color:#0550ae">=</span>main
</span></span><span style="display:flex;"><span>git remote add origin http://192.168.68.126/project/jupyter-notebook.git
</span></span><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#0a3069">&#34;Initial commit&#34;</span>
</span></span><span style="display:flex;"><span>git push --set-upstream origin main</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>After entering your username and password, your first commit to GitLab is complete!</p>


































 
  
  





  <img src="/images/kserve/kserve-notebook-initial-commit.png"   alt="kserve-notebook-initial-commit" class="sc-image sc-image-default"
       >


<h2 id="troubleshooting">Troubleshooting</h2>

<details class="details-shortcode " >
  <summary class="details-shortcode__summary">
    KServe sklearn-iris 302 Found issue
  </summary>
  <div class="details-shortcode__content">
    
    
    <p>In my setup, if I follow the official 






  <a href="https://kserve.github.io/website/latest/get_started/first_isvc" target="_blank" rel="noopener noreferrer" >First InferenceService</a>
, the above python scripts will not work. Below is the schema from the official link:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#0550ae">apiVersion</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;serving.kserve.io/v1beta1&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">kind</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;InferenceService&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">metadata</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;sklearn-iris&#34;</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff"></span><span style="color:#0550ae">spec</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">  </span><span style="color:#0550ae">predictor</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">    </span><span style="color:#0550ae">model</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">modelFormat</span><span style="color:#1f2328">:</span><span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">        </span><span style="color:#0550ae">name</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span>sklearn<span style="color:#fff">
</span></span></span><span style="display:flex;"><span><span style="color:#fff">      </span><span style="color:#0550ae">storageUri</span><span style="color:#1f2328">:</span><span style="color:#fff"> </span><span style="color:#0a3069">&#34;gs://kfserving-examples/models/sklearn/1.0/model&#34;</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>And the <em>iris-input.json</em> file:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#1f2328">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#0550ae">&#34;instances&#34;</span><span style="color:#1f2328">:</span> <span style="color:#1f2328">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">[</span><span style="color:#0550ae">6.8</span><span style="color:#1f2328">,</span>  <span style="color:#0550ae">2.8</span><span style="color:#1f2328">,</span>  <span style="color:#0550ae">4.8</span><span style="color:#1f2328">,</span>  <span style="color:#0550ae">1.4</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#1f2328">[</span><span style="color:#0550ae">6.0</span><span style="color:#1f2328">,</span>  <span style="color:#0550ae">3.4</span><span style="color:#1f2328">,</span>  <span style="color:#0550ae">4.5</span><span style="color:#1f2328">,</span>  <span style="color:#0550ae">1.6</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">}</span></span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p>With or without the Istio sidecar for the inference service, I still see this 302 issue with these commands (authenticating through the service access token):</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl port-forward svc/istio-ingressgateway -n istio-system 8080:80 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#953800">SERVICE_HOSTNAME</span><span style="color:#0550ae">=</span><span style="color:#cf222e">$(</span>kubectl get inferenceservice sklearn-iris -n kubeflow-user-example-com -o <span style="color:#953800">jsonpath</span><span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;{.status.url}&#39;</span> <span style="color:#1f2328">|</span> cut -d <span style="color:#0a3069">&#34;/&#34;</span> -f 3<span style="color:#cf222e">)</span>
</span></span><span style="display:flex;"><span><span style="color:#953800">INGRESS_HOST</span><span style="color:#0550ae">=</span>localhost
</span></span><span style="display:flex;"><span><span style="color:#953800">INGRESS_PORT</span><span style="color:#0550ae">=</span><span style="color:#0550ae">8080</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#953800">TOKEN</span><span style="color:#0550ae">=</span><span style="color:#cf222e">$(</span>kubectl create token default-editor -n kubeflow-user-example-com --audience<span style="color:#0550ae">=</span>istio-ingressgateway.istio-system.svc.cluster.local --duration<span style="color:#0550ae">=</span>24h<span style="color:#cf222e">)</span>
</span></span><span style="display:flex;"><span>curl -v -H <span style="color:#0a3069">&#34;Host: </span><span style="color:#0a3069">${</span><span style="color:#953800">SERVICE_HOSTNAME</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> -H <span style="color:#0a3069">&#34;Authorization: Bearer </span><span style="color:#953800">$TOKEN</span><span style="color:#0a3069">&#34;</span> -H <span style="color:#0a3069">&#34;Content-Type: application/json&#34;</span> <span style="color:#0a3069">&#34;http://</span><span style="color:#0a3069">${</span><span style="color:#953800">INGRESS_HOST</span><span style="color:#0a3069">}</span><span style="color:#0a3069">:</span><span style="color:#0a3069">${</span><span style="color:#953800">INGRESS_PORT</span><span style="color:#0a3069">}</span><span style="color:#0a3069">/v1/models/sklearn-iris:predict&#34;</span> -d @./iris-input.json</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p><img src="/images/kserve/kserve-with-token-inference-error.png" alt="kserve-with-token-inference-error"></p>
<p>This fails too, for the basic authentication as such:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl --user user@example.com:12341234 -v -H <span style="color:#0a3069">&#34;Host: </span><span style="color:#0a3069">${</span><span style="color:#953800">SERVICE_HOSTNAME</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> -H <span style="color:#0a3069">&#34;Content-Type: application/json&#34;</span> <span style="color:#0a3069">&#34;http://</span><span style="color:#0a3069">${</span><span style="color:#953800">INGRESS_HOST</span><span style="color:#0a3069">}</span><span style="color:#0a3069">:</span><span style="color:#0a3069">${</span><span style="color:#953800">INGRESS_PORT</span><span style="color:#0a3069">}</span><span style="color:#0a3069">/v1/models/sklearn-iris:predict&#34;</span> -d @./iris-input.json</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p><img src="/images/kserve/kserve-with-basic-auth-error.png" alt="kserve-with-basic-auth-error"></p>
<p>Using cookies also fails:</p>






<div class="code-block-wrapper">
  <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl --cookie <span style="color:#0a3069">&#34;authservice_session=None&#34;</span> -v -H <span style="color:#0a3069">&#34;Host: </span><span style="color:#0a3069">${</span><span style="color:#953800">SERVICE_HOSTNAME</span><span style="color:#0a3069">}</span><span style="color:#0a3069">&#34;</span> -H <span style="color:#0a3069">&#34;Content-Type: application/json&#34;</span> <span style="color:#0a3069">&#34;http://</span><span style="color:#0a3069">${</span><span style="color:#953800">INGRESS_HOST</span><span style="color:#0a3069">}</span><span style="color:#0a3069">:</span><span style="color:#0a3069">${</span><span style="color:#953800">INGRESS_PORT</span><span style="color:#0a3069">}</span><span style="color:#0a3069">/v1/models/sklearn-iris:predict&#34;</span> -d @./iris-input.json</span></span></code></pre></div>
  <button class="copy-code-button" aria-label="Copy code to clipboard" title="Copy code">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="copy-icon">
      <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" fill="currentColor" class="check-icon" style="display:none;">
      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
    </svg>
    <span class="copy-text">Copy</span>
  </button>
</div><p><img src="/images/kserve/kserve-with-cookie-error.png" alt="kserve-with-cookie-error"></p>

  </div>
</details>

    </section>

    <nav class="post-navigation">
      <div class="nav-links">
        
          <div class="nav-previous">
            <a href="/posts/2024/06/setting-up-kubeflow-on-kubernetes-a-step-by-step-guide/" rel="prev">
              <span class="meta-nav">← Previous</span>
              <span class="post-title">Setting Up Kubeflow on Kubernetes: A Step-by-Step Guide</span>
            </a>
          </div>
        
        
          <div class="nav-next">
            <a href="/posts/2024/07/integrating-draw.io-and-plantuml-with-gitlab/" rel="next">
              <span class="meta-nav">Next →</span>
              <span class="post-title">Integrating Draw.io and PlantUML with GitLab</span>
            </a>
          </div>
        
      </div>
    </nav>

    
<div class="giscus-comments-container">
</div>

<script>
  (function() {
    'use strict';

    const getGiscusTheme = () => {
      const storedTheme = localStorage.getItem('theme'); 
      if (storedTheme) {
        return storedTheme === 'dark-mode' ? 'dark' : 'light';
      }
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };

    const setGiscusFrameTheme = (theme) => {
      const iframe = document.querySelector('iframe.giscus-frame');
      if (iframe && iframe.contentWindow) {
        iframe.contentWindow.postMessage({ giscus: { setConfig: { theme: theme } } }, 'https://giscus.app');
      }
    };

    const loadGiscus = () => {
      const giscusContainer = document.querySelector('.giscus-comments-container');
      if (!giscusContainer) {
        console.warn('Giscus container not found.');
        return;
      }

      while (giscusContainer.firstChild) {
        giscusContainer.removeChild(giscusContainer.firstChild);
      }

      const giscusScript = document.createElement('script');
      const giscusAttributes = {
        "src": "https://giscus.app/client.js",
        "data-repo":             "seehiong\/seehiong.github.io",
        "data-repo-id":          "R_kgDOJg7Puw",
        "data-category":         "General",
        "data-category-id":      "DIC_kwDOJg7Pu84Cbyhc",
        "data-mapping":          "url", 
        "data-strict":           "0",
        "data-reactions-enabled":"1",
        "data-emit-metadata":    "0",
        "data-input-position":   "top", 
        "data-theme":            getGiscusTheme(), 
        "data-lang":             "en",
        "data-loading":          "lazy",
        "crossorigin":           "anonymous",
        "async":                 "true", 
      };

      if (!giscusAttributes["data-repo"] || !giscusAttributes["data-repo-id"] || !giscusAttributes["data-category-id"]) {
          console.error("Giscus parameters (giscusRepo, giscusRepoId, giscusCategoryId) are not configured in hugo.toml.");
          giscusContainer.innerHTML = "<p style='color: var(--text-secondary);'>Giscus comments are not configured correctly. Please check site parameters.</p>";
          return;
      }

      Object.entries(giscusAttributes).forEach(
        ([key, value]) => giscusScript.setAttribute(key, value)
      );
      giscusContainer.appendChild(giscusScript);
    };

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadGiscus);
    } else {
        loadGiscus();
    }

    const htmlElement = document.documentElement;
    const observer = new MutationObserver((mutationsList) => {
      for (const mutation of mutationsList) {
        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
          setGiscusFrameTheme(getGiscusTheme());
        }
      }
    });
    observer.observe(htmlElement, { attributes: true });

  })();
</script>


  </article>
</div>
</main>
    </div>

    
    <div id="search-modal-overlay" class="search-modal-overlay" style="display: none;">
      <div id="search-modal-content" class="search-modal-content">
        <button id="search-modal-close" class="search-modal-close" aria-label="Close search" title="Close search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
        <input type="search" id="modal-search-input" class="modal-search-input" placeholder="Search content..." aria-label="Search input">
        <div id="modal-search-results" class="modal-search-results">
        </div>
      </div>
    </div>
    

  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js" defer></script>
  <script>
    (function() {
      'use strict';

      window.addEventListener('DOMContentLoaded', () => {
        const searchModalOverlay = document.getElementById('search-modal-overlay');
        const searchModalContent = document.getElementById('search-modal-content');
        const searchModalCloseButton = document.getElementById('search-modal-close');
        const searchToggleButton = document.getElementById('nav-search-toggle');
        const searchInputTarget = document.getElementById('modal-search-input');
        const searchResultsTarget = document.getElementById('modal-search-results');

        let fuseInstance = null;
        let searchData = [];

        const loadSearchData = async () => {
          if (searchData.length === 0 && !fuseInstance) {
            try {
              const response = await fetch('\/index.json');
              if (!response.ok) {
                throw new Error(`HTTP error loading index.json! status: ${response.status}`);
              }
              searchData = await response.json();
              initializeFuse();
            } catch (e) {
              console.error("[SearchSetup] Error loading search data:", e);
              if (searchResultsTarget) searchResultsTarget.innerHTML = "<p>Error loading search index.</p>";
            }
          } else if (searchData.length > 0 && !fuseInstance){
            initializeFuse();
          }
        };

        const initializeFuse = () => {
          if (searchData.length > 0 && !fuseInstance) {
            const options = {
              keys: [
                { name: 'title', weight: 0.7 }, { name: 'summary', weight: 0.5 },
                { name: 'content', weight: 0.3 }, { name: 'tags', weight: 0.4 }
              ],
              includeScore: true, threshold: 0.4, minMatchCharLength: 2,
            };
            fuseInstance = new Fuse(searchData, options);
          }
        };

        const performSearch = () => {
          if (!fuseInstance || !searchInputTarget || !searchResultsTarget) return;
          const query = searchInputTarget.value.trim();
          searchResultsTarget.innerHTML = '';
          if (query.length < 2) return;

          const results = fuseInstance.search(query);
          if (results.length > 0) {
            const ul = document.createElement('ul');
            ul.className = 'search-results-list';
            results.slice(0, 10).forEach(result => {
              const item = result.item;
              const li = document.createElement('li');
              li.className = 'search-result-item';
              const a = document.createElement('a');
              a.href = item.permalink;
              a.textContent = item.title;
              li.appendChild(a);
              ul.appendChild(li);
            });
            searchResultsTarget.appendChild(ul);
          } else {
            searchResultsTarget.innerHTML = '<p>No results found.</p>';
          }
        };

        const openSearchModal = async () => {
          await loadSearchData();
          if (searchInputTarget) searchInputTarget.value = '';
          if (searchResultsTarget) searchResultsTarget.innerHTML = '';

          if (searchModalOverlay) {
            searchModalOverlay.style.display = 'flex';
            setTimeout(() => searchModalOverlay.classList.add('active'), 10);
          } else { return; }

          if (searchInputTarget) setTimeout(() => searchInputTarget.focus(), 50);
          if (searchToggleButton) searchToggleButton.classList.add('active');
        };

        const closeSearchModal = () => {
          if (searchModalOverlay) {
            searchModalOverlay.classList.remove('active');
            setTimeout(() => searchModalOverlay.style.display = 'none', 300);
          }
          if (searchToggleButton) searchToggleButton.classList.remove('active');
        };

        if (searchToggleButton) {
          searchToggleButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (searchModalOverlay && searchModalOverlay.classList.contains('active')) {
              closeSearchModal();
            } else {
              openSearchModal();
            }
          });
        } else { console.error("[SearchSetup] #nav-search-toggle button not found."); }

        if (searchModalCloseButton) { searchModalCloseButton.addEventListener('click', closeSearchModal); }
        if (searchModalOverlay && searchModalContent) {
          searchModalOverlay.addEventListener('click', (event) => {
            if (event.target === searchModalOverlay) closeSearchModal();
          });
        }
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && searchModalOverlay && searchModalOverlay.classList.contains('active')) {
            closeSearchModal();
          }
        });
        if (searchInputTarget) {
          let debounceTimer;
          searchInputTarget.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(performSearch, 300);
          });
        }
      });
    })();
  </script>

    

    

  <script>
    MathJax = {
      tex: {
        displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        inlineMath: [['\\(', '\\)']], 
        processEscapes: true,
        processEnvironments: true,
        tags: 'ams' 
      },
      svg: {
        fontCache: 'global' 
      },
      chtml: {
        fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'], 
        ignoreHtmlClass: 'tex2jax_ignore', 
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<footer class="footer-main simplified-footer">
  <div class="content-body footer-wraper">
    <div class="footer-box">
      <div class="footer-content">
        <div class="copyright-line">
          Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> © 2025 See Hiong. All rights reserved.
        </div>
        <div class="social-links">
          
            <a href="https://github.com/seehiong" target="_blank" title="GitHub" class="social-link" aria-label="GitHub">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </a>
          
          
            <a href="https://www.linkedin.com/in/seehiong/" target="_blank" title="LinkedIn" class="social-link" aria-label="LinkedIn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
          
          
            <a href="/index.xml" target="_blank" title="RSS" class="social-link" aria-label="RSS Feed">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z"/></svg>
            </a>
          
        </div>
      </div>
    </div>
  </div>
</footer>
        <script src="/js/animation.js" defer></script>
    
        <script src="/js/code-copy.js" defer></script>
    
        <script src="/js/scroll-header.js" defer></script>
       
  </body>
</html>